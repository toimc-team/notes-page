(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{1049:function(t,a,s){"use strict";s.r(a);var e=s(30),v=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"高级查询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#高级查询"}},[t._v("#")]),t._v(" 高级查询")]),t._v(" "),e("h2",{attrs:{id:"聚合查询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#聚合查询"}},[t._v("#")]),t._v(" 聚合查询")]),t._v(" "),e("h3",{attrs:{id:"什么是-mongodb-聚合框架"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#什么是-mongodb-聚合框架"}},[t._v("#")]),t._v(" 什么是 MongoDB 聚合框架")]),t._v(" "),e("blockquote",[e("p",[t._v("MongoDB 聚合框架（Aggregation Framework）是一个计算框架，它可以：")]),t._v(" "),e("ul",[e("li",[t._v("作用在一个集合或者几个集合上")]),t._v(" "),e("li",[t._v("对集合的数据进行的一些列运算")]),t._v(" "),e("li",[t._v("讲这些数据转化为期望的形式")])])]),t._v(" "),e("p",[t._v("从效果而言，聚合框架相当于 SQL 查询中的")]),t._v(" "),e("ul",[e("li",[t._v("GROUP BY")]),t._v(" "),e("li",[t._v("LEFT OUTER JOIN")]),t._v(" "),e("li",[t._v("AS 等等")])]),t._v(" "),e("h3",{attrs:{id:"管道-pipeline-和步骤-stage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#管道-pipeline-和步骤-stage"}},[t._v("#")]),t._v(" 管道(Pipeline)和步骤(Stage)")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("整个聚合运算过程成为管道（Pipeline），它由多个步骤组成；每个管道")])]),t._v(" "),e("li",[e("ul",[e("li",[t._v("接受一系列文档（原始数据）")]),t._v(" "),e("li",[t._v("每个步骤对这些文档进行一系列运算")]),t._v(" "),e("li",[t._v("结果文档输出给下一个步骤")])])])]),t._v(" "),e("p",[e("img",{attrs:{src:s(640),alt:"image.png"}})]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("pipeline "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$stage1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" $stage2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" $stageN"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\ndb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("COLLECTION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("aggregate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pipeline"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" options "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("table",[e("thead",[e("tr",[e("th",[t._v("步骤")]),t._v(" "),e("th",[t._v("作用")]),t._v(" "),e("th",[t._v("SQL 等价运算符")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("$match")]),t._v(" "),e("td",[t._v("过滤")]),t._v(" "),e("td",[t._v("WHERE")])]),t._v(" "),e("tr",[e("td",[t._v("$project")]),t._v(" "),e("td",[t._v("投影")]),t._v(" "),e("td",[t._v("AS")])]),t._v(" "),e("tr",[e("td",[t._v("$sort")]),t._v(" "),e("td",[t._v("排序")]),t._v(" "),e("td",[t._v("ORDER BY")])]),t._v(" "),e("tr",[e("td",[t._v("$group")]),t._v(" "),e("td",[t._v("分组")]),t._v(" "),e("td",[t._v("GROUP BY")])]),t._v(" "),e("tr",[e("td",[t._v("$skip/$limit")]),t._v(" "),e("td",[t._v("结果限制")]),t._v(" "),e("td",[t._v("SKIP/LIMIT")])]),t._v(" "),e("tr",[e("td",[t._v("$looup")]),t._v(" "),e("td",[t._v("左外连接")]),t._v(" "),e("td",[t._v("LEFT OUTER JOIN")])]),t._v(" "),e("tr",[e("td",[t._v("$unwind")]),t._v(" "),e("td",[t._v("展开数组")]),t._v(" "),e("td",[t._v("N/A")])]),t._v(" "),e("tr",[e("td",[t._v("$graphLoopup")]),t._v(" "),e("td",[t._v("图搜索")]),t._v(" "),e("td",[t._v("N/A")])]),t._v(" "),e("tr",[e("td",[t._v("$facet/$bucket")]),t._v(" "),e("td",[t._v("分页搜索")]),t._v(" "),e("td",[t._v("N/A")])])])]),t._v(" "),e("h2",{attrs:{id:"聚合运算的使用场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#聚合运算的使用场景"}},[t._v("#")]),t._v(" 聚合运算的使用场景")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("计算；比如")]),t._v(" "),e("ul",[e("li",[t._v("计算一段时间内的销售总额、均值")]),t._v(" "),e("li",[t._v("分析一段时间的净利润")]),t._v(" "),e("li",[t._v("分析购买人的年龄分布")]),t._v(" "),e("li",[t._v("分析学生成绩分布")]),t._v(" "),e("li",[t._v("统计员工绩效")]),t._v(" "),e("li",[t._v(".....")])])]),t._v(" "),e("li",[e("p",[t._v("数据的复杂运用")])])]),t._v(" "),e("h2",{attrs:{id:"mql-常用步骤与-sql-对比"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mql-常用步骤与-sql-对比"}},[t._v("#")]),t._v(" MQL 常用步骤与 SQL 对比")]),t._v(" "),e("p",[e("img",{attrs:{src:s(641),alt:"image.png"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(642),alt:"image.png"}})]),t._v(" "),e("h2",{attrs:{id:"mql-特有步骤-unwind"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mql-特有步骤-unwind"}},[t._v("#")]),t._v(" MQL 特有步骤"),e("code",[t._v("$unwind")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(643),alt:"image.png"}})]),t._v(" "),e("h2",{attrs:{id:"mql-特有的-bucket"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mql-特有的-bucket"}},[t._v("#")]),t._v(" MQL 特有的"),e("code",[t._v("$bucket")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(644),alt:"image.png"}})]),t._v(" "),e("h2",{attrs:{id:"mql-特有的-facet"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mql-特有的-facet"}},[t._v("#")]),t._v(" MQL 特有的"),e("code",[t._v("$facet")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(645),alt:"image.png"}})]),t._v(" "),e("p",[e("img",{attrs:{src:s(545),alt:"image.png"}})])])}),[],!1,null,null,null);a.default=v.exports},545:function(t,a,s){t.exports=s.p+"assets/img/1616739691929-b7144c9f-c48e-451a-bae6-b9f2bb8e2f11.1f7ae431.png"},640:function(t,a,s){t.exports=s.p+"assets/img/1616722946746-5f6bcc8c-8fe6-4f06-8803-d48aeef442b8.c4a042c3.png"},641:function(t,a,s){t.exports=s.p+"assets/img/1616735835149-4fa69238-f7ea-4c8e-b76f-61dc860d2b5b.fdce3105.png"},642:function(t,a,s){t.exports=s.p+"assets/img/1616735882990-5e0eaa21-3f88-42df-b98e-1b6d74f1a2af.fa9e107c.png"},643:function(t,a,s){t.exports=s.p+"assets/img/1616735977733-fbf68d59-58d5-4e40-b6b0-cccc8af707af.78390303.png"},644:function(t,a,s){t.exports=s.p+"assets/img/1616736066821-ec321bb0-cec5-4474-b0ea-e0b28c06e862.9fc2234a.png"},645:function(t,a,s){t.exports=s.p+"assets/img/1616736149325-a05797b7-521a-494d-b439-fefd0ae0db4a.e7f95e96.png"}}]);