(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{1059:function(t,a,s){"use strict";s.r(a);var e=s(11),v=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"高级查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高级查询"}},[t._v("#")]),t._v(" 高级查询")]),t._v(" "),a("h2",{attrs:{id:"聚合查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#聚合查询"}},[t._v("#")]),t._v(" 聚合查询")]),t._v(" "),a("h3",{attrs:{id:"什么是-mongodb-聚合框架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-mongodb-聚合框架"}},[t._v("#")]),t._v(" 什么是 MongoDB 聚合框架")]),t._v(" "),a("blockquote",[a("p",[t._v("MongoDB 聚合框架（Aggregation Framework）是一个计算框架，它可以：")]),t._v(" "),a("ul",[a("li",[t._v("作用在一个集合或者几个集合上")]),t._v(" "),a("li",[t._v("对集合的数据进行的一些列运算")]),t._v(" "),a("li",[t._v("讲这些数据转化为期望的形式")])])]),t._v(" "),a("p",[t._v("从效果而言，聚合框架相当于 SQL 查询中的")]),t._v(" "),a("ul",[a("li",[t._v("GROUP BY")]),t._v(" "),a("li",[t._v("LEFT OUTER JOIN")]),t._v(" "),a("li",[t._v("AS 等等")])]),t._v(" "),a("h3",{attrs:{id:"管道-pipeline-和步骤-stage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#管道-pipeline-和步骤-stage"}},[t._v("#")]),t._v(" 管道(Pipeline)和步骤(Stage)")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("整个聚合运算过程成为管道（Pipeline），它由多个步骤组成；每个管道")])]),t._v(" "),a("li",[a("ul",[a("li",[t._v("接受一系列文档（原始数据）")]),t._v(" "),a("li",[t._v("每个步骤对这些文档进行一系列运算")]),t._v(" "),a("li",[t._v("结果文档输出给下一个步骤")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:s(420),alt:"image.png"}})]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("pipeline "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$stage1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" $stage2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" $stageN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("COLLECTION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("aggregate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pipeline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" options "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("步骤")]),t._v(" "),a("th",[t._v("作用")]),t._v(" "),a("th",[t._v("SQL 等价运算符")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("$match")]),t._v(" "),a("td",[t._v("过滤")]),t._v(" "),a("td",[t._v("WHERE")])]),t._v(" "),a("tr",[a("td",[t._v("$project")]),t._v(" "),a("td",[t._v("投影")]),t._v(" "),a("td",[t._v("AS")])]),t._v(" "),a("tr",[a("td",[t._v("$sort")]),t._v(" "),a("td",[t._v("排序")]),t._v(" "),a("td",[t._v("ORDER BY")])]),t._v(" "),a("tr",[a("td",[t._v("$group")]),t._v(" "),a("td",[t._v("分组")]),t._v(" "),a("td",[t._v("GROUP BY")])]),t._v(" "),a("tr",[a("td",[t._v("$skip/$limit")]),t._v(" "),a("td",[t._v("结果限制")]),t._v(" "),a("td",[t._v("SKIP/LIMIT")])]),t._v(" "),a("tr",[a("td",[t._v("$looup")]),t._v(" "),a("td",[t._v("左外连接")]),t._v(" "),a("td",[t._v("LEFT OUTER JOIN")])]),t._v(" "),a("tr",[a("td",[t._v("$unwind")]),t._v(" "),a("td",[t._v("展开数组")]),t._v(" "),a("td",[t._v("N/A")])]),t._v(" "),a("tr",[a("td",[t._v("$graphLoopup")]),t._v(" "),a("td",[t._v("图搜索")]),t._v(" "),a("td",[t._v("N/A")])]),t._v(" "),a("tr",[a("td",[t._v("$facet/$bucket")]),t._v(" "),a("td",[t._v("分页搜索")]),t._v(" "),a("td",[t._v("N/A")])])])]),t._v(" "),a("h2",{attrs:{id:"聚合运算的使用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#聚合运算的使用场景"}},[t._v("#")]),t._v(" 聚合运算的使用场景")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("计算；比如")]),t._v(" "),a("ul",[a("li",[t._v("计算一段时间内的销售总额、均值")]),t._v(" "),a("li",[t._v("分析一段时间的净利润")]),t._v(" "),a("li",[t._v("分析购买人的年龄分布")]),t._v(" "),a("li",[t._v("分析学生成绩分布")]),t._v(" "),a("li",[t._v("统计员工绩效")]),t._v(" "),a("li",[t._v(".....")])])]),t._v(" "),a("li",[a("p",[t._v("数据的复杂运用")])])]),t._v(" "),a("h2",{attrs:{id:"mql-常用步骤与-sql-对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mql-常用步骤与-sql-对比"}},[t._v("#")]),t._v(" MQL 常用步骤与 SQL 对比")]),t._v(" "),a("p",[a("img",{attrs:{src:s(421),alt:"image.png"}})]),t._v(" "),a("p",[a("img",{attrs:{src:s(422),alt:"image.png"}})]),t._v(" "),a("h2",{attrs:{id:"mql-特有步骤-unwind"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mql-特有步骤-unwind"}},[t._v("#")]),t._v(" MQL 特有步骤"),a("code",[t._v("$unwind")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(423),alt:"image.png"}})]),t._v(" "),a("h2",{attrs:{id:"mql-特有的-bucket"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mql-特有的-bucket"}},[t._v("#")]),t._v(" MQL 特有的"),a("code",[t._v("$bucket")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(424),alt:"image.png"}})]),t._v(" "),a("h2",{attrs:{id:"mql-特有的-facet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mql-特有的-facet"}},[t._v("#")]),t._v(" MQL 特有的"),a("code",[t._v("$facet")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(425),alt:"image.png"}})]),t._v(" "),a("p",[a("img",{attrs:{src:s(340),alt:"image.png"}})])])}),[],!1,null,null,null);a.default=v.exports},340:function(t,a,s){t.exports=s.p+"assets/img/1616739691929-b7144c9f-c48e-451a-bae6-b9f2bb8e2f11.1f7ae431.png"},420:function(t,a,s){t.exports=s.p+"assets/img/1616722946746-5f6bcc8c-8fe6-4f06-8803-d48aeef442b8.c4a042c3.png"},421:function(t,a,s){t.exports=s.p+"assets/img/1616735835149-4fa69238-f7ea-4c8e-b76f-61dc860d2b5b.fdce3105.png"},422:function(t,a,s){t.exports=s.p+"assets/img/1616735882990-5e0eaa21-3f88-42df-b98e-1b6d74f1a2af.fa9e107c.png"},423:function(t,a,s){t.exports=s.p+"assets/img/1616735977733-fbf68d59-58d5-4e40-b6b0-cccc8af707af.78390303.png"},424:function(t,a,s){t.exports=s.p+"assets/img/1616736066821-ec321bb0-cec5-4474-b0ea-e0b28c06e862.9fc2234a.png"},425:function(t,a,s){t.exports=s.p+"assets/img/1616736149325-a05797b7-521a-494d-b439-fefd0ae0db4a.e7f95e96.png"}}]);