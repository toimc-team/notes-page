(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1012:function(t,e,s){"use strict";s.r(e);var v=s(11),_=Object(v.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"gitee-jenkins自动化实战"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gitee-jenkins自动化实战"}},[t._v("#")]),t._v(" Gitee + Jenkins自动化实战")]),t._v(" "),e("p",[t._v("当我们熟悉了"),e("code",[t._v("Jenkins")]),t._v(" 的使用后，接下来我们来配置一个基于 "),e("code",[t._v("vue-element-admin")]),t._v(" 的实战项目，来感受一下自动化流程带给我们的优势。")]),t._v(" "),e("p",[t._v("首先我们需要创建一个 "),e("code",[t._v("git")]),t._v(" 项目，至于代码仓库可以自选，这里为了国内方便访问，我选择了 "),e("code",[t._v("Gitee")]),t._v(" ，然后我们需要给 "),e("code",[t._v("Jenkins")]),t._v(" 配置一些插件，比如 "),e("code",[t._v("NodeJS")]),t._v(" 等，创建一个构建任务，关联 "),e("code",[t._v("git")]),t._v(" 代码仓库，编写 "),e("code",[t._v("vue")]),t._v(" 项目的编译打包脚本，再将打包后的产物部署到云服务器，这里演示的是阿里云的Nginx服务器。")]),t._v(" "),e("h2",{attrs:{id:"创建git项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建git项目"}},[t._v("#")]),t._v(" 创建git项目")]),t._v(" "),e("p",[t._v("这里以"),e("code",[t._v("Gitee")]),t._v("作为代码仓库，也可以使用"),e("code",[t._v("Github")]),t._v("/"),e("code",[t._v("Gitlab")]),t._v("等仓库。")]),t._v(" "),e("p",[t._v("假设创建的仓库地址是："),e("code",[t._v("https://gitee.com/xxx/jenkins_test.git")]),t._v("（创建过程很简单，就不演示了）")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),e("p",[t._v("Git 可以创建私有项目哦。")])]),t._v(" "),e("h2",{attrs:{id:"安装jenkins插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装jenkins插件"}},[t._v("#")]),t._v(" 安装Jenkins插件")]),t._v(" "),e("p",[e("strong",[t._v("安装Gitee插件")])]),t._v(" "),e("p",[t._v("因为这里使用了"),e("code",[t._v("Gitee")]),t._v("，我们需要在"),e("code",[t._v("Jenkins")]),t._v("中安装Gitee插件：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(560),alt:""}})]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),e("p",[t._v("安装完记得重启Jenkins，否则新安装的插件不会显示哦。")])]),t._v(" "),e("p",[e("strong",[t._v("配置Gitee")])]),t._v(" "),e("p",[t._v("在[Jenkins] > [系统管理] > [系统配置] > [Gitee配置] 配置 "),e("code",[t._v("Gitee")]),t._v(" 信息：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(561),alt:""}})]),t._v(" "),e("ul",[e("li",[t._v("链接名：输入Gitee或随便输入你想要的名称")]),t._v(" "),e("li",[t._v("Gitee域名URL：输入Gitee完整的URL地址 "),e("code",[t._v("https://gitee.com")])]),t._v(" "),e("li",[t._v("证书令牌：如没有添加需要新建一个，点击添加（如下图）")])]),t._v(" "),e("img",{staticStyle:{width:"750px"},attrs:{src:s(562),alt:"添加凭据"}}),t._v(" "),e("ul",[e("li",[t._v("Domain：选择全局凭据")]),t._v(" "),e("li",[t._v("类型：选择Gitee API令牌")]),t._v(" "),e("li",[t._v("范围：选择全局")]),t._v(" "),e("li",[t._v("Gitee APIV5 私人令牌，"),e("a",{attrs:{href:"https://gitee.com/profile/personal_access_tokens",target:"_blank",rel:"noopener noreferrer"}},[t._v("点击获取"),e("OutboundLink")],1)]),t._v(" "),e("li",[t._v("ID 和 描述就随便写不一样的就行")])]),t._v(" "),e("p",[t._v("添加完令牌就直接选择就行，然后点击【测试链接】，如果出现"),e("code",[t._v("成功")]),t._v("则表示配置正确：")]),t._v(" "),e("img",{staticStyle:{width:"900px"},attrs:{src:s(563),alt:"添加凭据"}}),t._v(" "),e("p",[e("strong",[t._v("安装NodeJS")])]),t._v(" "),e("p",[t._v("因为我们的Vue项目是基于 "),e("code",[t._v("NodeJS")]),t._v(" 来打包构建的，所以需要在 "),e("code",[t._v("Jenkins")]),t._v(" 中安装插件：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(564),alt:""}})]),t._v(" "),e("p",[e("strong",[t._v("配置NodeJS")])]),t._v(" "),e("p",[t._v("在[系统管理] > [系统配置] > [全局工具配置] > [NodeJS] 点击【NodeJS安装】：")]),t._v(" "),e("img",{staticStyle:{width:"900px"},attrs:{src:s(565),alt:"NodeJS"}}),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),e("p",[e("code",[t._v("NodeJS")]),t._v(" 版本不要选太高，选最新的LTS版本即可，否则可能因为版本不兼容导致构建失败，建议选择版本和本地开发的版本相同，这样就不会有问题了。")])]),t._v(" "),e("h2",{attrs:{id:"构建任务配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建任务配置"}},[t._v("#")]),t._v(" 构建任务配置")]),t._v(" "),e("p",[t._v("在 "),e("code",[t._v("Jenkins")]),t._v(" 首页点击【新建任务】开始第一个流水线的构建，选择"),e("code",[t._v("构建一个自由风格的软件项目")]),t._v(" 点击保存即可创建构建项目：")]),t._v(" "),e("img",{staticStyle:{width:"800px"},attrs:{src:s(566),alt:"NodeJS"}}),t._v(" "),e("p",[t._v("新建完成后进入配置，流水线会按照 [General] > [源码管理] > [构建触发器] > [构建环境] > [构建] > [构建后操作]的步骤来执行自动化任务。")]),t._v(" "),e("h3",{attrs:{id:"general"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#general"}},[t._v("#")]),t._v(" General")]),t._v(" "),e("img",{staticStyle:{width:"900px"},attrs:{src:s(567),alt:"NodeJS"}}),t._v(" "),e("h3",{attrs:{id:"源码管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#源码管理"}},[t._v("#")]),t._v(" 源码管理")]),t._v(" "),e("ul",[e("li",[t._v("选择 "),e("code",[t._v("Git")]),t._v(" 选项")]),t._v(" "),e("li",[t._v("Repository URL: 创建的git项目地址")]),t._v(" "),e("li",[t._v("Credentials：点击添加一个凭据（注意 "),e("code",[t._v("Gitee API Token")]),t._v(" 凭据不可用于源码管理的凭据，只用于"),e("code",[t._v("gitee")]),t._v("插件的 API 调用凭据）")]),t._v(" "),e("li",[t._v("点击【高级】 Advanced 按钮，Name输入"),e("code",[t._v("origin")]),t._v("，Refspec输入"),e("code",[t._v("+refs/heads/*:refs/remotes/origin/*")])]),t._v(" "),e("li",[t._v("指定分支："),e("code",[t._v("master")])])]),t._v(" "),e("img",{staticStyle:{width:"800px"},attrs:{src:s(568),alt:"NodeJS"}}),t._v(" "),e("h3",{attrs:{id:"触发器配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#触发器配置"}},[t._v("#")]),t._v(" 触发器配置")]),t._v(" "),e("p",[t._v("这里选择配置 "),e("code",[t._v("push")]),t._v(" 代码立即触发构建任务，勾选 "),e("code",[t._v("Gitee webhook触发构建")]),t._v("，后面有个地址这个后面需要配置到"),e("code",[t._v("Gitee")]),t._v("，"),e("code",[t._v("Gitee")]),t._v("触发构建策略勾选推送代码，其他先默认就行。")]),t._v(" "),e("img",{staticStyle:{width:"800px"},attrs:{src:s(569),alt:"触发构建"}}),t._v(" "),e("p",[t._v("后面有个 "),e("code",[t._v("Gitee WebHook密码")]),t._v(" 栏位需要配置到Gitee，点击生成就会生成一个密码：")]),t._v(" "),e("img",{staticStyle:{width:"800px"},attrs:{src:s(570),alt:"触发构建"}}),t._v(" "),e("p",[t._v("打开 "),e("code",[t._v("Gitee")]),t._v(" 项目的管理选项卡，左侧有个[WebHooks]菜单 ，点击【添加webHook】:")]),t._v(" "),e("img",{staticStyle:{width:"1000px"},attrs:{src:s(571),alt:"触发构建"}}),t._v(" "),e("p",[t._v("将上一步 "),e("code",[t._v("Jenkins")]),t._v(" 生成的"),e("code",[t._v("URL")]),t._v("和"),e("code",[t._v("密码")]),t._v("填进去，点击【添加】：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(572),alt:""}})]),t._v(" "),e("h3",{attrs:{id:"构建环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建环境"}},[t._v("#")]),t._v(" 构建环境")]),t._v(" "),e("p",[t._v("修改构建任务的构建环境，勾选 "),e("code",[t._v("Provide Node & npm bin/ folder to PATH")]),t._v(" ，默认会选择"),e("code",[t._v("Jenkins")]),t._v("安装的"),e("code",[t._v("NodeJS")]),t._v("版本:")]),t._v(" "),e("img",{staticStyle:{width:"800px"},attrs:{src:s(573),alt:"构建环境"}}),t._v(" "),e("h3",{attrs:{id:"构建脚本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建脚本"}},[t._v("#")]),t._v(" 构建脚本")]),t._v(" "),e("p",[t._v("选择【执行shell】：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(574),alt:""}})]),t._v(" "),e("p",[t._v("先随便写一个shell脚本试试：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(575),alt:""}})]),t._v(" "),e("p",[t._v("保存后，触发一次提交，看看"),e("code",[t._v("控制台输出")]),t._v("：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(576),alt:""}})]),t._v(" "),e("h2",{attrs:{id:"构建及部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建及部署"}},[t._v("#")]),t._v(" 构建及部署")]),t._v(" "),e("p",[t._v("背景介绍：jenkins通过Docker容器的方式安装")]),t._v(" "),e("p",[t._v("需求：Vue项目打包发布到装有nginx的服务器")]),t._v(" "),e("p",[t._v("思路：vue项目通过 "),e("code",[t._v("NodeJS")]),t._v(" 构建后，需要将构建后的 "),e("code",[t._v("dist")]),t._v(" 文件夹的内容部署到云服务器，因为 "),e("code",[t._v("Jenkins")]),t._v(" 是 "),e("code",[t._v("Docker")]),t._v(" 容器创建的，容器内部不能直接移动文件，因为没有挂载"),e("code",[t._v("volumn")]),t._v("，所以这里可以使用 "),e("code",[t._v("SSH")]),t._v(" 的方式来传输容器的构建文件到"),e("code",[t._v("nginx")]),t._v("服务器。")]),t._v(" "),e("h3",{attrs:{id:"安装插件publish-over-ssh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装插件publish-over-ssh"}},[t._v("#")]),t._v(" 安装插件Publish Over SSH")]),t._v(" "),e("p",[t._v("先来安装下"),e("code",[t._v("Publish over SSH")]),t._v("，进入插件管理：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(577),alt:""}})]),t._v(" "),e("p",[t._v("安装完成后，在[系统管理] > [系统配置] 会多出一个"),e("code",[t._v("Publish over SSH")]),t._v(":")]),t._v(" "),e("p",[t._v("在需要部署的目标云服务器生成密钥：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$ ssh-keygen "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" rsa "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-C")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxx@qq.com"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将公钥放到authorized_keys，否则SSH Server配置会不成功")]),t._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" id_rsa.pub "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" authorized_keys\n")])])]),e("p",[t._v("在 "),e("code",[t._v("Key")]),t._v(" 栏位填写私钥：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(578),alt:""}})]),t._v(" "),e("p",[t._v("设置 "),e("code",[t._v("SSH")]),t._v(" 目标服务器的信息：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(579),alt:""}})]),t._v(" "),e("h3",{attrs:{id:"配置node-js环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置node-js环境"}},[t._v("#")]),t._v(" 配置Node.js环境")]),t._v(" "),e("p",[t._v("安装Node插件："),e("a",{attrs:{href:"https://plugins.jenkins.io/nodejs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://plugins.jenkins.io/nodejs/"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("可以系统设置 -> 全局工具配置 -> 安装Node.js LTS版本")]),t._v(" "),e("p",[e("img",{attrs:{src:s(580),alt:"image-20210730154148534"}})]),t._v(" "),e("p",[t._v("配置如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(581),alt:"image-20210730155447847"}})]),t._v(" "),e("h3",{attrs:{id:"构建与发布"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建与发布"}},[t._v("#")]),t._v(" 构建与发布")]),t._v(" "),e("p",[t._v("点击 【Test Configuration】按钮，左侧显示 "),e("code",[t._v("Success")]),t._v(" 即表示"),e("code",[t._v("SSH")]),t._v("可以连接成功。")]),t._v(" "),e("p",[t._v("[构建步骤]修改下 "),e("code",[t._v("shell")]),t._v(" 脚本，进行 "),e("code",[t._v("vue")]),t._v(" 的"),e("code",[t._v("安装")]),t._v("和"),e("code",[t._v("打包")]),t._v("：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(582),alt:""}})]),t._v(" "),e("p",[t._v("先添加一个"),e("code",[t._v("Transfer Set")]),t._v("删除部署目录的文件，假如 "),e("code",[t._v("nginx")]),t._v(" 配置的 "),e("code",[t._v("root")]),t._v(" 目录为"),e("code",[t._v("/usr/share/nginx/flower_html/")]),t._v("：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(583),alt:""}})]),t._v(" "),e("p",[t._v("再加一个 "),e("code",[t._v("Transfer Set")]),t._v(" 传送文件到部署目录：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(584),alt:""}})]),t._v(" "),e("p",[t._v("都设置好了，来触发一次构建，部署效果：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(585),alt:""}})]),t._v(" "),e("p",[t._v("有了 "),e("code",[t._v("Jenkins")]),t._v(" 自动化部署，以后我们只需要关注代码层面即可，修改完代码，提交到 "),e("code",[t._v("Git")]),t._v(" 仓库，然后 "),e("code",[t._v("Jenkins")]),t._v(" 会自动帮我们构建、打包、部署，是不是很方便呢。")])])}),[],!1,null,null,null);e.default=_.exports},560:function(t,e,s){t.exports=s.p+"assets/img/20210324164001297.b71d3458.png"},561:function(t,e,s){t.exports=s.p+"assets/img/20210324164650789.3187125d.png"},562:function(t,e,s){t.exports=s.p+"assets/img/20210324170014881.f7b7f626.png"},563:function(t,e,s){t.exports=s.p+"assets/img/20210324170446534.a760d866.png"},564:function(t,e,s){t.exports=s.p+"assets/img/20210324203031178.576d221c.png"},565:function(t,e,s){t.exports=s.p+"assets/img/20210420210529926.297820e6.png"},566:function(t,e,s){t.exports=s.p+"assets/img/20210324170835154.98dd5a36.png"},567:function(t,e,s){t.exports=s.p+"assets/img/20210324171712229.fd78fbad.png"},568:function(t,e,s){t.exports=s.p+"assets/img/20210324194748464.279d34ce.png"},569:function(t,e,s){t.exports=s.p+"assets/img/20210324193112270.57b59266.png"},570:function(t,e,s){t.exports=s.p+"assets/img/20210324193145702.c6eb229f.png"},571:function(t,e,s){t.exports=s.p+"assets/img/20210324193317281.6ac38d30.png"},572:function(t,e,s){t.exports=s.p+"assets/img/20210324193430983.8d8d89dd.png"},573:function(t,e,s){t.exports=s.p+"assets/img/20210420221323687.b509abed.png"},574:function(t,e,s){t.exports=s.p+"assets/img/20210324200306648.07f96ef5.png"},575:function(t,e,s){t.exports=s.p+"assets/img/2021032420025598.4598b783.png"},576:function(t,e,s){t.exports=s.p+"assets/img/20210324201532828.fde990fb.png"},577:function(t,e,s){t.exports=s.p+"assets/img/20210325193332944.fe606513.png"},578:function(t,e,s){t.exports=s.p+"assets/img/20210406223639894.27cd7d8a.png"},579:function(t,e,s){t.exports=s.p+"assets/img/2021040623530727.6144cbb9.png"},580:function(t,e,s){t.exports=s.p+"assets/img/image-20210730154148534.f63b8074.png"},581:function(t,e,s){t.exports=s.p+"assets/img/image-20210730155447847.5acc54e7.png"},582:function(t,e,s){t.exports=s.p+"assets/img/2021040811374362.8237423c.png"},583:function(t,e,s){t.exports=s.p+"assets/img/20210407153217299.ed823d71.png"},584:function(t,e,s){t.exports=s.p+"assets/img/20210407153314897.43b70b62.png"},585:function(t,e,s){t.exports=s.p+"assets/img/2021040811382869.e60cb9be.png"}}]);