(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{1071:function(t,s,a){"use strict";a.r(s);var e=a(29),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"xss"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xss"}},[t._v("#")]),t._v(" XSS")]),t._v(" "),a("h2",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),a("p",[t._v("什么是"),a("code",[t._v("XSS")]),t._v("，我么先来看一段维基百科的解释："),a("strong",[t._v("跨站脚本")]),t._v("（英语："),a("code",[t._v("Cross-site scripting")]),t._v("，通常简称为："),a("code",[t._v("XSS")]),t._v("）是一种网站应用程序的安全漏洞攻击，是代码注入的一种。它允许恶意用户将代码注入到网页上，其他用户在观看网页时就会受到影响。这类攻击通常包含了HTML以及用户端脚本语言。")]),t._v(" "),a("p",[t._v("举个栗子，我们写一段简单的HTML代码简单的展示一些文本内容，")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("这是文字展示区"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      此处是展示区！\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("这时候测试的小伙伴不按套路出牌，在展示区扔了下面一行")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello!I am Iron man"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("这时候浏览器在解析这段HTML的时候就会将这段代码执行，弹出信息提示框，这明显违背了程序原本的意图。")]),t._v(" "),a("p",[a("img",{attrs:{src:"assets/image-20211123172845129.png",alt:"image-20211123172845129"}})]),t._v(" "),a("p",[t._v("这就是XSS中最常规的一种攻击手段。")]),t._v(" "),a("h2",{attrs:{id:"危害"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#危害"}},[t._v("#")]),t._v(" 危害")]),t._v(" "),a("p",[t._v("XSS的攻击就是在利用浏览器去执行一些网页中本不存在的前端代码，黑客在利用这些手段可以非法获取被攻击者的数据，然后存放在自己的数据服务中。")]),t._v(" "),a("p",[t._v("常见的XSS的攻击手段和目的包含：")]),t._v(" "),a("ul",[a("li",[t._v("盗用cookie，获取敏感信息。")])]),t._v(" "),a("ul",[a("li",[t._v("利用植入Flash，通过"),a("code",[t._v("crossdomain")]),t._v("权限设置进一步获取更高权限；或者利用Java等得到类似的操作。")]),t._v(" "),a("li",[t._v("利用iframe、frame、XMLHttpRequest或上述Flash等方式，以（被攻击）用户的身份执行一些管理动作，或执行一些一般的如发微博、加好友、发私信等操作。")]),t._v(" "),a("li",[t._v("利用可被攻击的域受到其他域信任的特点，以受信任来源的身份请求一些平时不允许的操作，如进行不当的投票活动。")]),t._v(" "),a("li",[t._v("在访问量极大的一些页面上的XSS可以攻击一些小型网站，实现"),a("code",[t._v("DoS")]),t._v("攻击的效果。")])]),t._v(" "),a("h2",{attrs:{id:"分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分类"}},[t._v("#")]),t._v(" 分类")]),t._v(" "),a("p",[t._v("根据攻击的来源，XSS可以分为存储型、反射型和 DOM 型三种。")]),t._v(" "),a("h3",{attrs:{id:"存储型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储型"}},[t._v("#")]),t._v(" "),a("strong",[t._v("存储型")])]),t._v(" "),a("p",[t._v("存储型 XSS 的攻击步骤：")]),t._v(" "),a("ol",[a("li",[t._v("攻击者将恶意代码提交到目标网站的数据库中。")]),t._v(" "),a("li",[t._v("用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。")]),t._v(" "),a("li",[t._v("用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。")]),t._v(" "),a("li",[t._v("恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。")])]),t._v(" "),a("p",[t._v("这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。")]),t._v(" "),a("h3",{attrs:{id:"反射型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反射型"}},[t._v("#")]),t._v(" "),a("strong",[t._v("反射型")])]),t._v(" "),a("p",[t._v("反射型 XSS 的攻击步骤：")]),t._v(" "),a("ol",[a("li",[t._v("攻击者构造出特殊的 URL，其中包含恶意代码。")]),t._v(" "),a("li",[t._v("用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。")]),t._v(" "),a("li",[t._v("用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。")]),t._v(" "),a("li",[t._v("恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。")])]),t._v(" "),a("p",[t._v("反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。")]),t._v(" "),a("p",[t._v("反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。")]),t._v(" "),a("p",[t._v("由于需要用户主动打开恶意的 URL 才能生效，攻击者往往会结合多种手段诱导用户点击。")]),t._v(" "),a("p",[t._v("POST 的内容也可以触发反射型 XSS，只不过其触发条件比较苛刻（需要构造表单提交页面，并引导用户点击），所以非常少见。")]),t._v(" "),a("h3",{attrs:{id:"dom型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dom型"}},[t._v("#")]),t._v(" "),a("strong",[t._v("DOM型")])]),t._v(" "),a("p",[t._v("DOM 型 XSS 的攻击步骤：")]),t._v(" "),a("ol",[a("li",[t._v("攻击者构造出特殊的 URL，其中包含恶意代码。")]),t._v(" "),a("li",[t._v("用户打开带有恶意代码的 URL。")]),t._v(" "),a("li",[t._v("用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。")]),t._v(" "),a("li",[t._v("恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。")])]),t._v(" "),a("p",[t._v("DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。")]),t._v(" "),a("h2",{attrs:{id:"预防"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预防"}},[t._v("#")]),t._v(" 预防")]),t._v(" "),a("h3",{attrs:{id:"方法一-csp-content-security-policy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法一-csp-content-security-policy"}},[t._v("#")]),t._v(" "),a("strong",[t._v("方法一：CSP（Content Security Policy）")])]),t._v(" "),a("p",[t._v("CSP 的实质就是白名单制度，开发者明确告诉客户端，哪些外部资源可以加载和执行，等同于提供白名单。它的实现和执行全部由浏览器完成，开发者只需提供配置。")]),t._v(" "),a("p",[t._v("CSP 大大增强了网页的安全性。攻击者即使发现了漏洞，也没法注入脚本，除非还控制了一台列入了白名单的可信主机。")]),t._v(" "),a("p",[t._v("两种方法可以启用 CSP。一种是通过 HTTP 头信息的"),a("code",[t._v("Content-Security-Policy")]),t._v("的字段。")]),t._v(" "),a("p",[a("img",{attrs:{src:"assets/image-20211123180516170.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Content-Security-Policy: script-src 'self'; object-src 'none';\nstyle-src cdn.example.org third-party.org; child-src https:\n")])])]),a("p",[t._v("另一种是通过网页的"),a("code",[t._v("<meta>")]),t._v("标签。")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Content-Security-Policy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("script-src "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("; object-src "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("; style-src cdn.example.org third-party.org; child-src https:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("上述代码，CSP做了如下配置。")]),t._v(" "),a("ul",[a("li",[t._v("脚本：只信任当前域名。")]),t._v(" "),a("li",[a("code",[t._v("<object>")]),t._v("标签：不信任任何URL，即不加载任何资源。")]),t._v(" "),a("li",[t._v("样式表：只信任"),a("code",[t._v("cdn.example.org")]),t._v("和"),a("code",[t._v("third-party.org")]),t._v("。")]),t._v(" "),a("li",[t._v("框架（frame）：必须使用HTTPS协议加载。")]),t._v(" "),a("li",[t._v("其他资源：没有限制。")])]),t._v(" "),a("p",[t._v("启用后，不符合 CSP 的外部资源就会被阻止加载。")]),t._v(" "),a("p",[t._v("Chrome 的报错信息。")]),t._v(" "),a("p",[a("img",{attrs:{src:"assets/image-20211123180442763.png",alt:"image-20211123180442763"}})]),t._v(" "),a("p",[t._v("Firefox 的报错信息。")]),t._v(" "),a("p",[a("img",{attrs:{src:"assets/image-20211123180553647.png",alt:"image-20211123180553647"}})]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("限制选项")])])]),t._v(" "),a("p",[t._v("CSP提供了和多限制选项，涉及安全的各个方面。")]),t._v(" "),a("p",[t._v("​\t1.1. "),a("strong",[t._v("资源加载限制")])]),t._v(" "),a("p",[t._v("以下选项限制各类资源的加载。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("script-src：外部脚本\nstyle-src：样式表\nimg-src：图像\nmedia-src：媒体文件（音频和视频）\nfont-src：字体文件\nobject-src：插件（比如 Flash）\nchild-src：框架\nframe-ancestors：嵌入的外部资源（比如<frame>、<iframe>、<embed>和<applet>）\nconnect-src：HTTP 连接（通过 XHR、WebSockets、EventSource等）\nworker-src：worker脚本\nmanifest-src：manifest 文件\n")])])]),a("p",[t._v("​\t1.2. "),a("strong",[t._v("default-src")])]),t._v(" "),a("p",[a("code",[t._v("default-src")]),t._v("用来设置上面各个选项的默认值。")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[a("span",{pre:!0,attrs:{class:"token header"}},[a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Security-Policy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token header-value csp languages-csp"}},[t._v("default-src 'self'")])]),t._v("\n")])])]),a("p",[t._v("上面代码限制"),a("strong",[t._v("所有的")]),t._v("外部资源，都只能从当前域名加载。")]),t._v(" "),a("p",[t._v("如果同时设置某个单项限制（比如"),a("code",[t._v("font-src")]),t._v("）和"),a("code",[t._v("default-src")]),t._v("，前者会覆盖后者，即字体文件会采用"),a("code",[t._v("font-src")]),t._v("的值，其他资源依然采用"),a("code",[t._v("default-src")]),t._v("的值。")]),t._v(" "),a("p",[t._v("​\t1.3. "),a("strong",[t._v("URL限制")])]),t._v(" "),a("p",[t._v("有时，网页会跟其他 URL 发生联系，这时也可以加以限制。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("frame-ancestors：限制嵌入框架的网页\nbase-uri：限制<base#href>\nform-action：限制<form#action>\n")])])]),a("p",[t._v("​\t1.4. "),a("strong",[t._v("其它限制")])]),t._v(" "),a("p",[t._v("其他一些安全相关的功能，也放在了 CSP 里面。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("block-all-mixed-content：HTTPS 网页不得加载 HTTP 资源（浏览器已经默认开启）\nupgrade-insecure-requests：自动将网页上所有加载外部资源的 HTTP 链接换成 HTTPS 协议\nplugin-types：限制可以使用的插件格式\nsandbox：浏览器行为的限制，比如不能有弹出窗口等。\n")])])]),a("p",[t._v("​\t1.5. "),a("strong",[t._v("report-uri")])]),t._v(" "),a("p",[t._v("有时，我们不仅希望防止 XSS，还希望记录此类行为。"),a("code",[t._v("report-uri")]),t._v("就用来告诉浏览器，应该把注入行为报告给哪个网址。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Content-Security-Policy: default-src 'self'; ...; report-uri /my_amazing_csp_report_parser;\n")])])]),a("p",[t._v("上面代码指定，将注入行为报告给"),a("code",[t._v("/my_amazing_csp_report_parser")]),t._v("这个 URL。")]),t._v(" "),a("p",[t._v("浏览器会使用"),a("code",[t._v("POST")]),t._v("方法，发送一个JSON对象，下面是一个例子。")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"csp-report"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"document-uri"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://example.org/page.html"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"referrer"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://evil.example.com/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"blocked-uri"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://evil.example.com/evil.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"violated-directive"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"script-src 'self' https://apis.google.com\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"original-policy"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"script-src 'self' https://apis.google.com; report-uri http://example.org/my_amazing_csp_report_parser\"")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"assets/image-20211202154646600.png",alt:"image-20211202154646600"}})]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("strong",[t._v("Content-Security-Policy-Report-Only")])])]),t._v(" "),a("p",[t._v("除了"),a("code",[t._v("Content-Security-Policy")]),t._v("，还有一个"),a("code",[t._v("Content-Security-Policy-Report-Only")]),t._v("字段，表示不执行限制选项，只是记录违反限制的行为。")]),t._v(" "),a("p",[t._v("它必须与"),a("code",[t._v("report-uri")]),t._v("选项配合使用。")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[a("span",{pre:!0,attrs:{class:"token header"}},[a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Security-Policy-Report-Only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("default-src 'self'; ...; report-uri /my_amazing_csp_report_parser;")])]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("选项值")])]),t._v(" "),a("p",[t._v("每个限制选项可以设置以下几种值，这些值就构成了白名单。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("主机名：example.org，https://example.com:443\n路径名：example.org/resources/js/\n通配符：*.example.org，*://*.example.com:*（表示任意协议、任意子域名、任意端口）\n协议名：https:、data:\n关键字'self'：当前域名，需要加引号\n关键字'none'：禁止加载任何外部资源，需要加引号\n")])])]),a("p",[t._v("多个值也可以并列，用空格分割。")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[a("span",{pre:!0,attrs:{class:"token header"}},[a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Security-Policy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token header-value csp languages-csp"}},[t._v("script-src 'self' https://apis.google.com")])]),t._v("\n")])])]),a("p",[t._v("如果同一个限制选项使用多次，只有第一次会生效。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 错误的写法\nscript-src https://host1.com; script-src https://host2.com\n\n# 正确的写法\nscript-src https://host1.com https://host2.com\n")])])]),a("p",[t._v("如果不设置某个限制选项，就是默认允许任何值。")]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[a("strong",[t._v("script-src的特殊值")])])]),t._v(" "),a("p",[t._v("除了常规值，"),a("code",[t._v("script-src")]),t._v("还可以设置一些特殊值。注意，下面这些值都必须放在单引号里面。")]),t._v(" "),a("blockquote",[a("p",[a("strong",[a("code",[t._v("'unsafe-inline'")])]),t._v("：允许执行页面内嵌的"),a("code",[t._v("<script>")]),t._v("标签和事件监听函数")]),t._v(" "),a("p",[a("strong",[a("code",[t._v("unsafe-eval")])]),t._v("：允许将字符串当作代码执行，比如使用"),a("code",[t._v("eval")]),t._v("、"),a("code",[t._v("setTimeout")]),t._v("、"),a("code",[t._v("setInterval")]),t._v("和"),a("code",[t._v("Function")]),t._v("等函数。")]),t._v(" "),a("p",[a("strong",[t._v("nonce值")]),t._v("：每次HTTP回应给出一个授权token，页面内嵌脚本必须有这个token，才会执行")]),t._v(" "),a("p",[a("strong",[t._v("hash值")]),t._v("：列出允许执行的脚本代码的Hash值，页面内嵌脚本的哈希值只有吻合的情况下，才能执行。")])]),t._v(" "),a("p",[t._v("nonce值的例子如下，服务器发送网页的时候，告诉浏览器一个随机生成的token。")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[a("span",{pre:!0,attrs:{class:"token header"}},[a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Security-Policy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token header-value csp languages-csp"}},[t._v("script-src 'nonce-EDNnf03nceIOfn39fn3e9h3sdfa'")])]),t._v("\n")])])]),a("p",[t._v("页面内嵌脚本，必须有这个token才能执行。")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("nonce")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),t._v("EDNnf03nceIOfn39fn3e9h3sdfa")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// some code")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("hash值的例子如下，服务器给出一个允许执行的代码的hash值。")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[a("span",{pre:!0,attrs:{class:"token header"}},[a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Security-Policy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token header-value csp languages-csp"}},[t._v("script-src 'sha256-qznLcsROx4GACP2dm0UCKCzCG-HiZ1guq6ZZDob_Tng='")])]),t._v("\n")])])]),a("p",[t._v("下面的代码就会允许执行，因为hash值相符。")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello, world.'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("注意，计算hash值的时候，"),a("script")])])}),[],!1,null,null,null);s.default=n.exports}}]);