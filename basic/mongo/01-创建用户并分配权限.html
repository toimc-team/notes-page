<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>创建用户并分配权限 | 大前端 - 前端高级进阶</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="大前端课程电子书">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/notes-page/assets/css/0.styles.598865a5.css" as="style"><link rel="preload" href="/notes-page/assets/js/app.cefaabaf.js" as="script"><link rel="preload" href="/notes-page/assets/js/4.6a7e0344.js" as="script"><link rel="preload" href="/notes-page/assets/js/5.e265b4d0.js" as="script"><link rel="preload" href="/notes-page/assets/js/43.3e75f996.js" as="script"><link rel="prefetch" href="/notes-page/assets/js/10.20744efe.js"><link rel="prefetch" href="/notes-page/assets/js/11.16946e8f.js"><link rel="prefetch" href="/notes-page/assets/js/12.04a72c4c.js"><link rel="prefetch" href="/notes-page/assets/js/13.82cfed4d.js"><link rel="prefetch" href="/notes-page/assets/js/14.9dd22d4e.js"><link rel="prefetch" href="/notes-page/assets/js/15.36695de4.js"><link rel="prefetch" href="/notes-page/assets/js/16.2d1986e9.js"><link rel="prefetch" href="/notes-page/assets/js/17.6c0c74e9.js"><link rel="prefetch" href="/notes-page/assets/js/18.4efaf1c9.js"><link rel="prefetch" href="/notes-page/assets/js/19.4bf0d562.js"><link rel="prefetch" href="/notes-page/assets/js/2.faeddd7c.js"><link rel="prefetch" href="/notes-page/assets/js/20.bca89758.js"><link rel="prefetch" href="/notes-page/assets/js/21.985beb03.js"><link rel="prefetch" href="/notes-page/assets/js/22.3a10ed01.js"><link rel="prefetch" href="/notes-page/assets/js/23.c9a0b5ee.js"><link rel="prefetch" href="/notes-page/assets/js/24.25aa7be0.js"><link rel="prefetch" href="/notes-page/assets/js/25.19767b77.js"><link rel="prefetch" href="/notes-page/assets/js/26.8a97778c.js"><link rel="prefetch" href="/notes-page/assets/js/27.342e8d9b.js"><link rel="prefetch" href="/notes-page/assets/js/28.34ec27ba.js"><link rel="prefetch" href="/notes-page/assets/js/29.171759a1.js"><link rel="prefetch" href="/notes-page/assets/js/3.b42e669b.js"><link rel="prefetch" href="/notes-page/assets/js/30.7b6ca97f.js"><link rel="prefetch" href="/notes-page/assets/js/31.39e4ae05.js"><link rel="prefetch" href="/notes-page/assets/js/32.155b994b.js"><link rel="prefetch" href="/notes-page/assets/js/33.bbe52813.js"><link rel="prefetch" href="/notes-page/assets/js/34.4ff624f0.js"><link rel="prefetch" href="/notes-page/assets/js/35.5552c06b.js"><link rel="prefetch" href="/notes-page/assets/js/36.bdd787f8.js"><link rel="prefetch" href="/notes-page/assets/js/37.457a18a8.js"><link rel="prefetch" href="/notes-page/assets/js/38.246f26f0.js"><link rel="prefetch" href="/notes-page/assets/js/39.18dc7d1d.js"><link rel="prefetch" href="/notes-page/assets/js/40.a03370de.js"><link rel="prefetch" href="/notes-page/assets/js/41.ecb82051.js"><link rel="prefetch" href="/notes-page/assets/js/42.ca0f4bd8.js"><link rel="prefetch" href="/notes-page/assets/js/44.e28def85.js"><link rel="prefetch" href="/notes-page/assets/js/45.a20867d9.js"><link rel="prefetch" href="/notes-page/assets/js/46.d457e177.js"><link rel="prefetch" href="/notes-page/assets/js/47.31ee9624.js"><link rel="prefetch" href="/notes-page/assets/js/48.0496e5c8.js"><link rel="prefetch" href="/notes-page/assets/js/49.99d9cc93.js"><link rel="prefetch" href="/notes-page/assets/js/50.3bdf52f4.js"><link rel="prefetch" href="/notes-page/assets/js/51.556a917f.js"><link rel="prefetch" href="/notes-page/assets/js/52.5de01f99.js"><link rel="prefetch" href="/notes-page/assets/js/53.5402efe6.js"><link rel="prefetch" href="/notes-page/assets/js/54.08ce8c78.js"><link rel="prefetch" href="/notes-page/assets/js/55.22178926.js"><link rel="prefetch" href="/notes-page/assets/js/56.0a5810ea.js"><link rel="prefetch" href="/notes-page/assets/js/57.99a393f3.js"><link rel="prefetch" href="/notes-page/assets/js/58.a2358583.js"><link rel="prefetch" href="/notes-page/assets/js/59.804ef74a.js"><link rel="prefetch" href="/notes-page/assets/js/6.d87de747.js"><link rel="prefetch" href="/notes-page/assets/js/60.55299036.js"><link rel="prefetch" href="/notes-page/assets/js/61.bf6aee5b.js"><link rel="prefetch" href="/notes-page/assets/js/62.d5fe0864.js"><link rel="prefetch" href="/notes-page/assets/js/63.4eac1b92.js"><link rel="prefetch" href="/notes-page/assets/js/64.a437dd2d.js"><link rel="prefetch" href="/notes-page/assets/js/65.b1e55154.js"><link rel="prefetch" href="/notes-page/assets/js/66.90a3d007.js"><link rel="prefetch" href="/notes-page/assets/js/67.3f90464a.js"><link rel="prefetch" href="/notes-page/assets/js/68.ef1349b2.js"><link rel="prefetch" href="/notes-page/assets/js/69.40998bcf.js"><link rel="prefetch" href="/notes-page/assets/js/7.6a6e8f49.js"><link rel="prefetch" href="/notes-page/assets/js/70.9d84a281.js"><link rel="prefetch" href="/notes-page/assets/js/71.111b46b1.js"><link rel="prefetch" href="/notes-page/assets/js/72.5615311e.js"><link rel="prefetch" href="/notes-page/assets/js/73.372281a7.js"><link rel="prefetch" href="/notes-page/assets/js/74.2fcc982a.js"><link rel="prefetch" href="/notes-page/assets/js/75.34f6a318.js"><link rel="prefetch" href="/notes-page/assets/js/76.369d0d33.js"><link rel="prefetch" href="/notes-page/assets/js/8.2b1695cc.js"><link rel="prefetch" href="/notes-page/assets/js/9.571eaf20.js">
    <link rel="stylesheet" href="/notes-page/assets/css/0.styles.598865a5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes-page/" class="home-link router-link-active"><!----> <span class="site-name">大前端 - 前端高级进阶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Node.js进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/basic/node/" class="sidebar-link">内容介绍</a></li><li><a href="/notes-page/basic/node/01-koa.html" class="sidebar-link">koa(下一代web框架)</a></li><li><a href="/notes-page/basic/node/02-webpack5构建.html" class="sidebar-link">webpack5构建加持</a></li><li><a href="/notes-page/basic/node/03-项目规范及工具.html" class="sidebar-link">项目规范及工具</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>TypeScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/basic/ts/" class="sidebar-link">概念</a></li><li><a href="/notes-page/basic/ts/01-环境配置.html" class="sidebar-link">环境配置</a></li><li><a href="/notes-page/basic/ts/02-基础语法.html" class="sidebar-link">基础用法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>mongoDB</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/basic/mongo/" aria-current="page" class="sidebar-link">认识 MongoDB</a></li><li><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html" class="active sidebar-link">创建用户并分配权限</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#角色说明" class="sidebar-link">角色说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#数据库用户角色-database-user-roles-常用" class="sidebar-link">数据库用户角色(Database User Roles) - 常用</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#数据库管理角色-database-administration-roles-常用" class="sidebar-link">数据库管理角色(Database Administration Roles) - 常用</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#集群管理角色-cluster-administration-roles" class="sidebar-link">集群管理角色(Cluster Administration Roles)**</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#备份和恢复角色-backup-and-restoration-roles-常用" class="sidebar-link">备份和恢复角色(Backup and Restoration Roles) - 常用</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#全数据库级角色-all-database-roles" class="sidebar-link">全数据库级角色(All-Database Roles)</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#超级用户角色-superuser-roles" class="sidebar-link">超级用户角色(Superuser Roles)</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#内部角色-internal-role" class="sidebar-link">内部角色(Internal Role)</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#总结说明" class="sidebar-link">总结说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#创建自定义角色" class="sidebar-link">创建自定义角色</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#查看环境" class="sidebar-link">查看环境</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#查看自定义的角色" class="sidebar-link">查看自定义的角色</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#更新自定义的角色" class="sidebar-link">更新自定义的角色</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#添加角色权限" class="sidebar-link">添加角色权限</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#删除角色" class="sidebar-link">删除角色</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#创建用户并分配角色" class="sidebar-link">创建用户并分配角色</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#查看用户信息" class="sidebar-link">查看用户信息</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#为用户添加角色" class="sidebar-link">为用户添加角色</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#删除用户" class="sidebar-link">删除用户</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#更改用户密码" class="sidebar-link">更改用户密码</a></li><li class="sidebar-sub-header"><a href="/notes-page/basic/mongo/01-创建用户并分配权限.html#开启mongodb的访问控制" class="sidebar-link">开启MongoDB的访问控制</a></li></ul></li><li><a href="/notes-page/basic/mongo/01.1连接MongoDB.html" class="sidebar-link">MongoDB交互终端</a></li><li><a href="/notes-page/basic/mongo/02-基础操作.html" class="sidebar-link">基本操作</a></li><li><a href="/notes-page/basic/mongo/03-高级查询.html" class="sidebar-link">高级查询</a></li><li><a href="/notes-page/basic/mongo/04-复制集.html" class="sidebar-link">复制集</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="创建用户并分配权限"><a href="#创建用户并分配权限" class="header-anchor">#</a> 创建用户并分配权限</h1> <p><a href="https://docs.mongodb.com/manual/core/authentication/" target="_blank" rel="noopener noreferrer">参考官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="角色说明"><a href="#角色说明" class="header-anchor">#</a> 角色说明</h2> <p>以下是MongoDB中内置的角色：</p> <h3 id="数据库用户角色-database-user-roles-常用"><a href="#数据库用户角色-database-user-roles-常用" class="header-anchor">#</a> <strong>数据库用户角色(Database User Roles) - 常用</strong></h3> <ul><li><strong>read</strong></li></ul> <p>read角色包含读取所有非系统集合数据和订阅部分系统集合(system.indexes、system.js、system.namespaces)的权限。</p> <p>该角色权限包含命令操作：changeStream、collStats、dbHash、dbStats、find、killCursors、listIndexes、listCollections。</p> <ul><li><strong>readWrite</strong></li></ul> <p>readWrite角色包含read角色的权限同时增加了对非系统集合数据的修改权限，但只对系统集合system.js有修改权限。</p> <p>该角色权限包含命令操作：collStats、convertToCapped、createCollection、dbHash、dbStats、dropCollection、createIndex、dropIndex、find、insert、killCursors、listIndexes、listCollections、remove、renameCollectionSameDB、update。</p> <h3 id="数据库管理角色-database-administration-roles-常用"><a href="#数据库管理角色-database-administration-roles-常用" class="header-anchor">#</a> <strong>数据库管理角色(Database Administration Roles) - 常用</strong></h3> <ul><li><strong>dbAdmin</strong></li></ul> <p>dbAdmin角色包含执行某些管理任务(与schema相关、索引、收集统计信息)的权限，该角色不包含用户和角色管理的权限。</p> <p>对于系统集合(system.indexes、system.namespaces、system.profile)包含命令操作：collStats、dbHash、dbStats、find、killCursors、listIndexes、listCollections、dropCollection and createCollection(仅适用system.profile)</p> <p>对于非系统集合包含命令操作：bypassDocumentValidation、collMod、collStats、compact、convertToCapped、createCollection、createIndex、dbStats、dropCollection、dropDatabase、dropIndex、enableProfiler、reIndex、renameCollectionSameDB、repairDatabase、storageDetails、validate</p> <ul><li><strong>dbOwner</strong></li></ul> <p>dbOwner角色包含对数据所有的管理操作权限。即包含角色readWrite、dbAdmin和userAdmin的权限。</p> <ul><li><strong>userAdmin</strong></li></ul> <p>userAdmin角色包含对当前数据库创建和修改角色和用户的权限。该角色允许向其它任何用户(包括自身)授予任何权限，所以这个角色也提供间接对超级用户(root)的访问权限，如果限定在admin数据中，也包括集群管理的权限。</p> <p>该角色权限包含命令操作：changeCustomData、changePassword、createRole、createUser、dropRole、dropUser、grantRole、revokeRole、setAuthenticationRestriction、viewRole、viewUser。</p> <h3 id="集群管理角色-cluster-administration-roles"><a href="#集群管理角色-cluster-administration-roles" class="header-anchor">#</a> 集群管理角色(Cluster Administration Roles)**</h3> <ul><li><strong>clusterManager</strong></li></ul> <p>clusterManager角色包含对集群监控和管理操作的权限。拥有此角色的用户能够访问集群中的config数据库和local数据库。</p> <p>对于整个集群该角色包含命令操作：addShard、appendOplogNote、applicationMessage、cleanupOrphaned、flushRouterConfig、listSessions (3.6新增)、listShards、removeShard、replSetConfigure、replSetGetConfig、replSetGetStatus、replSetStateChange、resync。</p> <p>对于集群中所有的数据库包含命令操作：enableSharding、moveChunk、splitChunk、splitVector。</p> <p>对于集群中config数据库和local数据库包含的命令操作可以参考官方文档：<a href="https://docs.mongodb.com/manual/reference/built-in-roles/#clusterManager" target="_blank" rel="noopener noreferrer"><strong>https://docs.mongodb.com/manual/reference/built-in-roles/#clusterManager</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <ul><li><strong>clusterMonitor</strong></li></ul> <p>clusterMonitor角色包含针对监控工具具有只读操作的权限。如工具<strong>MongoDB Cloud Manager</strong>和工具<strong>Ops Manager</strong>。</p> <p>对于整个集群该角色包含命令操作：checkFreeMonitoringStatus(4.0新增)、connPoolStats、getCmdLineOpts、getLog、getParameter、getShardMap、hostInfo、inprog、listDatabases、listSessions (3.6新增)、listShards、netstat、replSetGetConfig、replSetGetStatus、serverStatus、setFreeMonitoring (4.0新增)、shardingState、top。</p> <p>对于集群中所有的数据为包含命令操作：collStats、dbStats、getShardVersion、indexStats、useUUID(3.6新增)。</p> <p>对于集群中config数据库和local数据库包含的命令操作可以参考官方文档：<a href="https://docs.mongodb.com/manual/reference/built-in-roles/#clusterMonitor" target="_blank" rel="noopener noreferrer"><strong>https://docs.mongodb.com/manual/reference/built-in-roles/#clusterMonitor</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <ul><li><strong>hostManager</strong></li></ul> <p>hostManager角色包含针对数据库服务器的监控和管理操作权限。</p> <p>对于整个集群该角色包含命令操作：applicationMessage、closeAllDatabases、connPoolSync、cpuProfiler、flushRouterConfig、fsync、invalidateUserCache、killAnyCursor (4.0新增)、killAnySession (3.6新增)、killop、logRotate、resync、setParameter、shutdown、touch、unlock。</p> <p>对于集群中所有的数据库包含命令操作：killCursors、repairDatabase。</p> <ul><li><strong>clusterAdmin</strong></li></ul> <p>clusterAdmin角色包含MongoDB集群管理最高的操作权限。该角色包含<strong>clusterManager</strong>、<strong>clusterMonitor</strong>和<strong>hostManager</strong>三个角色的所有权限，并且还拥有dropDatabase操作命令的权限。</p> <h3 id="备份和恢复角色-backup-and-restoration-roles-常用"><a href="#备份和恢复角色-backup-and-restoration-roles-常用" class="header-anchor">#</a> <strong>备份和恢复角色(Backup and Restoration Roles) - 常用</strong></h3> <ul><li><strong>backup</strong></li></ul> <p>backup角色包含备份MongoDB数据最小的权限。</p> <p>对于MongoDB中所有的数据库资源包含命令操作：listDatabases、listCollections、listIndexes。</p> <p>对于整个集群包含命令操作：appendOplogNote、getParameter、listDatabases。</p> <p>对于以下数据库资源提供find操作权限：</p> <ol><li>对于集群中的所有非系统集合，包括自身的config数据库和local数据库；</li> <li>对于集群中的系统集合：system.indexes、system.namespaces、system.js和system.profile；</li> <li>admin数据库中的集合：admin.system.users和admin.system.roles；</li> <li>config.settings集合；</li> <li>2.6版本之前的system.users集合。</li></ol> <p>对于config.setting集合还有insert和update操作权限。</p> <ul><li><strong>restore</strong></li></ul> <p>restore角色包含从备份文件中还原恢复MongoDB数据(除了system.profile集合)的权限。</p> <p>restore角色有以下注意事项：</p> <ol><li>如果备份中包含system.profile集合而恢复目标数据库没有system.profile集合，mongorestore会尝试重建该集合。因此执行用户需要有额外针对system.profile集合的createCollection和convertToCapped操作权限；</li> <li>如果执行mongorestore命令时指定选项<code>--oplogReplay</code>，则restore角色包含的权限无法进行重放oplog。如果需要进行重放oplog，则需要只对执行mongorestore的用户授予包含对实例中任何资源具有任何权限的自定义角色。</li></ol> <p>对于整个集群包含命令操作：getParameter。</p> <p>对于所有非系统集合包含命令操作：bypassDocumentValidation、changeCustomData、changePassword、collMod、convertToCapped、createCollection、createIndex、createRole、createUser、dropCollection、dropRole、dropUser、grantRole、insert、revokeRole、viewRole、viewUser。</p> <p>关于restore角色包含其它的命令操作可以参考官方文档：<a href="https://docs.mongodb.com/manual/reference/built-in-roles/#restore" target="_blank" rel="noopener noreferrer"><strong>https://docs.mongodb.com/manual/reference/built-in-roles/#restore</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="全数据库级角色-all-database-roles"><a href="#全数据库级角色-all-database-roles" class="header-anchor">#</a> <strong>全数据库级角色(All-Database Roles)</strong></h3> <p>以下角色只存在于admin数据库，并且适用于除了config和local之外所有的数据库。</p> <ul><li><strong>readAnyDatabase</strong></li></ul> <p>readAnyDatabase角色包含对除了config和local之外所有数据库的只读权限。同时对于整个集群包含listDatabases命令操作。</p> <p>在MongoDB3.4版本之前，该角色包含对config和local数据库的读取权限。当前版本如果需要对这两个数据库进行读取，则需要在admin数据库授予用户对这两个数据库的read角色。</p> <ul><li><strong>readWriteAnyDatabase</strong></li></ul> <p>readWriteAnyDatabase角色包含对除了config和local之外所有数据库的读写权限。同时对于整个集群包含listDatabases命令操作。</p> <p>在MongoDB3.4版本之前，该角色包含对config和local数据库的读写权限。当前版本如果需要对这两个数据库进行读写，则需要在admin数据库授予用户对这两个数据库的readWrite角色。</p> <ul><li><strong>userAdminAnyDatabase</strong></li></ul> <p>userAdminAnyDatabase角色包含类似于userAdmin角色对于所有数据库的用户管理权限，除了config数据库和local数据库。</p> <p>对于集群包含命令操作：authSchemaUpgrade、invalidateUserCache、listDatabases。</p> <p>对于系统集合admin.system.users和admin.system.roles包含命令操作：collStats、dbHash、dbStats、find、killCursors、planCacheRead、createIndex、dropIndex。</p> <p>该角色不会限制用户授予权限的操作，因此，拥有角色的用户也有可能授予超过角色范围内的权限给自己或其它用户，也可以使自己成为超级用户，<strong>userAdminAnyDatabase</strong>角色也可以认为是MongoDB中的超级用户角色。</p> <ul><li><strong>dbAdminAnyDatabase</strong></li></ul> <p>dbAdminAnyDatabase角色包含类似于dbAdmin角色对于所有数据库管理权限，除了config数据库和local数据库。同时对于整个集群包含listDatabases命令操作。</p> <p>在MongoDB3.4版本之前，该角色包含对config和local数据库的管理权限。当前版本如果需要对这两个数据库进行管理，则需要在admin数据库授予用户对这两个数据库的dbAdmin角色。</p> <h3 id="超级用户角色-superuser-roles"><a href="#超级用户角色-superuser-roles" class="header-anchor">#</a> <strong>超级用户角色(Superuser Roles)</strong></h3> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>慎用</p></div> <p>以下角色包含在任何数据库授予任何用户任何权限的权限。这意味着用户如果有以下角色之一可以为自己在任何数据库授予任何权限。</p> <ul><li>dbOwner角色(作用范围为admin数据库)</li> <li>userAdmin角色(作用范围为admin数据库)</li> <li>userAdminAnyDatabase角色</li></ul> <p>以下角色包含数据库所有资源的所有操作权限。</p> <ul><li><strong>root</strong></li></ul> <p>root角色包含角色readWriteAnyDatabase、dbAdminAnyDatabase、userAdminAnyDatabase、clusterAdmin、restore和backup联合之后所有的权限。</p> <h3 id="内部角色-internal-role"><a href="#内部角色-internal-role" class="header-anchor">#</a> <strong>内部角色(Internal Role)</strong></h3> <ul><li><strong>__system</strong></li></ul> <p>MongoDB将此角色授予代表集群成员的用户对象，如副本集(replica set)成员或<strong>mongos</strong>实例。该角色允许用户对于需要的数据库操作都具有相应的权限，不要将该角色授予应用程序用户或其它管理员用户。</p> <h3 id="总结说明"><a href="#总结说明" class="header-anchor">#</a> 总结说明</h3> <p>通过以上对内置角色的说明，总结一下较为常用的内置角色，如下表：</p> <table><thead><tr><th>角色</th> <th>权限描述</th></tr></thead> <tbody><tr><td>read</td> <td>可以读取指定数据库中任何数据。</td></tr> <tr><td>readWrite</td> <td>可以读写指定数据库中任何数据，包括创建、重命名、删除集合。</td></tr> <tr><td>readAnyDatabase</td> <td>可以读取所有数据库中任何数据(除了数据库config和local之外)。</td></tr> <tr><td>readWriteAnyDatabase</td> <td>可以读写所有数据库中任何数据(除了数据库config和local之外)。</td></tr> <tr><td>dbAdmin</td> <td>可以读取指定数据库以及对数据库进行清理、修改、压缩、获取统计信息、执行检查等操作。</td></tr> <tr><td>dbAdminAnyDatabase</td> <td>可以读取任何数据库以及对数据库进行清理、修改、压缩、获取统计信息、执行检查等操作(除了数据库config和local之外)。</td></tr> <tr><td>clusterAdmin</td> <td>可以对整个集群或数据库系统进行管理操作。</td></tr> <tr><td>userAdmin</td> <td>可以在指定数据库创建和修改用户。</td></tr> <tr><td>userAdminAnyDatabase</td> <td>可以在指定数据库创建和修改用户(除了数据库config和local之外)。</td></tr></tbody></table> <h2 id="创建自定义角色"><a href="#创建自定义角色" class="header-anchor">#</a> 创建自定义角色</h2> <h3 id="查看环境"><a href="#查看环境" class="header-anchor">#</a> 查看环境</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这里要注意<code>imooc</code>用户是<code>imooc</code>数据库的<code>imooc</code>角色</p></div> <div class="language- extra-class"><pre class="language-text"><code>&gt; show dbs;
admin   0.000GB
config  0.000GB
imooc   0.001GB
local   0.000GB

&gt; use imooc;
switched to db imooc
</code></pre></div><p>目前的权限情况</p> <div class="language- extra-class"><pre class="language-text"><code>&gt; db.createRole(
    {
        role: &quot;imooc&quot;,
        privileges: [
            { resource: { db: &quot;imooc&quot;, collection: &quot;users&quot; }, actions: [&quot;find&quot;, &quot;update&quot;] },
            { resource: { db: &quot;imooc&quot;, collection: &quot;rights&quot; }, actions: [&quot;find&quot;] },
        ],
        roles: []
    }
)

或

&gt; db.adminCommand(
    {
        createRole: &quot;imooc&quot;,
        privileges: [
            { resource: { db: &quot;imooc&quot;, collection: &quot;users&quot; }, actions: [&quot;find&quot;, &quot;update&quot;] },
            { resource: { db: &quot;imooc&quot;, collection: &quot;rights&quot; }, actions: [&quot;find&quot;] }
        ],
        roles: []
    }
</code></pre></div><h3 id="查看自定义的角色"><a href="#查看自定义的角色" class="header-anchor">#</a> 查看自定义的角色</h3> <div class="language- extra-class"><pre class="language-text"><code>&gt; db.getRole(&quot;imooc&quot;, { showPrivileges: true })

// 或

&gt; db.getRoles({ rolesInfo: 1, showPrivileges: true })

// 或

&gt; use admin
&gt; db.runCommand(
    {
        rolesInfo: { role: &quot;imooc&quot;, db: &quot;admin&quot; },
        showPrivileges: true
    }
)
</code></pre></div><h3 id="更新自定义的角色"><a href="#更新自定义的角色" class="header-anchor">#</a> 更新自定义的角色</h3> <p>为自定义角色imooc更新集合imooc.rights的insert权限。</p> <div class="language- extra-class"><pre class="language-text"><code>&gt; db.updateRole(
    &quot;imooc&quot;,
    {
        privileges: [
            { resource: { db: &quot;imooc&quot;, collection: &quot;users&quot; }, actions: [&quot;find&quot;, &quot;update&quot;] },
            { resource: { db: &quot;imooc&quot;, collection: &quot;rights&quot; }, actions: [&quot;find&quot;, &quot;insert&quot;] }
        ],
        roles: []
    }
)

// 或

&gt; db.adminCommand(
    {
        updateRole: &quot;imooc&quot;,
        privileges: [
            { resource: { db: &quot;imooc&quot;, collection: &quot;users&quot; }, actions: [&quot;find&quot;, &quot;update&quot;] },
            { resource: { db: &quot;imooc&quot;, collection: &quot;rights&quot; }, actions: [&quot;find&quot;, &quot;insert&quot;] }
        ],
        roles: []
    }
)
</code></pre></div><h3 id="添加角色权限"><a href="#添加角色权限" class="header-anchor">#</a> 添加角色权限</h3> <p>为自定义角色imooc添加集合imooc.rights的remove权限。</p> <div class="language- extra-class"><pre class="language-text"><code>db.grantPrivilegesToRole(
    &quot;imooc&quot;,
    [
        { resource: { db: &quot;imooc&quot;, collection: &quot;rights&quot; }, actions: [&quot;remove&quot;] }
    ]
)

// 或

&gt; use admin
&gt; db.runCommand(
    {
        grantPrivilegesToRole: &quot;imooc&quot;,
        privileges: [
            { resource: { db: &quot;imooc&quot;, collection: &quot;rights&quot; }, actions: [&quot;remove&quot;] }
        ]
    }
)
</code></pre></div><h3 id="删除角色"><a href="#删除角色" class="header-anchor">#</a> 删除角色</h3> <p>为自定义角色imooc收回集合imooc.users的update权限。</p> <div class="language- extra-class"><pre class="language-text"><code>&gt; db.revokePrivilegesFromRole(
    &quot;imooc&quot;, 
    [
        { resource: { db: &quot;imooc&quot;, collection: &quot;users&quot; }, actions: [&quot;update&quot;] }
    ]
)

或

&gt; use admin
&gt; db.runCommand(
    { 
        revokePrivilegesFromRole: &quot;imooc&quot;, 
        privileges: [
            { resource: { db: &quot;imooc&quot;, collection: &quot;users&quot; }, actions: [&quot;update&quot;] }
        ] 
    }
)
</code></pre></div><h2 id="创建用户并分配角色"><a href="#创建用户并分配角色" class="header-anchor">#</a> 创建用户并分配角色</h2> <div class="language- extra-class"><pre class="language-text"><code>use imooc

db.createUser(
  {
    user: &quot;admin&quot;,
    pwd: &quot;123456&quot;,
    roles: [ { role: &quot;dbOwner&quot;, db: &quot;imooc&quot; } ]
  }
)
</code></pre></div><h3 id="查看用户信息"><a href="#查看用户信息" class="header-anchor">#</a> 查看用户信息</h3> <div class="language- extra-class"><pre class="language-text"><code>&gt; use imooc
&gt; db.getUser(&quot;admin&quot;, { showPrivileges: true })

// 或

&gt; db.getSiblingDB(&quot;imooc&quot;).runCommand(
    {
        usersInfo: &quot;admin&quot;,
        showPrivileges: true

    }
)
</code></pre></div><h3 id="为用户添加角色"><a href="#为用户添加角色" class="header-anchor">#</a> 为用户添加角色</h3> <div class="language- extra-class"><pre class="language-text"><code>&gt; use imooc
&gt; db.grantRolesToUser(
    &quot;admin&quot;,
    [
        { role: &quot;dbOwner&quot;, db: &quot;imooc&quot; }
    ]
)

// 或

&gt; use imooc
&gt; db.runCommand(
    {
        grantRolesToUser: &quot;admin&quot;,
        roles:
            [
                { role: &quot;dbOwner&quot;, db: &quot;imooc&quot; }
            ]
    }
)
</code></pre></div><h3 id="删除用户"><a href="#删除用户" class="header-anchor">#</a> 删除用户</h3> <div class="language- extra-class"><pre class="language-text"><code>&gt; use imooc
&gt; db.dropUser(&quot;admin&quot;)
</code></pre></div><h2 id="更改用户密码"><a href="#更改用户密码" class="header-anchor">#</a> 更改用户密码</h2> <div class="language- extra-class"><pre class="language-text"><code>&gt; use imooc
&gt; db.changeUserPassword(&quot;admin&quot;, &quot;long-random-password&quot;)
</code></pre></div><h2 id="开启mongodb的访问控制"><a href="#开启mongodb的访问控制" class="header-anchor">#</a> 开启MongoDB的访问控制</h2> <p>要开启访问控制，则需要在mongod进程启动时加上选项<code>--auth</code>或在启动配置文件加入选项<code>auth=true</code>，并重启mongodb实例（使用docker开启的同学不用管）</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">## mongod配置文件如下</span>
<span class="token comment"># cat mongodb.cnf </span>
<span class="token assign-left variable">journal</span><span class="token operator">=</span>true
<span class="token assign-left variable">dbpath</span><span class="token operator">=</span>/data/mongodb/4.0/data
<span class="token assign-left variable">directoryperdb</span><span class="token operator">=</span>true
<span class="token assign-left variable">fork</span><span class="token operator">=</span>true
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">27017</span>
<span class="token assign-left variable">logpath</span><span class="token operator">=</span>/data/mongodb/4.0/logs/mongodb.log
<span class="token assign-left variable">quiet</span><span class="token operator">=</span>true
<span class="token assign-left variable">bind_ip_all</span><span class="token operator">=</span>true
<span class="token assign-left variable">auth</span><span class="token operator">=</span>true

<span class="token comment">## 启动mongodb实例</span>
<span class="token comment"># mongod -f mongodb.cnf </span>
about to fork child process, waiting <span class="token keyword">until</span> server is ready <span class="token keyword">for</span> connections.
forked process: <span class="token number">44347</span>
child process started successfully, parent exiting
</code></pre></div></div> <!----> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes-page/basic/mongo/" class="prev router-link-active">
        认识 MongoDB
      </a></span> <span class="next"><a href="/notes-page/basic/mongo/01.1连接MongoDB.html">
        MongoDB交互终端
      </a>
      →
    </span></p></div>  <div class="el-dialog__wrapper" style="display:none;"><div role="dialog" aria-modal="true" aria-label="dialog" class="el-dialog" style="margin-top:15vh;width:420px;"><div class="el-dialog__header"><span class="el-dialog__title"></span><button type="button" aria-label="Close" class="el-dialog__headerbtn"><i class="el-dialog__close el-icon el-icon-close"></i></button></div><!----><div class="el-dialog__footer"><span class="dialog-footer"><button type="button" class="el-button el-button--default"><!----><!----><span>取 消</span></button> <button type="button" class="el-button el-button--primary"><!----><!----><span>确 定</span></button></span></div></div></div></main> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/notes-page/assets/js/app.cefaabaf.js" defer></script><script src="/notes-page/assets/js/4.6a7e0344.js" defer></script><script src="/notes-page/assets/js/5.e265b4d0.js" defer></script><script src="/notes-page/assets/js/43.3e75f996.js" defer></script>
  </body>
</html>
