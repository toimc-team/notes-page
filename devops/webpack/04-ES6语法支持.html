<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Babel核心知识 | 大前端 - 前端高级进阶</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?a3eb4e78079a2cf44a356937cf1b09b3";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
      </script>
    <meta name="description" content="大前端课程电子书">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/notes-page/assets/css/0.styles.ee344319.css" as="style"><link rel="preload" href="/notes-page/assets/js/app.27e1836e.js" as="script"><link rel="preload" href="/notes-page/assets/js/8.917fc4fb.js" as="script"><link rel="preload" href="/notes-page/assets/js/72.f207f71e.js" as="script"><link rel="prefetch" href="/notes-page/assets/js/1.8be2b47d.js"><link rel="prefetch" href="/notes-page/assets/js/10.e9112599.js"><link rel="prefetch" href="/notes-page/assets/js/100.5bab81a2.js"><link rel="prefetch" href="/notes-page/assets/js/101.e1fd2fe8.js"><link rel="prefetch" href="/notes-page/assets/js/102.fca07b94.js"><link rel="prefetch" href="/notes-page/assets/js/103.ff1a57fc.js"><link rel="prefetch" href="/notes-page/assets/js/104.7a12e926.js"><link rel="prefetch" href="/notes-page/assets/js/105.193ecb6e.js"><link rel="prefetch" href="/notes-page/assets/js/106.9d2c4d6e.js"><link rel="prefetch" href="/notes-page/assets/js/107.b83ec821.js"><link rel="prefetch" href="/notes-page/assets/js/108.59e4e043.js"><link rel="prefetch" href="/notes-page/assets/js/109.f0f5b1dc.js"><link rel="prefetch" href="/notes-page/assets/js/11.88883e8b.js"><link rel="prefetch" href="/notes-page/assets/js/110.9b74a796.js"><link rel="prefetch" href="/notes-page/assets/js/111.6ece6d6c.js"><link rel="prefetch" href="/notes-page/assets/js/112.c2c950f0.js"><link rel="prefetch" href="/notes-page/assets/js/113.e1b1eb61.js"><link rel="prefetch" href="/notes-page/assets/js/114.c5a1e4e3.js"><link rel="prefetch" href="/notes-page/assets/js/115.69f968e1.js"><link rel="prefetch" href="/notes-page/assets/js/116.4eea6333.js"><link rel="prefetch" href="/notes-page/assets/js/117.d1f32ee8.js"><link rel="prefetch" href="/notes-page/assets/js/118.bdcb2866.js"><link rel="prefetch" href="/notes-page/assets/js/119.58020ac1.js"><link rel="prefetch" href="/notes-page/assets/js/12.be165570.js"><link rel="prefetch" href="/notes-page/assets/js/120.f48a562d.js"><link rel="prefetch" href="/notes-page/assets/js/121.0b311f2a.js"><link rel="prefetch" href="/notes-page/assets/js/122.7bcc9bdc.js"><link rel="prefetch" href="/notes-page/assets/js/123.9198d499.js"><link rel="prefetch" href="/notes-page/assets/js/124.bafcfd3e.js"><link rel="prefetch" href="/notes-page/assets/js/125.90b4cbab.js"><link rel="prefetch" href="/notes-page/assets/js/126.768004ff.js"><link rel="prefetch" href="/notes-page/assets/js/127.07813fd0.js"><link rel="prefetch" href="/notes-page/assets/js/128.346f38c2.js"><link rel="prefetch" href="/notes-page/assets/js/129.5b848f83.js"><link rel="prefetch" href="/notes-page/assets/js/13.0caf625f.js"><link rel="prefetch" href="/notes-page/assets/js/130.ba36aa1b.js"><link rel="prefetch" href="/notes-page/assets/js/131.f750d1ee.js"><link rel="prefetch" href="/notes-page/assets/js/132.3cc62bb9.js"><link rel="prefetch" href="/notes-page/assets/js/133.379b1377.js"><link rel="prefetch" href="/notes-page/assets/js/134.0d1032b9.js"><link rel="prefetch" href="/notes-page/assets/js/135.ab1f6c92.js"><link rel="prefetch" href="/notes-page/assets/js/136.441ab980.js"><link rel="prefetch" href="/notes-page/assets/js/137.6e2aa994.js"><link rel="prefetch" href="/notes-page/assets/js/138.689111d5.js"><link rel="prefetch" href="/notes-page/assets/js/139.74d5cfe3.js"><link rel="prefetch" href="/notes-page/assets/js/14.1966d929.js"><link rel="prefetch" href="/notes-page/assets/js/140.2a5b6f88.js"><link rel="prefetch" href="/notes-page/assets/js/141.081f1782.js"><link rel="prefetch" href="/notes-page/assets/js/142.796a5c8d.js"><link rel="prefetch" href="/notes-page/assets/js/143.ab719a58.js"><link rel="prefetch" href="/notes-page/assets/js/144.8f726350.js"><link rel="prefetch" href="/notes-page/assets/js/145.c26cb098.js"><link rel="prefetch" href="/notes-page/assets/js/146.3053a7d6.js"><link rel="prefetch" href="/notes-page/assets/js/147.56053db4.js"><link rel="prefetch" href="/notes-page/assets/js/148.7fbf0128.js"><link rel="prefetch" href="/notes-page/assets/js/149.0bc3129f.js"><link rel="prefetch" href="/notes-page/assets/js/15.be14decb.js"><link rel="prefetch" href="/notes-page/assets/js/150.f529865f.js"><link rel="prefetch" href="/notes-page/assets/js/151.24ce7838.js"><link rel="prefetch" href="/notes-page/assets/js/152.d8259881.js"><link rel="prefetch" href="/notes-page/assets/js/153.59942f08.js"><link rel="prefetch" href="/notes-page/assets/js/154.21077ef3.js"><link rel="prefetch" href="/notes-page/assets/js/155.64fd69b9.js"><link rel="prefetch" href="/notes-page/assets/js/156.5b70229f.js"><link rel="prefetch" href="/notes-page/assets/js/157.39d055d4.js"><link rel="prefetch" href="/notes-page/assets/js/158.064bdb24.js"><link rel="prefetch" href="/notes-page/assets/js/159.9fdadc70.js"><link rel="prefetch" href="/notes-page/assets/js/16.a915b608.js"><link rel="prefetch" href="/notes-page/assets/js/160.f0d5b8d0.js"><link rel="prefetch" href="/notes-page/assets/js/161.8dd9174c.js"><link rel="prefetch" href="/notes-page/assets/js/162.dc974d83.js"><link rel="prefetch" href="/notes-page/assets/js/163.b41cbb03.js"><link rel="prefetch" href="/notes-page/assets/js/164.431fe799.js"><link rel="prefetch" href="/notes-page/assets/js/165.46c5ed89.js"><link rel="prefetch" href="/notes-page/assets/js/166.e1e9273f.js"><link rel="prefetch" href="/notes-page/assets/js/167.8367cd36.js"><link rel="prefetch" href="/notes-page/assets/js/168.18683601.js"><link rel="prefetch" href="/notes-page/assets/js/169.dd349227.js"><link rel="prefetch" href="/notes-page/assets/js/17.5796eca5.js"><link rel="prefetch" href="/notes-page/assets/js/170.83ba80e3.js"><link rel="prefetch" href="/notes-page/assets/js/171.435de347.js"><link rel="prefetch" href="/notes-page/assets/js/172.6a537a3e.js"><link rel="prefetch" href="/notes-page/assets/js/173.b9609f4b.js"><link rel="prefetch" href="/notes-page/assets/js/174.7b33b192.js"><link rel="prefetch" href="/notes-page/assets/js/175.e7f49755.js"><link rel="prefetch" href="/notes-page/assets/js/176.d42b9f48.js"><link rel="prefetch" href="/notes-page/assets/js/177.35c10167.js"><link rel="prefetch" href="/notes-page/assets/js/178.25310533.js"><link rel="prefetch" href="/notes-page/assets/js/179.206221ad.js"><link rel="prefetch" href="/notes-page/assets/js/18.72b0a7b7.js"><link rel="prefetch" href="/notes-page/assets/js/180.95f72925.js"><link rel="prefetch" href="/notes-page/assets/js/181.e712301c.js"><link rel="prefetch" href="/notes-page/assets/js/182.a7cd28c6.js"><link rel="prefetch" href="/notes-page/assets/js/183.f917d6b3.js"><link rel="prefetch" href="/notes-page/assets/js/184.268456f6.js"><link rel="prefetch" href="/notes-page/assets/js/19.07a894c1.js"><link rel="prefetch" href="/notes-page/assets/js/20.a09b442d.js"><link rel="prefetch" href="/notes-page/assets/js/21.877753bc.js"><link rel="prefetch" href="/notes-page/assets/js/22.2dd71624.js"><link rel="prefetch" href="/notes-page/assets/js/23.ce8bbc44.js"><link rel="prefetch" href="/notes-page/assets/js/24.c5f5ec11.js"><link rel="prefetch" href="/notes-page/assets/js/25.bfce890a.js"><link rel="prefetch" href="/notes-page/assets/js/26.34713405.js"><link rel="prefetch" href="/notes-page/assets/js/27.f606e580.js"><link rel="prefetch" href="/notes-page/assets/js/28.321e047b.js"><link rel="prefetch" href="/notes-page/assets/js/29.f4dfe750.js"><link rel="prefetch" href="/notes-page/assets/js/30.75bd8088.js"><link rel="prefetch" href="/notes-page/assets/js/31.b85b49c2.js"><link rel="prefetch" href="/notes-page/assets/js/32.e27bd95e.js"><link rel="prefetch" href="/notes-page/assets/js/33.158797a8.js"><link rel="prefetch" href="/notes-page/assets/js/34.94a2dfdc.js"><link rel="prefetch" href="/notes-page/assets/js/35.c879fc20.js"><link rel="prefetch" href="/notes-page/assets/js/36.5854b627.js"><link rel="prefetch" href="/notes-page/assets/js/37.83cde6d4.js"><link rel="prefetch" href="/notes-page/assets/js/38.f2cd45e2.js"><link rel="prefetch" href="/notes-page/assets/js/39.f7381b1d.js"><link rel="prefetch" href="/notes-page/assets/js/40.bacdeb97.js"><link rel="prefetch" href="/notes-page/assets/js/41.d1572e6b.js"><link rel="prefetch" href="/notes-page/assets/js/42.99e5d0f0.js"><link rel="prefetch" href="/notes-page/assets/js/43.ed123815.js"><link rel="prefetch" href="/notes-page/assets/js/44.766c3ea6.js"><link rel="prefetch" href="/notes-page/assets/js/45.2fc69451.js"><link rel="prefetch" href="/notes-page/assets/js/46.d1c86f91.js"><link rel="prefetch" href="/notes-page/assets/js/47.5627f6b9.js"><link rel="prefetch" href="/notes-page/assets/js/48.6c6b7de1.js"><link rel="prefetch" href="/notes-page/assets/js/49.28a0284a.js"><link rel="prefetch" href="/notes-page/assets/js/50.95f20324.js"><link rel="prefetch" href="/notes-page/assets/js/51.90b502dd.js"><link rel="prefetch" href="/notes-page/assets/js/52.71c707ff.js"><link rel="prefetch" href="/notes-page/assets/js/53.ce562e54.js"><link rel="prefetch" href="/notes-page/assets/js/54.8b8c29e0.js"><link rel="prefetch" href="/notes-page/assets/js/55.d4dd0b4e.js"><link rel="prefetch" href="/notes-page/assets/js/56.5f12450c.js"><link rel="prefetch" href="/notes-page/assets/js/57.8668faab.js"><link rel="prefetch" href="/notes-page/assets/js/58.d445d2a4.js"><link rel="prefetch" href="/notes-page/assets/js/59.413d47d1.js"><link rel="prefetch" href="/notes-page/assets/js/6.c5229510.js"><link rel="prefetch" href="/notes-page/assets/js/60.296ea60e.js"><link rel="prefetch" href="/notes-page/assets/js/61.36dba552.js"><link rel="prefetch" href="/notes-page/assets/js/62.b5a800c0.js"><link rel="prefetch" href="/notes-page/assets/js/63.ebeba5e0.js"><link rel="prefetch" href="/notes-page/assets/js/64.f6321c62.js"><link rel="prefetch" href="/notes-page/assets/js/65.f9c9ba70.js"><link rel="prefetch" href="/notes-page/assets/js/66.75c618eb.js"><link rel="prefetch" href="/notes-page/assets/js/67.f517bcbd.js"><link rel="prefetch" href="/notes-page/assets/js/68.887a6891.js"><link rel="prefetch" href="/notes-page/assets/js/69.eee75083.js"><link rel="prefetch" href="/notes-page/assets/js/7.1d51e0ed.js"><link rel="prefetch" href="/notes-page/assets/js/70.de35a0e9.js"><link rel="prefetch" href="/notes-page/assets/js/71.d78f2b63.js"><link rel="prefetch" href="/notes-page/assets/js/73.8417064f.js"><link rel="prefetch" href="/notes-page/assets/js/74.de515eb4.js"><link rel="prefetch" href="/notes-page/assets/js/75.8017d4e5.js"><link rel="prefetch" href="/notes-page/assets/js/76.45b6a091.js"><link rel="prefetch" href="/notes-page/assets/js/77.c0da53e1.js"><link rel="prefetch" href="/notes-page/assets/js/78.2ba1376e.js"><link rel="prefetch" href="/notes-page/assets/js/79.e5abd06f.js"><link rel="prefetch" href="/notes-page/assets/js/80.a41cc70c.js"><link rel="prefetch" href="/notes-page/assets/js/81.c89a0611.js"><link rel="prefetch" href="/notes-page/assets/js/82.ace7003a.js"><link rel="prefetch" href="/notes-page/assets/js/83.64d398b8.js"><link rel="prefetch" href="/notes-page/assets/js/84.ee1bcb01.js"><link rel="prefetch" href="/notes-page/assets/js/85.99945f94.js"><link rel="prefetch" href="/notes-page/assets/js/86.4a3600ea.js"><link rel="prefetch" href="/notes-page/assets/js/87.c94a2b31.js"><link rel="prefetch" href="/notes-page/assets/js/88.256938dd.js"><link rel="prefetch" href="/notes-page/assets/js/89.029f7af5.js"><link rel="prefetch" href="/notes-page/assets/js/9.96dee30a.js"><link rel="prefetch" href="/notes-page/assets/js/90.c1bcaa43.js"><link rel="prefetch" href="/notes-page/assets/js/91.7fcb117d.js"><link rel="prefetch" href="/notes-page/assets/js/92.d278853d.js"><link rel="prefetch" href="/notes-page/assets/js/93.8e00b49b.js"><link rel="prefetch" href="/notes-page/assets/js/94.0fd5f0c1.js"><link rel="prefetch" href="/notes-page/assets/js/95.8f909bda.js"><link rel="prefetch" href="/notes-page/assets/js/96.dd028e5f.js"><link rel="prefetch" href="/notes-page/assets/js/97.1e0ebfb6.js"><link rel="prefetch" href="/notes-page/assets/js/98.5f42305a.js"><link rel="prefetch" href="/notes-page/assets/js/99.f2480896.js"><link rel="prefetch" href="/notes-page/assets/js/vendors~docsearch.9df483b9.js"><link rel="prefetch" href="/notes-page/assets/js/vendors~photo-swipe.da1d5931.js"><link rel="prefetch" href="/notes-page/assets/js/vendors~search-page.2e405e6e.js">
    <link rel="stylesheet" href="/notes-page/assets/css/0.styles.ee344319.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes-page/" class="home-link router-link-active"><!----> <span class="site-name">大前端 - 前端高级进阶</span></a> <div class="links"><div id="docsearch"></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Jenkins</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/devops/jenkins/" class="sidebar-link">介绍&amp;安装</a></li><li><a href="/notes-page/devops/jenkins/01-插件下载.html" class="sidebar-link">插件下载</a></li><li><a href="/notes-page/devops/jenkins/02-权限管理.html" class="sidebar-link">权限管理</a></li><li><a href="/notes-page/devops/jenkins/03-gitee.html" class="sidebar-link">Gitee + Jenkins自动化实战</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/devops/webpack/" aria-current="page" class="sidebar-link">Webpack导学</a></li><li><a href="/notes-page/devops/webpack/01-核心概念.html" class="sidebar-link">核心概念</a></li><li><a href="/notes-page/devops/webpack/02-常见配置.html" class="sidebar-link">常见配置</a></li><li><a href="/notes-page/devops/webpack/03-完整配置.html" class="sidebar-link">完整的配置</a></li><li><a href="/notes-page/devops/webpack/04-ES6语法支持.html" class="active sidebar-link">Babel核心知识</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#什么是-babel" class="sidebar-link">什么是 Babel</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#babel介绍" class="sidebar-link">Babel介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#初体验-环境安装" class="sidebar-link">初体验(环境安装)</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#配置文件" class="sidebar-link">配置文件</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#env-选项" class="sidebar-link">env 选项</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#插件和-preset" class="sidebar-link">插件和 Preset</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#polyfill" class="sidebar-link">polyfill</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#runtime" class="sidebar-link">runtime</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#babel-preset-env" class="sidebar-link">@babel/preset-env</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#babel-plugin-transform-runtime" class="sidebar-link">@babel/plugin-transform-runtime</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#webpack-中使用-babel" class="sidebar-link">Webpack 中使用 Babel</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#babel-原理" class="sidebar-link">Babel 原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#ast" class="sidebar-link">AST</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#遍历" class="sidebar-link">遍历</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#生成" class="sidebar-link">生成</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#babel-插件编写" class="sidebar-link">Babel 插件编写</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#browserslist" class="sidebar-link">Browserslist</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#常见集合范围说明" class="sidebar-link">常见集合范围说明</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#浏览器名称列表-大小写不敏感" class="sidebar-link">浏览器名称列表（大小写不敏感）</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#browserslist-的环境变量" class="sidebar-link">Browserslist 的环境变量</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/04-ES6语法支持.html#babel-polyfill-的最佳实践" class="sidebar-link">Babel Polyfill 的最佳实践</a></li></ul></li><li><a href="/notes-page/devops/webpack/05-webpack模块化.html" class="sidebar-link">模块化</a></li><li><a href="/notes-page/devops/webpack/06-TS&amp;JS处理.html" class="sidebar-link">TS&amp;JS处理</a></li><li><a href="/notes-page/devops/webpack/07-CSS处理.html" class="sidebar-link">CSS处理</a></li><li><a href="/notes-page/devops/webpack/08-HTML.html" class="sidebar-link">HTML处理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>文档管理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/devops/showdoc/" class="sidebar-link">文档管理工具</a></li><li><a href="/notes-page/devops/showdoc/01-静态网站生成工具.html" class="sidebar-link">静态网站生成工具</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="babel核心知识"><a href="#babel核心知识" class="header-anchor">#</a> Babel核心知识</h1> <p>在 webpack 中编写 JavaScript 代码，可以使用最新的 ES 语法，而最终打包的时候，webpack 会借助 Babel 将 ES6+语法转换成在目标浏览器可执行 ES5 语法。所以 Babel 是一个重要的知识点需要掌握。</p> <h2 id="什么是-babel"><a href="#什么是-babel" class="header-anchor">#</a> 什么是 Babel</h2> <p>Babel 是 JavaScript 的编译器，通过 Babel 可以将写的最新 ES 语法的代码轻松转换成任意版本的 JavaScript 语法。随着浏览器逐步支持 ES 标准，不需要改变代码，只需要修改 Babel 配置即可以适配新的浏览器。</p> <p>举例说明，下面是 ES6 箭头函数语法的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=&gt;</span> n <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>经过 Babel 处理后，可以转换为普通的 ES5 语法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="babel介绍"><a href="#babel介绍" class="header-anchor">#</a> Babel介绍</h2> <p>下面来介绍下 Babel 的安装和功能及其配置文件。</p> <h3 id="初体验-环境安装"><a href="#初体验-环境安装" class="header-anchor">#</a> 初体验(环境安装)</h3> <p>使用 babel-cli 命令行工具</p> <p>Babel 本身自己带有 CLI（Command-Line Interface，命令行界面） 工具，可以单独安装使用。下面在项目中安装 <code>@babel/cli</code> 和 <code>@babel/core</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i -D @babel/core @babel/cli
</code></pre></div><p>然后创建一个<code>babel.js</code>文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// babel.js</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=&gt;</span> n <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后执行<code>npx babel babel.js</code>，则会看到输出的内容，<strong>此时可能会看到输出的内容跟源文件内容没有区别</strong>，这是因为没有加转换规则，下面安装<code>@babel/preset-env</code>。然后执行 CLI 的时候添加 <code>--presets</code> flag：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装 preset-env</span>
<span class="token function">npm</span> i -D @babel/preset-env
<span class="token comment"># 执行 CLI 添加--presets</span>
npx babel babel.js --presets<span class="token operator">=</span>@babel/preset-env
</code></pre></div><p>最终输出的代码就是转换为 ES5 的代码了：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果要输出结果到固定文件，可以使用 <code>--out-file</code> 或 <code>-o</code> 参数：<code>npx babel babel.js -o output.js</code>。</p> <blockquote><p>Babel 7 使用了 @babel 命名空间来区分官方包，因此以前的官方包 <code>babel-xxx</code> 改成了 <code>@babel/xxx</code>。</p></blockquote> <h3 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h3> <p>除了使用命令行配置 flag 之外，Babel 还支持配置文件，配置文件支持两种：</p> <ul><li>使用<code>package.json</code>的<code>babel</code>属性；</li> <li>在项目根目录单独创建<code>.babelrc</code>或者<code>.babelrc.js</code>文件。</li></ul> <p>直接上对应的示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;my-package&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;babel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// .babelrc</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Babel会在正在被转义的文件当前目录中查找一个 <code>.babelrc</code> 文件。 如果不存在，它会向<strong>外层目录</strong>遍历目录树，直到找到一个 <code>.babelrc</code> 文件，或一个 <code>package.json</code> 文件中有 <code>&quot;babel&quot;: {}</code> 。</p> <h3 id="env-选项"><a href="#env-选项" class="header-anchor">#</a> env 选项</h3> <p>如果希望在不同的环境中使用不同的 Babel 配置，那么可以在配置文件中添加<code>env</code>选项：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;production&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>env 选项的值将从 <code>process.env.BABEL_ENV</code> 获取，如果没有的话，则获取 <code>process.env.NODE_ENV</code> 的值，它也无法获取时会设置为 <code>&quot;development&quot;</code>。</p> <h3 id="插件和-preset"><a href="#插件和-preset" class="header-anchor">#</a> 插件和 Preset</h3> <p>Babel 的语法转换是通过强大的插件系统来支持的，<strong>Babel 的插件分为两类：转换插件和语法解析插件</strong>。</p> <p>不同的语法对应着不同的转换插件，比如要将箭头函数转换为 ES5 函数写法，那么可以单独安装<code>@babel/plugin-transform-arrow-functions</code>插件，转换插件主要职责是进行语法转换的，而<strong>解析插件</strong>则是扩展语法的，比如要解析<code>jsx</code>这类 React 设计的特殊语法，则需要对应的 jsx 插件。</p> <p>如果不想一个个的添加插件，那么可以使用插件组合 preset（插件预设，插件组合更加好理解一些），最常见的 preset 是<code>@babel/preset-env</code>。</p> <p>之前的<code>preset</code>是按照<code>TC39</code>提案阶段来分的，比如看到<code>babel-preset-stage-1</code>代表，这个插件组合里面是支持 <code>TC39</code> Stage-1 阶段的转换插件集合。</p> <blockquote><p><code>TC39</code> 指的是技术委员会（Technical Committee）第 39 号，它是 ECMA 的一部分，ECMA 是 「ECMAScript」规范下的 JavaScript 语言标准化的机构。</p> <p>ES6 出来之后，<code>TC39</code>精简了提案的修订过程，新流程设计四个 Stage 阶段：</p> <ul><li>Stage 0 - 设想（Strawman）：只是一个想法；</li> <li>Stage 1 - 建议（Proposal）：这是值得跟进的；</li> <li>Stage 2 - 草案（Draft）：初始规范，应该提供规范初稿；</li> <li>Stage 3 - 候选（Candidate）：不会有太大的改变，在对外发布之前只是修正一些问题；</li> <li>Stage 4 - 完成（Finished）：当规范的实现至少通过两个验收测试时，进入 Stage 4，会被包含在 ECMAScript 的下一个修订版中。</li></ul></blockquote> <p><code>@babel/preset-env</code>是 Babel 官方推出的插件预设，它可以根据开发者的配置按需加载对应的插件，通过<code>@babel/preset-env</code>可以根据代码执行平台环境和具体浏览器的版本来产出对应的 JavaScript 代码，例如可以设置代码执行在 Node.js 8.9 或者 iOS 12 版本。</p> <h3 id="polyfill"><a href="#polyfill" class="header-anchor">#</a> polyfill</h3> <blockquote><p>polyfill：英文原意为一种用于衣物、床具等的聚酯填充材料，例如装修时候的腻子，作用是抹平坑坑洼洼的墙面；</p> <p>在 JavaScript 中表示一些可以抹平浏览器实现差异的代码，比如某浏览器不支持 Promise，可以引入<code>es6-promise-polyfill</code>等库来解决，而这往往可以交给babel来处理，参考：[最佳实践](#Babel Polyfill 的最佳实践)</p></blockquote> <p>Babel 只负责进行语法转换，即将 ES6 语法转换成 ES5 语法，但是如果在 ES5 中，有些对象、方法实际在浏览器中可能是不支持的，例如：<code>Promise</code>、<code>Array.prototype.includes</code>，这时候就需要用<code>@babel/polyfill</code>来做模拟处理。</p> <p><code>@babel/polyfill</code>使用方法是先安装依赖，然后在对应的文件内显性的引入：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装，注意因为代码中引入了 polyfill，所以不再是开发依赖（--save-dev，-D）</span>
<span class="token function">npm</span> i @babel/polyfill
</code></pre></div><p>在文件内直接<code>import</code>或者<code>require</code>进来：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// polyfill</span>
<span class="token keyword">import</span> <span class="token string">'@babel/polyfill'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出内容</span>
<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/polyfill&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="runtime"><a href="#runtime" class="header-anchor">#</a> runtime</h3> <p><code>@babel/polyfill</code>虽然可以解决模拟浏览器不存在对象方法的事情，但是有以下两个问题：</p> <ul><li>直接修改内置的原型，造成全局污染；</li> <li>无法按需引入，Webpack 打包时，会把所有的 Polyfill 都加载进来，导致产出文件过大。</li></ul> <blockquote><p>为了解决这个问题，Babel 社区又提出了<code>@babel/runtime</code>的方案，<code>@babel/runtime</code>不再修改原型，而是采用替换的方式，比如用 Promise，使用<code>@babel/polyfill</code>会产生一个<code>window.Promise</code>对象，而<code>@babel/runtime</code>则会生成一个<code>_Promise</code>（示例而已）来替换掉代码中用到的<code>Promise</code>。</p> <p>另外<code>@babel/runtime</code>还支持按需引入。</p></blockquote> <p>下面以转换<code>Object.assign</code>为例，来看下<code>@babel/runtime</code>怎么使用。</p> <ol><li>安装依赖<code>@babel/runtime</code>：<code>npm i @babel/runtime</code> ；</li> <li>安装<code>npm i -D @babel/plugin-transform-runtime</code>作为 Babel 插件；</li> <li>安装需要转换<code>Object.assign</code>的插件：<code>npm i -D @babel/plugin-transform-object-assign</code></li></ol> <p>编写一个<code>runtime.js</code>文件，内容如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>执行<code>npx babel runtime.js --plugins @babel/plugin-transform-runtime,@babel/plugin-transform-object-assign</code>，最终的输出结果是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _interopRequireDefault <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/runtime/helpers/interopRequireDefault&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _extends2 <span class="token operator">=</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/runtime/helpers/extends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _extends2<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>代码中自动引入了<code>@babel/runtime/helpers/extends</code>这个模块（<strong>所以要添加<code>@babel/runtime</code>依赖啊</strong>）。</p> <p><code>@babel/runtime</code>也不是完美的解决方案，由于<code>@babel/runtime</code>不修改原型，所以类似<code>[].includes()</code>这类使用直接使用原型方法的语法是不能被转换的。</p> <blockquote><p><code>@babel/polyfill</code>实际是<a href="https://github.com/zloirock/core-js" target="_blank" rel="noopener noreferrer"><code>core-js</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和<a href="https://github.com/facebook/regenerator/blob/master/packages/regenerator-runtime/runtime.js" target="_blank" rel="noopener noreferrer"><code>regenerator-runtime</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的合集，所以如果要按需引入<code>@babel/polyfill</code>的某个模块，可以直接引入对应的 core-js 模块，但是手动引入的方式还是太费劲。</p></blockquote> <h3 id="babel-preset-env"><a href="#babel-preset-env" class="header-anchor">#</a> <code>@babel/preset-env</code></h3> <p>前面介绍了<code>@babel/preset-env</code>可以零配置的转化 ES6 代码，可以扩展添加配置。</p> <p>在<code>@babel/preset-env</code>的选项中，<code>useBuiltIns</code>和<code>target</code>是最重要的两个，<code>useBuiltIns</code>用来设置浏览器 polyfill，<code>target</code>是为了目标浏览器或者对应的环境（browser/node）。</p> <h4 id="usebuiltins"><a href="#usebuiltins" class="header-anchor">#</a> <code>useBuiltIns</code></h4> <p>前面介绍了<code>@babel/polyfill</code>和<code>@babel/runtime</code>两种方式来实现浏览器 polyfill，两种方式都比较繁琐，而且不够智能，可以使用<code>@babel/preset-env</code>的<code>useBuildIn</code>选项做 polyfill，这种方式简单而且智能。</p> <p><code>useBuiltIns</code>默认为 <code>false</code>，可以使用的值有 <code>usage</code> 和 <code>entry</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;useBuiltIns&quot;</span><span class="token operator">:</span> <span class="token string">&quot;usage|entry|false&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p><code>usage</code> 表示明确使用到的 Polyfill 引用。在一些 ES2015+ 语法不支持的环境下，每个需要用到 Polyfill 的引用时，会<strong>自动加上</strong>，例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token string">'foobar'</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>一般情况下，个人建议直接使用<code>usage</code>就满足日常开发了。</strong></p> <p>需要提一下的是，polyfill 用到的<code>core-js</code>是可以指定版本的，比如使用 <code>core-js@3</code>，则首先安装依赖<code>npm i -S core-js@3</code>，然后在 Babel 配置文件<code>.babelrc</code>中写上版本。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//.babelrc</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
            <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;useBuiltIns&quot;</span><span class="token operator">:</span> <span class="token string">&quot;usage&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用<code>useBuiltIns='usage'</code>编译之后，上面代码变成，真正的做到了按需加载，而且类似<code>[].includes()</code>这类直接使用原型方法的语法是能被转换的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;core-js/modules/es.object.to-string.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;core-js/modules/es.promise.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;core-js/modules/es.array.includes.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;core-js/modules/es.string.includes.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token string">'foobar'</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p><code>entry</code> 表示替换 <code>import &quot;@babel/polyfill&quot;;</code></p> <p>新版本的 Babel，会提示直接引入 <code>core-js</code>或者<code>regenerator-runtime/runtime</code>来代替<code>@babel/polyfill</code>的全局声明</p> <p>根据<code>targets</code>中浏览器版本的支持，将 polyfill 拆分引入，仅引入有浏览器不支持的 polyfill。</p></li></ul> <p><strong>结论：</strong></p> <p>所以，<code>entry</code> 相对<code>usage</code>使用起来相对麻烦一些，首先需要手动显性的引入<code>@babel/polyfill</code>，而且根据配置<code>targets</code>来确定输出，这样会导致代码实际用不到的 polyfill 也会被打包到输出文件，导致文件比较大。</p> <h4 id="target"><a href="#target" class="header-anchor">#</a> <code>target</code></h4> <p>假设希望代码中使用 ES6 的模板字面量``语法，但是实际执行代码的宿主浏览器是 IE 10 却不支持，那么可以使用<code>target</code>指定目标浏览器了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;browsers&quot;</span><span class="token operator">:</span> <span class="token string">&quot;IE 10&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果代码是在 Node.js 环境执行的，则可以指定 Node.js 的版本号：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;@babel/preset-env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8.9.3&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li><p><code>targets.browsers</code> 需要使用 browserslist 的配置方法，但是其设置会被 <code>targets.[chrome, opera, edge, firefox, safari, ie, ios, android, node, electron]</code> 覆盖；</p></li> <li><p><code>targets.node</code> 设置为 <code>true</code> 或 <code>&quot;current&quot;</code> 可以根据当前 Node.js 版本进行动态转换，也可以设置为具体的数字表示需要支持的最低 Node.js 版本；</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;node&quot;: &quot;current&quot;

// 等价于
// &quot;node&quot;: process.versions.node
</code></pre></div></li> <li><p><code>targets.esmodules</code> 设置使用 ES Modules 语法，最新浏览器支持，这个在后面 Webpack 插件章节会详细介绍如何实现 Modern Mode。</p></li></ol> <blockquote><p>browserslist 介绍和配置规则本文最后部分会介绍。</p></blockquote> <h3 id="babel-plugin-transform-runtime"><a href="#babel-plugin-transform-runtime" class="header-anchor">#</a> <code>@babel/plugin-transform-runtime</code></h3> <p>作用：可以重用 Babel 注入的辅助代码以节省代码大小。举例参考：[最佳实践](#Babel Polyfill 的最佳实践)</p> <p>Babel 使用非常小的辅助函数来实现诸如<code>_extend</code>，默认情况下，这将添加到需要它的每个文件中。这种重复有时是不必要的，尤其是当您的应用程序分布在多个文件中时。这就是<code>@babel/plugin-transform-runtime</code>插件的用武之地：所有帮助程序都将引用该模块<code>@babel/runtime</code>以避免在编译输出中出现重复，运行时将被编译到您的构建中。</p> <p>如果您直接导入<a href="https://github.com/zloirock/core-js" target="_blank" rel="noopener noreferrer">core-js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或<a href="https://babeljs.io/docs/en/babel-polyfill" target="_blank" rel="noopener noreferrer">@babel/polyfill<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>以及它提供的内置<a href="https://babeljs.io/docs/en/babel-polyfill" target="_blank" rel="noopener noreferrer">函数<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，例如<code>Promise</code>,<code>Set</code>和<code>Map</code>，则会污染全局范围。</p> <p>配置说明：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// 无选项</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 选项及默认值</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;absoluteRuntime&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;helpers&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;regenerator&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>transform-runtime</code>转换插件做了三两件事：</p> <ul><li><code>@babel/runtime/regenerator</code>使用<code>generators/async</code>函数时自动需要（可使用<code>regenerator</code>选项切换）；</li> <li>必要时可以使用<code>core-js</code>的帮助器，而不是假设它将由用户进行<code>polyfilled</code>（可通过corejs选项进行切换）；</li> <li>自动删除内联Babel帮助器，并使用模块<code>@babel/runtime/helpers</code>代替（可通过helpers选项切换）。</li></ul> <p>基本上，你可以使用<code>Promise</code>、<code>Set</code>、<code>Symbol</code>等内置插件，也可以无缝地使用所有需要polyfill的Babel功能，没有全局污染，使其非常适用于js库。</p> <p>请确保你将@babel/runtime作为依赖项。</p> <h2 id="webpack-中使用-babel"><a href="#webpack-中使用-babel" class="header-anchor">#</a> Webpack 中使用 Babel</h2> <p>下面在 webpack 中使用 Babel 就变得很简单了，借助loaders（模块解析器）：</p> <p>步骤：</p> <ul><li><p>首先安装 npm 依赖，然后修改 <code>webpack.config.js</code>。</p> <p>安装依赖包：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 安装开发依赖</span>
<span class="token function">npm</span> i webpack@5 babel-loader webpack-cli@4 @babel/core @babel/preset-env @babel/plugin-transform-runtime core-js@3 -D
<span class="token comment"># 将 runtime 作为依赖</span>
<span class="token function">npm</span> i @babel/runtime -S
</code></pre></div></li> <li><p>创建<code>webpack.config.js</code>文件，内容如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./babel.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span>
                  <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>
                  <span class="token punctuation">{</span>
                    <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span>
                    <span class="token string-property property">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的<code>webpack.config.js</code>文件直接将 Babel 的配置写到了<code>options</code>中，还可以在项目根目录下创建<code>.babelrc</code>或者使用<code>package.json</code>的 babel 字段。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>➜ npx webpack
asset main.js <span class="token number">260</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: main<span class="token punctuation">)</span>
runtime modules <span class="token number">1.47</span> KiB <span class="token number">6</span> modules
modules by path ./node_modules/core-js/internals/*.js <span class="token number">73.5</span> KiB <span class="token number">98</span> modules
modules by path ./node_modules/core-js/modules/*.js <span class="token number">56.4</span> KiB <span class="token number">32</span> modules
./babel.js <span class="token number">99</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.48</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">1829</span> ms
</code></pre></div></li></ul></div> <!----> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes-page/devops/webpack/03-完整配置.html" class="prev">
        完整的配置
      </a></span> <span class="next"><a href="/notes-page/devops/webpack/05-webpack模块化.html">
        模块化
      </a>
      →
    </span></p></div>  <div class="el-dialog__wrapper" style="display:none;"><div role="dialog" aria-modal="true" aria-label="dialog" class="el-dialog" style="margin-top:15vh;width:420px;"><div class="el-dialog__header"><span class="el-dialog__title"></span><button type="button" aria-label="Close" class="el-dialog__headerbtn"><i class="el-dialog__close el-icon el-icon-close"></i></button></div><!----><div class="el-dialog__footer"><span class="dialog-footer"><button type="button" class="el-button el-button--default"><!----><!----><span>取 消</span></button> <button type="button" class="el-button el-button--primary"><!----><!----><span>确 定</span></button></span></div></div></div></main> <!----></div><div class="global-ui"><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/notes-page/assets/js/app.27e1836e.js" defer></script><script src="/notes-page/assets/js/8.917fc4fb.js" defer></script><script src="/notes-page/assets/js/72.f207f71e.js" defer></script>
  </body>
</html>
