<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>模块化 | 大前端 - 前端高级进阶</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?8b87000f915d1fe37e079a25c2e12d6b";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
      </script>
    <meta name="description" content="大前端课程电子书">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/notes-page/assets/css/0.styles.e34c2d94.css" as="style"><link rel="preload" href="/notes-page/assets/js/app.543bbfb2.js" as="script"><link rel="preload" href="/notes-page/assets/js/5.f19a8426.js" as="script"><link rel="preload" href="/notes-page/assets/js/57.25753be2.js" as="script"><link rel="prefetch" href="/notes-page/assets/js/10.a349bc38.js"><link rel="prefetch" href="/notes-page/assets/js/100.827446e2.js"><link rel="prefetch" href="/notes-page/assets/js/101.5d278dcb.js"><link rel="prefetch" href="/notes-page/assets/js/102.bd956665.js"><link rel="prefetch" href="/notes-page/assets/js/103.877cb109.js"><link rel="prefetch" href="/notes-page/assets/js/104.36135275.js"><link rel="prefetch" href="/notes-page/assets/js/105.ae63e539.js"><link rel="prefetch" href="/notes-page/assets/js/106.4a796b84.js"><link rel="prefetch" href="/notes-page/assets/js/107.7b6103e4.js"><link rel="prefetch" href="/notes-page/assets/js/108.19aa41a8.js"><link rel="prefetch" href="/notes-page/assets/js/109.2bb71dbb.js"><link rel="prefetch" href="/notes-page/assets/js/11.238713f8.js"><link rel="prefetch" href="/notes-page/assets/js/110.37844090.js"><link rel="prefetch" href="/notes-page/assets/js/111.5f89cdf7.js"><link rel="prefetch" href="/notes-page/assets/js/112.39a95715.js"><link rel="prefetch" href="/notes-page/assets/js/113.6077906a.js"><link rel="prefetch" href="/notes-page/assets/js/114.db676b0b.js"><link rel="prefetch" href="/notes-page/assets/js/115.15606bf9.js"><link rel="prefetch" href="/notes-page/assets/js/116.05548163.js"><link rel="prefetch" href="/notes-page/assets/js/117.eebb2df5.js"><link rel="prefetch" href="/notes-page/assets/js/118.830f9626.js"><link rel="prefetch" href="/notes-page/assets/js/119.4ac2a777.js"><link rel="prefetch" href="/notes-page/assets/js/12.3524d989.js"><link rel="prefetch" href="/notes-page/assets/js/120.f9705b6c.js"><link rel="prefetch" href="/notes-page/assets/js/121.3c273f70.js"><link rel="prefetch" href="/notes-page/assets/js/122.83811db4.js"><link rel="prefetch" href="/notes-page/assets/js/123.6e0e1deb.js"><link rel="prefetch" href="/notes-page/assets/js/124.b5964050.js"><link rel="prefetch" href="/notes-page/assets/js/125.3dd248a5.js"><link rel="prefetch" href="/notes-page/assets/js/126.33b7451e.js"><link rel="prefetch" href="/notes-page/assets/js/127.d72dce67.js"><link rel="prefetch" href="/notes-page/assets/js/128.5cbce864.js"><link rel="prefetch" href="/notes-page/assets/js/129.6e73307c.js"><link rel="prefetch" href="/notes-page/assets/js/13.d060dbd7.js"><link rel="prefetch" href="/notes-page/assets/js/130.14ee2c36.js"><link rel="prefetch" href="/notes-page/assets/js/131.579cc072.js"><link rel="prefetch" href="/notes-page/assets/js/132.18af4e5c.js"><link rel="prefetch" href="/notes-page/assets/js/133.ba529849.js"><link rel="prefetch" href="/notes-page/assets/js/134.e84f0855.js"><link rel="prefetch" href="/notes-page/assets/js/135.a8cba0f1.js"><link rel="prefetch" href="/notes-page/assets/js/136.1419b6e3.js"><link rel="prefetch" href="/notes-page/assets/js/137.187a918a.js"><link rel="prefetch" href="/notes-page/assets/js/138.e28d769d.js"><link rel="prefetch" href="/notes-page/assets/js/139.aa496525.js"><link rel="prefetch" href="/notes-page/assets/js/14.227150ba.js"><link rel="prefetch" href="/notes-page/assets/js/140.e0360215.js"><link rel="prefetch" href="/notes-page/assets/js/141.1c8b15ed.js"><link rel="prefetch" href="/notes-page/assets/js/142.4f7e3a38.js"><link rel="prefetch" href="/notes-page/assets/js/143.e68b51bb.js"><link rel="prefetch" href="/notes-page/assets/js/144.028ef6c3.js"><link rel="prefetch" href="/notes-page/assets/js/145.0c277fca.js"><link rel="prefetch" href="/notes-page/assets/js/146.7b6402d0.js"><link rel="prefetch" href="/notes-page/assets/js/147.b30ea1bf.js"><link rel="prefetch" href="/notes-page/assets/js/148.e0cfe762.js"><link rel="prefetch" href="/notes-page/assets/js/149.e87a827e.js"><link rel="prefetch" href="/notes-page/assets/js/15.f78c42bf.js"><link rel="prefetch" href="/notes-page/assets/js/150.c8fd0e59.js"><link rel="prefetch" href="/notes-page/assets/js/151.d1a62621.js"><link rel="prefetch" href="/notes-page/assets/js/152.de6f48aa.js"><link rel="prefetch" href="/notes-page/assets/js/153.2d82726a.js"><link rel="prefetch" href="/notes-page/assets/js/154.dd0ca307.js"><link rel="prefetch" href="/notes-page/assets/js/155.3662d26f.js"><link rel="prefetch" href="/notes-page/assets/js/156.27bc66a5.js"><link rel="prefetch" href="/notes-page/assets/js/157.6331c6e3.js"><link rel="prefetch" href="/notes-page/assets/js/158.a9df2e68.js"><link rel="prefetch" href="/notes-page/assets/js/159.0348ab97.js"><link rel="prefetch" href="/notes-page/assets/js/16.eeb811e2.js"><link rel="prefetch" href="/notes-page/assets/js/160.695db598.js"><link rel="prefetch" href="/notes-page/assets/js/161.c8a0dcb1.js"><link rel="prefetch" href="/notes-page/assets/js/162.ffad87da.js"><link rel="prefetch" href="/notes-page/assets/js/163.2155c58e.js"><link rel="prefetch" href="/notes-page/assets/js/164.d1793bfb.js"><link rel="prefetch" href="/notes-page/assets/js/165.bd9493c5.js"><link rel="prefetch" href="/notes-page/assets/js/166.88af8120.js"><link rel="prefetch" href="/notes-page/assets/js/167.2a5c695c.js"><link rel="prefetch" href="/notes-page/assets/js/168.93b60c44.js"><link rel="prefetch" href="/notes-page/assets/js/169.f73c59f9.js"><link rel="prefetch" href="/notes-page/assets/js/17.2aaa82c2.js"><link rel="prefetch" href="/notes-page/assets/js/170.388fa051.js"><link rel="prefetch" href="/notes-page/assets/js/171.e6a2c1e0.js"><link rel="prefetch" href="/notes-page/assets/js/172.850953d0.js"><link rel="prefetch" href="/notes-page/assets/js/173.49ee98c7.js"><link rel="prefetch" href="/notes-page/assets/js/174.19c83c79.js"><link rel="prefetch" href="/notes-page/assets/js/175.384d95c4.js"><link rel="prefetch" href="/notes-page/assets/js/176.e9c7f847.js"><link rel="prefetch" href="/notes-page/assets/js/177.e1d4cd26.js"><link rel="prefetch" href="/notes-page/assets/js/178.db40e3dd.js"><link rel="prefetch" href="/notes-page/assets/js/179.9c321f83.js"><link rel="prefetch" href="/notes-page/assets/js/18.4fab4eff.js"><link rel="prefetch" href="/notes-page/assets/js/180.c086f727.js"><link rel="prefetch" href="/notes-page/assets/js/181.31de876c.js"><link rel="prefetch" href="/notes-page/assets/js/182.e00ea0d9.js"><link rel="prefetch" href="/notes-page/assets/js/19.2374ac2f.js"><link rel="prefetch" href="/notes-page/assets/js/20.7dbf0d49.js"><link rel="prefetch" href="/notes-page/assets/js/21.8f283d05.js"><link rel="prefetch" href="/notes-page/assets/js/22.1d6e850e.js"><link rel="prefetch" href="/notes-page/assets/js/23.58933479.js"><link rel="prefetch" href="/notes-page/assets/js/24.b2486931.js"><link rel="prefetch" href="/notes-page/assets/js/25.b0f0a584.js"><link rel="prefetch" href="/notes-page/assets/js/26.92dab266.js"><link rel="prefetch" href="/notes-page/assets/js/27.7ddb9c20.js"><link rel="prefetch" href="/notes-page/assets/js/28.8cc4941e.js"><link rel="prefetch" href="/notes-page/assets/js/29.60175048.js"><link rel="prefetch" href="/notes-page/assets/js/30.df1bbd7c.js"><link rel="prefetch" href="/notes-page/assets/js/31.61029261.js"><link rel="prefetch" href="/notes-page/assets/js/32.d08de88e.js"><link rel="prefetch" href="/notes-page/assets/js/33.94a19578.js"><link rel="prefetch" href="/notes-page/assets/js/34.7ca77f29.js"><link rel="prefetch" href="/notes-page/assets/js/35.b6f5346b.js"><link rel="prefetch" href="/notes-page/assets/js/36.1dec7c2a.js"><link rel="prefetch" href="/notes-page/assets/js/37.35484b1b.js"><link rel="prefetch" href="/notes-page/assets/js/38.c2dd4eab.js"><link rel="prefetch" href="/notes-page/assets/js/39.6f595983.js"><link rel="prefetch" href="/notes-page/assets/js/40.7bbffd5f.js"><link rel="prefetch" href="/notes-page/assets/js/41.87a2e003.js"><link rel="prefetch" href="/notes-page/assets/js/42.72c83457.js"><link rel="prefetch" href="/notes-page/assets/js/43.9b4fad8c.js"><link rel="prefetch" href="/notes-page/assets/js/44.0b8c33b2.js"><link rel="prefetch" href="/notes-page/assets/js/45.d85ab74c.js"><link rel="prefetch" href="/notes-page/assets/js/46.c08af28d.js"><link rel="prefetch" href="/notes-page/assets/js/47.813cc168.js"><link rel="prefetch" href="/notes-page/assets/js/48.764bd42e.js"><link rel="prefetch" href="/notes-page/assets/js/49.f2d26dbd.js"><link rel="prefetch" href="/notes-page/assets/js/50.e4f5aa8f.js"><link rel="prefetch" href="/notes-page/assets/js/51.121596ff.js"><link rel="prefetch" href="/notes-page/assets/js/52.2da90ac7.js"><link rel="prefetch" href="/notes-page/assets/js/53.e6bf64e6.js"><link rel="prefetch" href="/notes-page/assets/js/54.600a2168.js"><link rel="prefetch" href="/notes-page/assets/js/55.93cb1148.js"><link rel="prefetch" href="/notes-page/assets/js/56.97ed54d4.js"><link rel="prefetch" href="/notes-page/assets/js/58.d7d092a9.js"><link rel="prefetch" href="/notes-page/assets/js/59.a084cd15.js"><link rel="prefetch" href="/notes-page/assets/js/6.a6685c6a.js"><link rel="prefetch" href="/notes-page/assets/js/60.35feb24b.js"><link rel="prefetch" href="/notes-page/assets/js/61.ee7ea196.js"><link rel="prefetch" href="/notes-page/assets/js/62.fd8f3b4a.js"><link rel="prefetch" href="/notes-page/assets/js/63.2b5118e2.js"><link rel="prefetch" href="/notes-page/assets/js/64.d01eee04.js"><link rel="prefetch" href="/notes-page/assets/js/65.f2476a51.js"><link rel="prefetch" href="/notes-page/assets/js/66.ee6bf929.js"><link rel="prefetch" href="/notes-page/assets/js/67.103cb401.js"><link rel="prefetch" href="/notes-page/assets/js/68.9c37a925.js"><link rel="prefetch" href="/notes-page/assets/js/69.896e16e9.js"><link rel="prefetch" href="/notes-page/assets/js/7.a92f4da7.js"><link rel="prefetch" href="/notes-page/assets/js/70.fd9e2cdc.js"><link rel="prefetch" href="/notes-page/assets/js/71.2bff68a2.js"><link rel="prefetch" href="/notes-page/assets/js/72.08eb2e05.js"><link rel="prefetch" href="/notes-page/assets/js/73.df070865.js"><link rel="prefetch" href="/notes-page/assets/js/74.9c94a6b6.js"><link rel="prefetch" href="/notes-page/assets/js/75.4b99faa9.js"><link rel="prefetch" href="/notes-page/assets/js/76.939b2792.js"><link rel="prefetch" href="/notes-page/assets/js/77.2503cc55.js"><link rel="prefetch" href="/notes-page/assets/js/78.b23bb542.js"><link rel="prefetch" href="/notes-page/assets/js/79.b278b0ff.js"><link rel="prefetch" href="/notes-page/assets/js/8.5033a958.js"><link rel="prefetch" href="/notes-page/assets/js/80.ac3c6cb7.js"><link rel="prefetch" href="/notes-page/assets/js/81.e283cb9c.js"><link rel="prefetch" href="/notes-page/assets/js/82.2e521b00.js"><link rel="prefetch" href="/notes-page/assets/js/83.9ceca969.js"><link rel="prefetch" href="/notes-page/assets/js/84.b4a295c5.js"><link rel="prefetch" href="/notes-page/assets/js/85.a155dd71.js"><link rel="prefetch" href="/notes-page/assets/js/86.4b54d02f.js"><link rel="prefetch" href="/notes-page/assets/js/87.8444e897.js"><link rel="prefetch" href="/notes-page/assets/js/88.0069e420.js"><link rel="prefetch" href="/notes-page/assets/js/89.916b56f9.js"><link rel="prefetch" href="/notes-page/assets/js/9.99098a07.js"><link rel="prefetch" href="/notes-page/assets/js/90.30b021b7.js"><link rel="prefetch" href="/notes-page/assets/js/91.c468abd5.js"><link rel="prefetch" href="/notes-page/assets/js/92.dc53600b.js"><link rel="prefetch" href="/notes-page/assets/js/93.acd011e1.js"><link rel="prefetch" href="/notes-page/assets/js/94.f75a0a05.js"><link rel="prefetch" href="/notes-page/assets/js/95.0a41ccaa.js"><link rel="prefetch" href="/notes-page/assets/js/96.63a20787.js"><link rel="prefetch" href="/notes-page/assets/js/97.6040f94c.js"><link rel="prefetch" href="/notes-page/assets/js/98.3d58b9bc.js"><link rel="prefetch" href="/notes-page/assets/js/99.871a6859.js"><link rel="prefetch" href="/notes-page/assets/js/vendors~docsearch.7e85931d.js"><link rel="prefetch" href="/notes-page/assets/js/vendors~photo-swipe.b229e9ae.js"><link rel="prefetch" href="/notes-page/assets/js/vendors~search-page.9d6e255e.js">
    <link rel="stylesheet" href="/notes-page/assets/css/0.styles.e34c2d94.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes-page/" class="home-link router-link-active"><!----> <span class="site-name">大前端 - 前端高级进阶</span></a> <div class="links"><div id="docsearch"></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Jenkins</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/devops/jenkins/" class="sidebar-link">介绍&amp;安装</a></li><li><a href="/notes-page/devops/jenkins/01-插件下载.html" class="sidebar-link">插件下载</a></li><li><a href="/notes-page/devops/jenkins/02-权限管理.html" class="sidebar-link">权限管理</a></li><li><a href="/notes-page/devops/jenkins/03-gitee.html" class="sidebar-link">Gitee + Jenkins自动化实战</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/devops/webpack/" aria-current="page" class="sidebar-link">Webpack导学</a></li><li><a href="/notes-page/devops/webpack/01-核心概念.html" class="sidebar-link">核心概念</a></li><li><a href="/notes-page/devops/webpack/02-常见配置.html" class="sidebar-link">常见配置</a></li><li><a href="/notes-page/devops/webpack/03-完整配置.html" class="sidebar-link">完整的配置</a></li><li><a href="/notes-page/devops/webpack/04-ES6语法支持.html" class="sidebar-link">Babel核心知识</a></li><li><a href="/notes-page/devops/webpack/05-webpack模块化.html" class="active sidebar-link">模块化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/05-webpack模块化.html#模块化规范" class="sidebar-link">模块化规范</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/05-webpack模块化.html#commonjs" class="sidebar-link">CommonJS</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/05-webpack模块化.html#amd" class="sidebar-link">AMD</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/05-webpack模块化.html#es6-module" class="sidebar-link">ES6 Module</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/05-webpack模块化.html#webpack工作原理简析" class="sidebar-link">Webpack工作原理简析</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/05-webpack模块化.html#webpack对module-的增强" class="sidebar-link">webpack对Module 的增强</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/05-webpack模块化.html#import-和神奇注释" class="sidebar-link">import()和神奇注释</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/05-webpack模块化.html#require-resolve-和require-resolveweak" class="sidebar-link">require.resolve() 和require.resolveWeak()</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/05-webpack模块化.html#require-context" class="sidebar-link">require.context()</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/05-webpack模块化.html#require-include" class="sidebar-link">require.include()</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/05-webpack模块化.html#资源的模块化处理" class="sidebar-link">资源的模块化处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/05-webpack模块化.html#import和import" class="sidebar-link">@import和import</a></li><li class="sidebar-sub-header"><a href="/notes-page/devops/webpack/05-webpack模块化.html#把资源作为模块引入" class="sidebar-link">把资源作为模块引入</a></li></ul></li></ul></li><li><a href="/notes-page/devops/webpack/06-TS&amp;JS处理.html" class="sidebar-link">TS&amp;JS处理</a></li><li><a href="/notes-page/devops/webpack/07-CSS处理.html" class="sidebar-link">CSS处理</a></li><li><a href="/notes-page/devops/webpack/08-HTML.html" class="sidebar-link">HTML处理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>文档管理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/devops/showdoc/" class="sidebar-link">文档管理工具</a></li><li><a href="/notes-page/devops/showdoc/01-静态网站生成工具.html" class="sidebar-link">静态网站生成工具</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="模块化"><a href="#模块化" class="header-anchor">#</a> 模块化</h1> <h2 id="模块化规范"><a href="#模块化规范" class="header-anchor">#</a> 模块化规范</h2> <p>三大 JavaScript 主流模块规范：CommonJS、AMD 和 ES6 Module。</p> <h3 id="commonjs"><a href="#commonjs" class="header-anchor">#</a> CommonJS</h3> <p><a href="https://nodejs.org/docs/latest/api/modules.html" target="_blank" rel="noopener noreferrer">CommonJS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 规范是 2009 年一名来自 Mozilla 团队的工程师 Kevin Dangoor 开始设计一个叫 ServerJS 的项目提出来的，随着 Node.js 的广泛应用，被广泛接受。通过 <strong>ServerJS</strong> 这个名字就可以知道，CommonJS 主要是服务端用的模块规范。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// sayhi.js</span>
<span class="token keyword">var</span> hi <span class="token operator">=</span> <span class="token string">'hello world'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> hi<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> sayHi<span class="token punctuation">;</span>
<span class="token comment">// index.js</span>

<span class="token keyword">var</span> sayHi <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./sayhi.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的代码就是 CommonJS 语法，使用了<code>require</code>来导入一个模块，<code>module.exports</code>导出模块。在 Node.js 中<a href="https://nodejs.org/docs/latest/api/modules.html#modules_the_module_wrapper" target="_blank" rel="noopener noreferrer">实际代码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>会被处理成下面代码而被应用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> __filename<span class="token punctuation">,</span> __dirname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// 模块的代码在这里</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>CommonJS 的问题：<strong>Commonjs规范是不适合浏览器的，但由于有了打包工具的支撑，通过处理的Commonjs也可以在浏览器中使用。</strong></p> <blockquote><p>CommonJS 规范是 JavaScript 中最常见的模块格式规范，这一标准的设计初衷是为了让 JavaScript 在多个环境下都实现模块化。</p> <p>起先主要应用在 Node.js 服务端中，但是 Node.js 中的实现依赖了 Node.js 本身功能的实现，包括了 Node.js 的文件系统等，这个规范在浏览器环境是没法使用的。</p> <p>后来随着 <a href="http://browserify.org/" target="_blank" rel="noopener noreferrer">Browserify<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 Webpack 等打包工具的崛起，通过处理的 CommonJS 前端代码也可以在浏览器中使用。</p></blockquote> <h3 id="amd"><a href="#amd" class="header-anchor">#</a> AMD</h3> <p><a href="https://requirejs.org/docs/whyamd.html" target="_blank" rel="noopener noreferrer">AMD 规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是在 CommonJS 规范之后推出的一个解决 web 页面动态异步加载 JavaScript 的规范，相对于 CommonJS 规范，它最大特点是浏览器内支持、实现简单、并且支持异步加载，AMD 规范最早是随着<a href="https://requirejs.org/docs/api.html" target="_blank" rel="noopener noreferrer">RequireJS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>发展而提出来的，它最核心的是两个方法：</p> <ul><li><code>require()</code>：引入其他模块；</li> <li><code>define()</code>：定义新的模块。</li></ul> <p>基本语法如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// sayhi.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> hi <span class="token operator">=</span> <span class="token string">'hello world'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> hi<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// index.js</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./sayhi.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sayHi</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>AMD 提出来之后，也有很多变种的规范提出来，比如国内 <a href="https://seajs.github.io/seajs/" target="_blank" rel="noopener noreferrer">Sea.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 <a href="https://github.com/cmdjs/specification/blob/master/draft/module.md" target="_blank" rel="noopener noreferrer">CMD<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，还有兼容 CommonJS 和 AMD 的 <a href="https://github.com/umdjs/umd" target="_blank" rel="noopener noreferrer">UMD 规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（Universal Module Definition）。虽然 AMD 的模式很适合浏览器端的开发，但是随着 npm 包管理的机制越来越流行，这种方式可能会逐步的被淘汰掉。</p> <p>AMD 规范的问题：<strong>依赖前置加大了开发的难度，无论在阅读代码还是编写代码的时，都会导致引入的模块内容是条件性执行的。</strong></p> <blockquote><p>在 AMD 规范中，要声明一个模块，那么需要指定该模块用到的所有依赖项，这些依赖项会被当做形参传到 <code>factory</code>（<code>define</code>方法传入的函数叫做<code>factory</code>）中，对于依赖的模块会提前执行，这种做法叫做 <strong>依赖前置</strong>。依赖前置加大了开发的难度，无论在阅读代码还是编写代码的时，都会导致引入的模块内容是条件性执行的。</p> <p><strong>而且不管 AMD 还是 CommonJS 都没有统一浏览器和客户端的模块化规范。</strong></p></blockquote> <h3 id="es6-module"><a href="#es6-module" class="header-anchor">#</a> ES6 Module</h3> <p>ES6 Module，又称为 ES2015 modules，是 ES2015 标准提出来的一种模块加载方式，也是 ECMAScript 官方提出的方案，作为 ES 标准，不仅仅在 Web 现代浏览器（例如 Chrome）上面得到实现，而且在 Node.js 9+ 版本也得到原生支持（需要加上<code>--experimental-modules</code>使用）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// sayhi.js</span>
<span class="token keyword">const</span> hi <span class="token operator">=</span> <span class="token string">'hello world'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> hi<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// index.js</span>
<span class="token keyword">import</span> sayHi <span class="token keyword">from</span> <span class="token string">'./sayhi'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>对于前端项目，可以通过 Babel 或者 Typescript 进行提前体验。</p> <blockquote><p>随着主流浏览器逐步开始支持 ES Modules（ESM） 标准，越来越多的目光投注于 Node.js 对于 ESM 的支持实现上。</p></blockquote> <p>目前 Node.js 使用 CommonJS 作为官方的模块解决方案，虽然内置的模块方案促进了 Node.js 的流行，但是也为引入新的 ES Modules 造成了一定的阻碍。不过 Node.js 9.0+ 已经支持 ESM 语法，看示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// sayhi.mjs</span>
<span class="token keyword">const</span> hi <span class="token operator">=</span> <span class="token string">'hello world'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> hi<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// index.mjs</span>
<span class="token keyword">import</span> sayHi <span class="token keyword">from</span> <span class="token string">'./sayhi.mjs'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用命令</span>
➜ node <span class="token operator">--</span>experimental<span class="token operator">-</span>modules index<span class="token punctuation">.</span>mjs
hello world
</code></pre></div><p>需要添加 flag <code>--experimental-modules</code> 来启动 ESM 语法支持，文件则必须使用 <code>.mjs</code> 后缀： <code>node --experimental-modules some-esm-file.mjs</code> 。</p> <p><img src="/notes-page/assets/img/image-20210803114427025.9a9d9389.png" alt="image-20210803114427025"></p> <h2 id="webpack工作原理简析"><a href="#webpack工作原理简析" class="header-anchor">#</a> Webpack工作原理简析</h2> <p>在 Web 前端，不仅仅只有 JavaScript，还有 CSS、HTML、图片、字体、富媒体等众多资源，还有一些资源是以类似「方言」的方式存在着，比如 less、sass、各种 js 模板库等，这些资源并不能被直接用在 JavaScript 中，如果在 JavaScript 中像使用模块一样使用，那么可以极大的提高的开发体验：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./img/webpack.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> style <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./css/style.css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./template.ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这时候，就需要 Webpack 了！<strong>在 Webpack 中，一切皆模块！</strong></p> <p>webpack的编译逻辑：</p> <ul><li>Webpack 会要对整个代码进行<strong>静态分析</strong>，分析出各个模块的类型和它们依赖关系</li> <li>将不同类型的模块提交给对应的加载器（loader）来处理。</li></ul> <p>比如：一个用 Less 写的样式，可以先用 less-loader 将它转成一个 CSS 模块，然后再通过 css-loader 把他插入到页面的 <code>&lt;style&gt;</code> 标签中执行，甚至还可以通过插件将这部分 CSS 导出为 CSS 文件，使用<code>link</code>标签引入到页面中。</p> <h2 id="webpack对module-的增强"><a href="#webpack对module-的增强" class="header-anchor">#</a> webpack对Module 的增强</h2> <p>在 Webpack 中，不仅可以为所欲为的使用 CommonJS 、AMD 和 ES6 Module 三大规范（比如一个文件中混合使用三种规范），还可以使用 Webpack 对 Module 的增强方法和属性。</p> <h3 id="import-和神奇注释"><a href="#import-和神奇注释" class="header-anchor">#</a> <code>import()</code>和神奇注释</h3> <p>在 Webpack 中，<code>import</code>不仅仅是 ES6 Module 的模块导入方式，还是一个类似<code>require</code>的函数（其实这是 <a href="https://whatwg.github.io/loader/" target="_blank" rel="noopener noreferrer">ES2015 loader 规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的实现），可以通过<code>import('path/to/module')</code>的方式引入一个模块，<code>import()</code>返回的是一个<code>Promise</code>对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'path/to/module'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">mod</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>参考<a href="/notes-page/devops/webpack/04-ES6语法支持.html#webpack-中使用-babel">先前的一章</a>，来创建基础的ES6的webpack项目。</p></blockquote> <p>下面看看使用<code>import()</code>和 import 的打包有什么区别：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// hello.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>

<span class="token comment">// lazy.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">'lazy module'</span><span class="token punctuation">;</span>

<span class="token comment">// index.js</span>
<span class="token keyword">import</span> hello <span class="token keyword">from</span> <span class="token string">'./hello'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./lazy'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">lazy</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lazy<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>执行下命令：</p> <div class="language-js extra-class"><pre class="language-js"><code>npx webpack <span class="token operator">--</span>mode development：
</code></pre></div><p><img src="/notes-page/assets/img/image-20210804150238493.89072507.png" alt="image-20210804150238493"></p> <p>通过打包后的 log 和<code>dist</code>文件夹内容发现，的代码被分割成了两个文件，一个是<code>main.js</code>一个是<code>lazy_js.js</code>，这是因为相对于<code>import from</code>的静态分析打包语法，<code>import()</code>是动态打包语法，即的内容不是第一时间打进<code>main.js</code>的，而是通过异步的方式加载进来的。<strong>代码分割是 webpack 进行代码结构组织，实现动态优化的一个重要功能</strong></p> <blockquote><p>与<code>import()</code>用法一样的是<code>require.ensure</code>的方法，这个方法已经被<code>import()</code>方式替换掉；</p> <p>针对<code>import()</code>打包产物跟普通的静态分析打包的实现不同之处，后面原理篇讲解打包产出物的时候会详细介绍。</p></blockquote> <p>下面再来看下<code>import()</code>的<strong>神奇注释</strong>特性，上面<code>index.js</code>的代码修改成下面这样，增加注释<code>webpackChunkName: 'lazy-name'</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> hello <span class="token keyword">from</span> <span class="token string">'./hello'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span><span class="token punctuation">(</span>
    <span class="token comment">/*
     webpackChunkName: 'toimc-lazy'
     */</span>
    <span class="token string">'./lazy'</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">lazy</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lazy<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>则打包后的结果，<code>lasy_js.js</code>变成了<code>toimc-lazy.js</code>了，这个文件的名字就是在<code>import()</code>注释里面指定的<code>webpackChunkName</code>，这就是神奇注释（Magic Comments）。</p> <p><img src="/notes-page/assets/img/image-20210804150440531.f488c490.png" alt="image-20210804150440531"></p> <p>目前支持的注释有：</p> <ul><li><code>webpackInclude</code>：如果是 import 的一个目录，则可以指定需要引入的文件特性，例如只加载 json 文件：<code>/\.json$/</code>；</li> <li><code>webpackExclude</code>：如果是 import 的一个目录，则可以指定需要过滤的文件，例如 <code>/\.noimport\.json$/</code>；</li> <li><code>webpackChunkName</code>：这是 chunk 文件的名称，例如 toimc-lazy；</li> <li><code>webpackPrefetch</code>: 是否预取模块，及其优先级，可选值<code>true</code>、或者整数优先级别，0 相当于 true，webpack 4.6+支持；</li> <li><code>webpackPreload</code>: 是否预加载模块，及其优先级，可选值<code>true</code>、或者整数优先级别，0 相当于 true，webpack 4.6+支持；</li> <li><code>webpackMode</code>: 可选值<code>lazy</code>/<code>lazy-once</code>/<code>eager</code>/<code>weak</code>。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> hello <span class="token keyword">from</span> <span class="token string">'./hello'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span>

<span class="token keyword">import</span><span class="token punctuation">(</span>
  <span class="token comment">/* webpackChunkName: 'toimc-lazy' */</span>
  <span class="token comment">/* webpackInclude: /\.json$/ */</span>
  <span class="token comment">/* webpackExclude: /\.noimport\.json$/ */</span>
  <span class="token comment">/* webpackMode: &quot;lazy&quot; */</span>
  <span class="token comment">/* webpackPrefetch: true */</span>
  <span class="token comment">/* webpackPreload: true */</span>
  <span class="token string">'./lazy'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">lazy</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lazy<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这里最复杂的是<code>webpackMode</code>：</p> <ul><li><code>lazy</code>：是默认的模式，为每个 <code>import()</code> 导入的模块，生成一个可延迟加载 chunk；</li> <li><code>lazy-once</code>：生成一个可以满足所有 <code>import()</code> 调用的<strong>单个</strong>可延迟加载 chunk，此 chunk 将在第一次 import() 调用时获取，随后的 import() 调用将使用相同的网络响应；注意，这种模式仅在部分动态语句中有意义，例如 import(<code>./locales/${language}.json</code>)，其中可能含有多个被请求的模块路径；</li> <li><code>eager</code>：不会生成额外的 chunk，所有模块都被当前 chunk 引入，并且没有额外的网络请求。仍然会返回 Promise，但是是 resolved 状态。和静态导入相对比，在调用 <code>import()</code> 完成之前，该模块不会被执行。</li> <li><code>weak</code>：尝试加载模块，如果该模块函数已经以其他方式加载（即，另一个 chunk 导入过此模块，或包含模块的脚本被加载）。仍然会返回 Promise，但是只有在客户端上已经有该 chunk 时才成功解析。如果该模块不可用，Promise 将会是 rejected 状态，并且网络请求永远不会执行。当需要的 chunks 始终在（嵌入在页面中的）初始请求中手动提供，而不是在应用程序导航在最初没有提供的模块导入的情况触发，这对于 Server 端渲染（SSR，Server-Side Render）是非常有用的。</li></ul> <p>通过上面的神奇注释，<code>import()</code>不再是简单的 JavaScript 异步加载器，还是任意模块资源的加载器，举例说明：如果页面用到的图片都放在<code>src/assets/img</code>文件夹下，你们可以通过下面方式将用到的图片打包到一起：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;image&quot;, webpackInclude: /\.(png|jpg|gif)/ */</span> <span class="token string">'./assets/img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>prefetch 优先级低于 preload，preload 会并行或者加载完主文件之后立即加载；prefetch 则会在主文件之后、空闲时在加载。prefetch 和 preload 可以用于提前加载图片、样式等资源的功能。</p></blockquote> <h3 id="require-resolve-和require-resolveweak"><a href="#require-resolve-和require-resolveweak" class="header-anchor">#</a> <code>require.resolve()</code> 和<code>require.resolveWeak()</code></h3> <p><code>require.resolve()</code> 和 <code>require.resolveWeak()</code>都可以获取模块的唯一 ID（moduleId），区别在于<code>require.resolve()</code>会把模块真实引入进 bundle，而<code>require.resolveWeak()</code>则不会，配合<code>require.cache</code>和 <code>__webpack_modules__</code>可以用于判断模块是否加载成功或者是否可用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>__webpack_modules__<span class="token punctuation">[</span>require<span class="token punctuation">.</span><span class="token function">resolveWeak</span><span class="token punctuation">(</span><span class="token string">'module'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当模块可用时，做一些事情...</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>require<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>require<span class="token punctuation">.</span><span class="token function">resolveWeak</span><span class="token punctuation">(</span><span class="token string">'module'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当模块被加载之前，做一些事情...</span>
<span class="token punctuation">}</span>

<span class="token comment">// 可以执行动态解析（&quot;context&quot;）</span>
<span class="token comment">// 与其他 require/import 方法类似。</span>
<span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token string">'Foo'</span><span class="token punctuation">;</span>
__webpack_modules__<span class="token punctuation">[</span>require<span class="token punctuation">.</span><span class="token function">resolveWeak</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./page/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>page<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="require-context"><a href="#require-context" class="header-anchor">#</a> <code>require.context()</code></h3> <p><strong><code>require.context(directory, includeSubdirs, filter)</code>可以批量将<code>directory</code>内的文件全部引入进文件(这个在视频中有介绍到)</strong>，并且返回一个具有<code>resolve</code>的 context 对象，使用<code>context.resolve(moduleId)</code>则返回对应的模块。</p> <ul><li>directory：目录 string；</li> <li>includeSubdirs：是否包含子目录，可选，默认值是 true；</li> <li>filter：过滤正则规则，可选项。</li></ul> <blockquote><p>Tips：注意 <code>require.context()</code> 会将所有的文件都引入进 bundle！</p></blockquote> <h3 id="require-include"><a href="#require-include" class="header-anchor">#</a> <code>require.include()</code></h3> <blockquote><p><code>require.include()</code>已被废弃，不久将被删除。</p></blockquote> <p><code>require.include(dependency)</code>顾名思义为引入某个依赖，但是并不执行它，可以用于优化 chunk，例如下面示例代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>require<span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span><span class="token string">'./hello.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./hello.js'</span><span class="token punctuation">,</span> <span class="token string">'./weak.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./hello.js'</span><span class="token punctuation">,</span> <span class="token string">'./lazy.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="资源的模块化处理"><a href="#资源的模块化处理" class="header-anchor">#</a> 资源的模块化处理</h2> <p>Webpack 还对一些常用的 Node.js 模块和属性进行了 mock，例如：在 web 的 js 文件中可以直接引入 Node.js 的<code>querystring</code>模块，这个模块实际引入的是<a href="https://github.com/webpack/node-libs-browser" target="_blank" rel="noopener noreferrer">node-libs-browser<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来对 Node.js 核心库 polyfill，详细在 web 页面中可以用的 Node.js 模块，可以参考<a href="https://github.com/webpack/node-libs-browser" target="_blank" rel="noopener noreferrer">node-libs-browser<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Readme 文件的表格。</p> <h3 id="import和import"><a href="#import和import" class="header-anchor">#</a> <code>@import</code>和<code>import</code></h3> <p>在 Webpack 中的 css （包括其预处理语言，例如 Less、Sass）等，都可以在内部通过<code>@import</code>语法直接引入使用：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token atrule"><span class="token rule">@import</span> <span class="token string">'vars.less'</span><span class="token punctuation">;</span></span>
<span class="token selector">body</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@bg-color</span><span class="token punctuation">;</span></span>
<span class="token punctuation">}</span>
</code></pre></div><p>除了样式文件中的<code>@import</code>，在 JavaScript 文件中，还支持直接使用 ES6 Module 的<code>import</code>（包括 <code>require</code>）直接引入样式文件，例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./style.css'</span><span class="token punctuation">;</span>
</code></pre></div><p>JavaScript 的这种语法其实是 <a href="https://github.com/css-modules/css-modules" target="_blank" rel="noopener noreferrer">CSS Modules 语法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，目前浏览器支持程度有限，但是在 Webpack 中，可以通过配置 loader 优先使用这种方式！</p> <blockquote><p>后面讲解 CSS 样式配置的时候会更加详细的讲解 CSS Modules</p></blockquote> <h3 id="把资源作为模块引入"><a href="#把资源作为模块引入" class="header-anchor">#</a> 把资源作为模块引入</h3> <p>在 Webpack 中，除了 CSS 可以直接使用<code>import</code>语法引入，类似 HTML 和页面模板等，可以直接使用对应的 loader ，通过下面的语法来引入：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-loader!./loader.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的代码得到<code>html</code>变量实际为引入的<code>loader.html</code>的 string 片段。除了 html，类似模板文件，还可以直接转换为对应的 render 函数，例如下面代码使用了<a href="https://www.npmjs.com/package/ejs-loader" target="_blank" rel="noopener noreferrer">ejs-loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ejs!./file.ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; 得到 ejs 编译后的 render 函数</span>
<span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 传入 data，直接返回的是 html 片段</span>
</code></pre></div><blockquote><p>原理篇将动手手写一个 <code>markdown-loader</code> ，更深入的了解其功能和原理实现。</p></blockquote> <p>后续的一章，将会介绍webpack中重要的loaders处理，webpack借助loaders来处理各式各样的资源。</p></div> <!----> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes-page/devops/webpack/04-ES6语法支持.html" class="prev">
        Babel核心知识
      </a></span> <span class="next"><a href="/notes-page/devops/webpack/06-TS&amp;JS处理.html">
        TS&amp;JS处理
      </a>
      →
    </span></p></div>  <div class="el-dialog__wrapper" style="display:none;"><div role="dialog" aria-modal="true" aria-label="dialog" class="el-dialog" style="margin-top:15vh;width:420px;"><div class="el-dialog__header"><span class="el-dialog__title"></span><button type="button" aria-label="Close" class="el-dialog__headerbtn"><i class="el-dialog__close el-icon el-icon-close"></i></button></div><!----><div class="el-dialog__footer"><span class="dialog-footer"><button type="button" class="el-button el-button--default"><!----><!----><span>取 消</span></button> <button type="button" class="el-button el-button--primary"><!----><!----><span>确 定</span></button></span></div></div></div></main> <!----></div><div class="global-ui"><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/notes-page/assets/js/app.543bbfb2.js" defer></script><script src="/notes-page/assets/js/5.f19a8426.js" defer></script><script src="/notes-page/assets/js/57.25753be2.js" defer></script>
  </body>
</html>
