<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>è®¢é˜…æ¶ˆæ¯ | å¤§å‰ç«¯ - å‰ç«¯é«˜çº§è¿›é˜¶</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="å¤§å‰ç«¯è¯¾ç¨‹ç”µå­ä¹¦">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/notes-page/assets/css/0.styles.e2a3d81d.css" as="style"><link rel="preload" href="/notes-page/assets/js/app.8d82347b.js" as="script"><link rel="preload" href="/notes-page/assets/js/8.8378e173.js" as="script"><link rel="preload" href="/notes-page/assets/js/41.8b544b9b.js" as="script"><link rel="prefetch" href="/notes-page/assets/js/1.c91133a0.js"><link rel="prefetch" href="/notes-page/assets/js/10.ff4067df.js"><link rel="prefetch" href="/notes-page/assets/js/100.f50fb403.js"><link rel="prefetch" href="/notes-page/assets/js/101.b7840487.js"><link rel="prefetch" href="/notes-page/assets/js/102.31395dd4.js"><link rel="prefetch" href="/notes-page/assets/js/103.750137dd.js"><link rel="prefetch" href="/notes-page/assets/js/104.f0427d95.js"><link rel="prefetch" href="/notes-page/assets/js/105.37dd1353.js"><link rel="prefetch" href="/notes-page/assets/js/106.bf97e446.js"><link rel="prefetch" href="/notes-page/assets/js/107.143f1f97.js"><link rel="prefetch" href="/notes-page/assets/js/108.550b5c6d.js"><link rel="prefetch" href="/notes-page/assets/js/109.d94e771f.js"><link rel="prefetch" href="/notes-page/assets/js/11.4981bd69.js"><link rel="prefetch" href="/notes-page/assets/js/110.9818fc21.js"><link rel="prefetch" href="/notes-page/assets/js/111.33e1aa16.js"><link rel="prefetch" href="/notes-page/assets/js/112.8eae9a98.js"><link rel="prefetch" href="/notes-page/assets/js/113.6eab651e.js"><link rel="prefetch" href="/notes-page/assets/js/114.36a77934.js"><link rel="prefetch" href="/notes-page/assets/js/115.927c030e.js"><link rel="prefetch" href="/notes-page/assets/js/116.662f76d5.js"><link rel="prefetch" href="/notes-page/assets/js/117.9ea1f334.js"><link rel="prefetch" href="/notes-page/assets/js/118.960c567b.js"><link rel="prefetch" href="/notes-page/assets/js/119.3a887edd.js"><link rel="prefetch" href="/notes-page/assets/js/12.64f11313.js"><link rel="prefetch" href="/notes-page/assets/js/120.f7371ece.js"><link rel="prefetch" href="/notes-page/assets/js/121.bbf13598.js"><link rel="prefetch" href="/notes-page/assets/js/122.c2a4d925.js"><link rel="prefetch" href="/notes-page/assets/js/123.9a810e4a.js"><link rel="prefetch" href="/notes-page/assets/js/124.d1d40dc3.js"><link rel="prefetch" href="/notes-page/assets/js/125.4a10e266.js"><link rel="prefetch" href="/notes-page/assets/js/126.7addaf2d.js"><link rel="prefetch" href="/notes-page/assets/js/127.e9f88089.js"><link rel="prefetch" href="/notes-page/assets/js/128.e95c8f30.js"><link rel="prefetch" href="/notes-page/assets/js/129.06927dfd.js"><link rel="prefetch" href="/notes-page/assets/js/13.7e0d2680.js"><link rel="prefetch" href="/notes-page/assets/js/130.0c0e3f8c.js"><link rel="prefetch" href="/notes-page/assets/js/14.7bf5ee17.js"><link rel="prefetch" href="/notes-page/assets/js/15.bb350a93.js"><link rel="prefetch" href="/notes-page/assets/js/16.dabf0b5e.js"><link rel="prefetch" href="/notes-page/assets/js/17.98d14750.js"><link rel="prefetch" href="/notes-page/assets/js/18.5763d6b6.js"><link rel="prefetch" href="/notes-page/assets/js/19.238ef483.js"><link rel="prefetch" href="/notes-page/assets/js/20.86e8c5e3.js"><link rel="prefetch" href="/notes-page/assets/js/21.7dc55640.js"><link rel="prefetch" href="/notes-page/assets/js/22.3eaf4827.js"><link rel="prefetch" href="/notes-page/assets/js/23.ecaf9188.js"><link rel="prefetch" href="/notes-page/assets/js/24.a054aa87.js"><link rel="prefetch" href="/notes-page/assets/js/25.730c918f.js"><link rel="prefetch" href="/notes-page/assets/js/26.6fa9f436.js"><link rel="prefetch" href="/notes-page/assets/js/27.d0a0f09a.js"><link rel="prefetch" href="/notes-page/assets/js/28.6b7ca3bc.js"><link rel="prefetch" href="/notes-page/assets/js/29.3e9ee4f1.js"><link rel="prefetch" href="/notes-page/assets/js/30.bb684e3a.js"><link rel="prefetch" href="/notes-page/assets/js/31.6d97da62.js"><link rel="prefetch" href="/notes-page/assets/js/32.917c1d90.js"><link rel="prefetch" href="/notes-page/assets/js/33.9a82bcc0.js"><link rel="prefetch" href="/notes-page/assets/js/34.b4725e02.js"><link rel="prefetch" href="/notes-page/assets/js/35.3cd7e803.js"><link rel="prefetch" href="/notes-page/assets/js/36.46bba03e.js"><link rel="prefetch" href="/notes-page/assets/js/37.6efbec2b.js"><link rel="prefetch" href="/notes-page/assets/js/38.ffdc4047.js"><link rel="prefetch" href="/notes-page/assets/js/39.2279a878.js"><link rel="prefetch" href="/notes-page/assets/js/40.787b4ee4.js"><link rel="prefetch" href="/notes-page/assets/js/42.c6f53645.js"><link rel="prefetch" href="/notes-page/assets/js/43.bf6d321e.js"><link rel="prefetch" href="/notes-page/assets/js/44.2008ba74.js"><link rel="prefetch" href="/notes-page/assets/js/45.59008b73.js"><link rel="prefetch" href="/notes-page/assets/js/46.49e52b99.js"><link rel="prefetch" href="/notes-page/assets/js/47.80005d83.js"><link rel="prefetch" href="/notes-page/assets/js/48.e3188d29.js"><link rel="prefetch" href="/notes-page/assets/js/49.20513ba5.js"><link rel="prefetch" href="/notes-page/assets/js/50.d4177259.js"><link rel="prefetch" href="/notes-page/assets/js/51.11027efe.js"><link rel="prefetch" href="/notes-page/assets/js/52.bbf925f6.js"><link rel="prefetch" href="/notes-page/assets/js/53.b9e98df8.js"><link rel="prefetch" href="/notes-page/assets/js/54.f52364a9.js"><link rel="prefetch" href="/notes-page/assets/js/55.27b41299.js"><link rel="prefetch" href="/notes-page/assets/js/56.0a7f40d8.js"><link rel="prefetch" href="/notes-page/assets/js/57.7cada968.js"><link rel="prefetch" href="/notes-page/assets/js/58.c4635447.js"><link rel="prefetch" href="/notes-page/assets/js/59.9ebc2a41.js"><link rel="prefetch" href="/notes-page/assets/js/6.77cb7c96.js"><link rel="prefetch" href="/notes-page/assets/js/60.a230ec50.js"><link rel="prefetch" href="/notes-page/assets/js/61.6b2b0f7b.js"><link rel="prefetch" href="/notes-page/assets/js/62.85dd8f25.js"><link rel="prefetch" href="/notes-page/assets/js/63.0c0cf8ca.js"><link rel="prefetch" href="/notes-page/assets/js/64.1370f37f.js"><link rel="prefetch" href="/notes-page/assets/js/65.98768153.js"><link rel="prefetch" href="/notes-page/assets/js/66.0ac6e853.js"><link rel="prefetch" href="/notes-page/assets/js/67.b271c2a3.js"><link rel="prefetch" href="/notes-page/assets/js/68.b828ed00.js"><link rel="prefetch" href="/notes-page/assets/js/69.c926c773.js"><link rel="prefetch" href="/notes-page/assets/js/7.daa30952.js"><link rel="prefetch" href="/notes-page/assets/js/70.3a582146.js"><link rel="prefetch" href="/notes-page/assets/js/71.c15f8563.js"><link rel="prefetch" href="/notes-page/assets/js/72.44bb1e05.js"><link rel="prefetch" href="/notes-page/assets/js/73.2ff8cba5.js"><link rel="prefetch" href="/notes-page/assets/js/74.dccbf04a.js"><link rel="prefetch" href="/notes-page/assets/js/75.35a73a35.js"><link rel="prefetch" href="/notes-page/assets/js/76.bcaad751.js"><link rel="prefetch" href="/notes-page/assets/js/77.53c83a6d.js"><link rel="prefetch" href="/notes-page/assets/js/78.ff04a0bb.js"><link rel="prefetch" href="/notes-page/assets/js/79.9602d072.js"><link rel="prefetch" href="/notes-page/assets/js/80.fedde3d9.js"><link rel="prefetch" href="/notes-page/assets/js/81.339efb49.js"><link rel="prefetch" href="/notes-page/assets/js/82.b42f85c5.js"><link rel="prefetch" href="/notes-page/assets/js/83.a30b718a.js"><link rel="prefetch" href="/notes-page/assets/js/84.f345d7c8.js"><link rel="prefetch" href="/notes-page/assets/js/85.2b47b713.js"><link rel="prefetch" href="/notes-page/assets/js/86.123864fb.js"><link rel="prefetch" href="/notes-page/assets/js/87.77614ef6.js"><link rel="prefetch" href="/notes-page/assets/js/88.40695b18.js"><link rel="prefetch" href="/notes-page/assets/js/89.73eee99c.js"><link rel="prefetch" href="/notes-page/assets/js/9.be3a9ff7.js"><link rel="prefetch" href="/notes-page/assets/js/90.4d466b5d.js"><link rel="prefetch" href="/notes-page/assets/js/91.9396a6f7.js"><link rel="prefetch" href="/notes-page/assets/js/92.29004af9.js"><link rel="prefetch" href="/notes-page/assets/js/93.2880c851.js"><link rel="prefetch" href="/notes-page/assets/js/94.1652a1b8.js"><link rel="prefetch" href="/notes-page/assets/js/95.1babe436.js"><link rel="prefetch" href="/notes-page/assets/js/96.d85db9de.js"><link rel="prefetch" href="/notes-page/assets/js/97.f29e32ac.js"><link rel="prefetch" href="/notes-page/assets/js/98.dda637c1.js"><link rel="prefetch" href="/notes-page/assets/js/99.cafe8e47.js"><link rel="prefetch" href="/notes-page/assets/js/vendors~docsearch.6356b37d.js"><link rel="prefetch" href="/notes-page/assets/js/vendors~photo-swipe.55a61a85.js"><link rel="prefetch" href="/notes-page/assets/js/vendors~search-page.1437bcb7.js">
    <link rel="stylesheet" href="/notes-page/assets/css/0.styles.e2a3d81d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes-page/" class="home-link router-link-active"><!----> <span class="site-name">å¤§å‰ç«¯ - å‰ç«¯é«˜çº§è¿›é˜¶</span></a> <div class="links"><div id="docsearch"></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç¤¾åŒºPC</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/community-pc/" class="sidebar-link">PC</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç¤¾åŒºç®¡ç†åå°</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/community-admin/" class="sidebar-link">ç®¡ç†åå°</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç¤¾åŒºWebApp</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/community-webapp/" class="sidebar-link">webapp</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>å°ç¨‹åº</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/community-miniapp/" aria-current="page" class="sidebar-link">uniappä»‹ç»</a></li><li><a href="/notes-page/project/community-miniapp/01-æ­å»ºå¼€å‘ç¯å¢ƒ.html" class="sidebar-link">æ­å»ºå¼€å‘ç¯å¢ƒ</a></li><li><a href="/notes-page/project/community-miniapp/02-é¦–é¡µæ¨¡å—.html" class="sidebar-link">é¦–é¡µæ¨¡å—</a></li><li><a href="/notes-page/project/community-miniapp/03-ç™»å½•é‰´æƒ.html" class="sidebar-link">å°ç¨‹åºé‰´æƒç™»å½•</a></li><li><a href="/notes-page/project/community-miniapp/04-æ¶ˆæ¯&amp;çƒ­é—¨&amp;ä¸ªäººä¸­å¿ƒ.html" class="sidebar-link">æ¶ˆæ¯&amp;çƒ­é—¨&amp;ä¸ªäººä¸­å¿ƒ</a></li><li><a href="/notes-page/project/community-miniapp/05-RefreshTokenæœºåˆ¶.html" class="sidebar-link">RefreshTokenæœºåˆ¶</a></li><li><a href="/notes-page/project/community-miniapp/06-æ–‡ç« è¯¦æƒ….html" class="sidebar-link">æ–‡ç« è¯¦æƒ…</a></li><li><a href="/notes-page/project/community-miniapp/07-å®‰å…¨åŸŸåç›¸å…³.html" class="sidebar-link">å®‰å…¨åŸŸåç›¸å…³</a></li><li><a href="/notes-page/project/community-miniapp/08-è®¢é˜…æ¶ˆæ¯.html" class="active sidebar-link">è®¢é˜…æ¶ˆæ¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/project/community-miniapp/08-è®¢é˜…æ¶ˆæ¯.html#ä»‹ç»" class="sidebar-link">ä»‹ç»</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/project/community-miniapp/08-è®¢é˜…æ¶ˆæ¯.html#æ¶ˆæ¯ç±»å‹" class="sidebar-link">æ¶ˆæ¯ç±»å‹</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-miniapp/08-è®¢é˜…æ¶ˆæ¯.html#ä½¿ç”¨æ­¥éª¤" class="sidebar-link">ä½¿ç”¨æ­¥éª¤</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-miniapp/08-è®¢é˜…æ¶ˆæ¯.html#å°è£…è®¢é˜…æ¶ˆæ¯å·¥å…·js" class="sidebar-link">å°è£…è®¢é˜…æ¶ˆæ¯å·¥å…·js</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-miniapp/08-è®¢é˜…æ¶ˆæ¯.html#å‰ç«¯ä¸»åŠ¨è®¢é˜…" class="sidebar-link">å‰ç«¯ä¸»åŠ¨è®¢é˜…</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-miniapp/08-è®¢é˜…æ¶ˆæ¯.html#è®¢é˜…æ¶ˆæ¯æ¨¡æ¿api" class="sidebar-link">è®¢é˜…æ¶ˆæ¯æ¨¡æ¿API</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-miniapp/08-è®¢é˜…æ¶ˆæ¯.html#ç»´æŠ¤accesstoken" class="sidebar-link">ç»´æŠ¤accessToken</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-miniapp/08-è®¢é˜…æ¶ˆæ¯.html#åå°å‘é€è®¢é˜…æ¶ˆæ¯" class="sidebar-link">åå°å‘é€è®¢é˜…æ¶ˆæ¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/project/community-miniapp/08-è®¢é˜…æ¶ˆæ¯.html#httpsè°ƒç”¨æ¥å£è¯´æ˜" class="sidebar-link">HTTPSè°ƒç”¨æ¥å£è¯´æ˜</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-miniapp/08-è®¢é˜…æ¶ˆæ¯.html#åˆ›å»ºå‘é€æ¶ˆæ¯å·¥å…·js" class="sidebar-link">åˆ›å»ºå‘é€æ¶ˆæ¯å·¥å…·js</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-miniapp/08-è®¢é˜…æ¶ˆæ¯.html#å‰åç«¯è”è°ƒ" class="sidebar-link">å‰åç«¯è”è°ƒ</a></li></ul></li><li><a href="/notes-page/project/community-miniapp/09-å†…å®¹å®‰å…¨.html" class="sidebar-link">å†…å®¹å®‰å…¨</a></li><li><a href="/notes-page/project/community-miniapp/10-å‘è´´&amp;è¯„è®ºåŠŸèƒ½.html" class="sidebar-link">å‘è´´è¯„è®ºåŠŸèƒ½</a></li><li><a href="/notes-page/project/community-miniapp/11-å‘å¸ƒä¸Šçº¿.html" class="sidebar-link">å‘å¸ƒä¸Šçº¿</a></li><li><a href="/notes-page/project/community-miniapp/12-æ”¯ä»˜ä¸“é¢˜.html" class="sidebar-link">æ”¯ä»˜ä¸“é¢˜</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Flutter 2.0</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/community-flutter/" class="sidebar-link">flutter</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Electronæ¡Œé¢ç«¯</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/community-electron/" class="sidebar-link">electron</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Reactä¸–ç•Œ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/react/" class="sidebar-link">Reacté¡¹ç›®</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="è®¢é˜…æ¶ˆæ¯"><a href="#è®¢é˜…æ¶ˆæ¯" class="header-anchor">#</a> è®¢é˜…æ¶ˆæ¯</h1> <h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="header-anchor">#</a> ä»‹ç»</h2> <p>æ¶ˆæ¯èƒ½åŠ›æ˜¯å°ç¨‹åºèƒ½åŠ›ä¸­çš„é‡è¦ç»„æˆï¼Œæˆ‘ä»¬ä¸ºå¼€å‘è€…æä¾›äº†è®¢é˜…æ¶ˆæ¯èƒ½åŠ›ï¼Œä»¥ä¾¿å®ç°æœåŠ¡çš„é—­ç¯å’Œæ›´ä¼˜çš„ä½“éªŒã€‚</p> <ul><li>è®¢é˜…æ¶ˆæ¯æ¨é€ä½ç½®ï¼šæœåŠ¡é€šçŸ¥</li> <li>è®¢é˜…æ¶ˆæ¯ä¸‹å‘æ¡ä»¶ï¼šç”¨æˆ·è‡ªä¸»è®¢é˜…</li> <li>è®¢é˜…æ¶ˆæ¯å¡ç‰‡è·³è½¬èƒ½åŠ›ï¼šç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…å¯è·³è½¬è‡³è¯¥å°ç¨‹åºçš„é¡µé¢</li></ul> <p><img src="/notes-page/assets/img/request-subscribe-message.3851318e.3851318e.jpg" alt="intro"></p> <h3 id="æ¶ˆæ¯ç±»å‹"><a href="#æ¶ˆæ¯ç±»å‹" class="header-anchor">#</a> æ¶ˆæ¯ç±»å‹</h3> <p><strong>1. ä¸€æ¬¡æ€§è®¢é˜…æ¶ˆæ¯</strong></p> <p>ä¸€æ¬¡æ€§è®¢é˜…æ¶ˆæ¯ç”¨äºè§£å†³ç”¨æˆ·ä½¿ç”¨å°ç¨‹åºåï¼Œåç»­æœåŠ¡ç¯èŠ‚çš„é€šçŸ¥é—®é¢˜ã€‚ç”¨æˆ·è‡ªä¸»è®¢é˜…åï¼Œå¼€å‘è€…å¯<strong>ä¸é™æ—¶é—´</strong>åœ°ä¸‹å‘<strong>ä¸€æ¡å¯¹åº”çš„æœåŠ¡æ¶ˆæ¯</strong>ï¼›æ¯æ¡æ¶ˆæ¯å¯å•ç‹¬è®¢é˜…æˆ–é€€è®¢ã€‚</p> <p><strong>2. é•¿æœŸè®¢é˜…æ¶ˆæ¯</strong></p> <p>ä¸€æ¬¡æ€§è®¢é˜…æ¶ˆæ¯å¯æ»¡è¶³å°ç¨‹åºçš„å¤§éƒ¨åˆ†æœåŠ¡åœºæ™¯éœ€æ±‚ï¼Œä½†çº¿ä¸‹å…¬å…±æœåŠ¡é¢†åŸŸå­˜åœ¨ä¸€æ¬¡æ€§è®¢é˜…æ— æ³•æ»¡è¶³çš„åœºæ™¯ï¼Œå¦‚èˆªç­å»¶è¯¯ï¼Œéœ€æ ¹æ®èˆªç­å®æ—¶åŠ¨æ€æ¥å¤šæ¬¡å‘é€æ¶ˆæ¯æé†’ã€‚ä¸ºä¾¿äºæœåŠ¡ï¼Œæˆ‘ä»¬æä¾›äº†é•¿æœŸæ€§è®¢é˜…æ¶ˆæ¯ï¼Œç”¨æˆ·è®¢é˜…ä¸€æ¬¡åï¼Œå¼€å‘è€…å¯é•¿æœŸä¸‹å‘å¤šæ¡æ¶ˆæ¯ã€‚</p> <p>ç›®å‰é•¿æœŸæ€§è®¢é˜…æ¶ˆæ¯ä»…å‘æ”¿åŠ¡æ°‘ç”Ÿã€åŒ»ç–—ã€äº¤é€šã€é‡‘èã€æ•™è‚²ç­‰çº¿ä¸‹å…¬å…±æœåŠ¡å¼€æ”¾ï¼ŒåæœŸå°†é€æ­¥æ”¯æŒåˆ°å…¶ä»–çº¿ä¸‹å…¬å…±æœåŠ¡ä¸šåŠ¡ã€‚</p> <h3 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="header-anchor">#</a> ä½¿ç”¨æ­¥éª¤</h3> <ul><li><p>æ­¥éª¤ä¸€ï¼šè·å–æ¨¡æ¿ ID</p> <p>åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°æ‰‹åŠ¨é…ç½®è·å–æ¨¡æ¿ IDï¼š
ç™»å½• <a href="https://mp.weixin.qq.com/" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> è·å–æ¨¡æ¿ï¼Œå¦‚æœæ²¡æœ‰åˆé€‚çš„æ¨¡æ¿ï¼Œå¯ä»¥ç”³è¯·æ·»åŠ æ–°æ¨¡æ¿ï¼Œå®¡æ ¸é€šè¿‡åå¯ä½¿ç”¨ã€‚</p> <p><img src="https://res.wx.qq.com/wxdoc/dist/assets/img/subscribe-message.b562750a.jpg" alt="intro"></p></li> <li><p>æ­¥éª¤äºŒï¼šè·å–ä¸‹å‘æƒé™</p> <p>è¯¦è§å°ç¨‹åºç«¯æ¶ˆæ¯è®¢é˜…æ¥å£ <a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeMessage.html" target="_blank" rel="noopener noreferrer">wx.requestSubscribeMessage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>æ­¥éª¤ä¸‰ï¼šè°ƒç”¨æ¥å£ä¸‹å‘è®¢é˜…æ¶ˆæ¯</p> <p>è¯¦è§æœåŠ¡ç«¯æ¶ˆæ¯å‘é€æ¥å£ <a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html" target="_blank" rel="noopener noreferrer">subscribeMessage.send<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>æ³¨æ„äº‹é¡¹ï¼šç”¨æˆ·å‹¾é€‰ â€œæ€»æ˜¯ä¿æŒä»¥ä¸Šé€‰æ‹©ï¼Œä¸å†è¯¢é—®â€ ä¹‹åï¼Œä¸‹æ¬¡è®¢é˜…è°ƒç”¨ wx.requestSubscribeMessage ä¸ä¼šå¼¹çª—ï¼Œä¿æŒä¹‹å‰çš„é€‰æ‹©ï¼Œä¿®æ”¹é€‰æ‹©éœ€è¦æ‰“å¼€å°ç¨‹åºè®¾ç½®è¿›è¡Œä¿®æ”¹ã€‚</p></blockquote></li></ul> <h2 id="å°è£…è®¢é˜…æ¶ˆæ¯å·¥å…·js"><a href="#å°è£…è®¢é˜…æ¶ˆæ¯å·¥å…·js" class="header-anchor">#</a> å°è£…è®¢é˜…æ¶ˆæ¯å·¥å…·js</h2> <p>ä½œç”¨ï¼š</p> <ul><li>å‘èµ·è®¢é˜…è¯·æ±‚ï¼›</li> <li>åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å¼€å¯äº†é€šçŸ¥ï¼›</li> <li>æç¤ºæœªå¼€å¯é€šçŸ¥çš„ç”¨æˆ·ï¼Œå¹¶è·³è½¬è®¾ç½®é¡µé¢ï¼›</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> mute <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  uni<span class="token punctuation">.</span><span class="token function">requestSubscribeMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    tmplIds<span class="token operator">:</span> arr<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">?</span> arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">:</span> arr<span class="token punctuation">,</span>
    <span class="token comment">// åœ¨è°ƒè¯•å·¥å…·ä¸­ï¼Œæ— è®ºè®¢é˜…æˆåŠŸè¿˜æ˜¯å–æ¶ˆï¼Œéƒ½å¯ä»¥åœ¨completeå–åˆ°çŠ¶æ€</span>
    <span class="token comment">// è°ƒè¯•å·¥å…·ä¸­ï¼Œæ— æ³•ç›´æ¥æµ‹è¯•å…³é—­è®¢é˜…çš„çŠ¶æ€</span>
    <span class="token comment">// åœ¨çœŸæœºä¸Šï¼Œå¯ä»¥è·å–ç”¨æˆ·æ‹’ç»è®¢é˜…çš„çŠ¶æ€</span>
    <span class="token comment">// è€Œä¸”åœ¨completeéƒ¨åˆ†å¯ä»¥è·å–åˆ°success/failçš„å›è°ƒå†…å®¹</span>
    <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 2.1 å¦‚æœç”¨æˆ·æœªè®¢é˜…ï¼Œå¹¶æœªæ‹’ç»ï¼Œæ­£å¸¸å‘èµ·è®¢é˜…</span>
      <span class="token comment">// 2.2 å¦‚æœç”¨æˆ·æ‹’ç»äº†è®¢é˜…ï¼Œéœ€è¦ç»™ç”¨æˆ·ä¸€ä¸ªè½»æç¤º -&gt; æ‰‹åŠ¨æ‰“å¼€è®¢é˜…æ¶ˆæ¯çš„</span>
      <span class="token comment">// wx.openSetting</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'reject'</span><span class="token punctuation">)</span> <span class="token operator">||</span> res<span class="token punctuation">.</span>errCode <span class="token operator">===</span> <span class="token number">20004</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token string">'æ‚¨å…³é—­äº†è®¢é˜…é€šçŸ¥'</span><span class="token punctuation">,</span>
          content<span class="token operator">:</span> <span class="token string">'éœ€è¦æ‰“å¼€è®¾ç½®è¿›è¡Œæ‰‹åŠ¨è®¾ç½®å—ï¼Ÿ'</span><span class="token punctuation">,</span>
          <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              uni<span class="token punctuation">.</span><span class="token function">openSetting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>cancel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                icon<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
                title<span class="token operator">:</span> <span class="token string">'æ‚¨å–æ¶ˆäº†è®¢é˜…'</span><span class="token punctuation">,</span>
                duration<span class="token operator">:</span> <span class="token number">2000</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>arr<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'reject'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">!</span>mute <span class="token operator">&amp;&amp;</span> uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          icon<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
          title<span class="token operator">:</span> <span class="token string">'æ‚¨å·²ç»è®¢é˜…äº†è¯¥æ¶ˆæ¯'</span><span class="token punctuation">,</span>
          duration<span class="token operator">:</span> <span class="token number">1500</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>errCode <span class="token operator">===</span> <span class="token number">10002</span> <span class="token operator">||</span> res<span class="token punctuation">.</span>errCode <span class="token operator">===</span> <span class="token number">10003</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token string">'ç½‘ç»œé—®é¢˜è®¢é˜…å¤±è´¥ï¼Œè¯·é‡æ–°è®¢é˜…'</span><span class="token punctuation">,</span>
          duration<span class="token operator">:</span> <span class="token number">1500</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// å…¶ä»–çš„é€»è¾‘ https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeMessage.html</span>
      <span class="token punctuation">}</span>
      cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="å‰ç«¯ä¸»åŠ¨è®¢é˜…"><a href="#å‰ç«¯ä¸»åŠ¨è®¢é˜…" class="header-anchor">#</a> å‰ç«¯ä¸»åŠ¨è®¢é˜…</h2> <p>åœ¨App.vueä¸­æ·»åŠ åˆ¤æ–­ç”¨æˆ·è®¢é˜…é€»è¾‘ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">onLaunch</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.warn('å½“å‰ç»„ä»¶ä»…æ”¯æŒ uni_modules ç›®å½•ç»“æ„ ï¼Œè¯·å‡çº§ HBuilderX åˆ° 3.1.0 ç‰ˆæœ¬ä»¥ä¸Šï¼')</span>
    <span class="token comment">// console.log('App Launch')</span>
    uni<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      withSubscriptions<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>subscriptionsSetting <span class="token operator">=</span> res<span class="token punctuation">.</span>subscriptionsSetting
        <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
          <span class="token string">'S7zrpjN9Kq05-4ZG_nlTAYxnARMLWlSW09h54A2JCZo'</span><span class="token punctuation">,</span>
          <span class="token string">'ANN2-LhDgrhdFjs7jHOLdTnaxWpQU1LqS3kDIMF9GDs'</span><span class="token punctuation">,</span>
          <span class="token string">'FSQZganmBgaRRoNNlelQ1Qm2u4gx6pVSt69EJfkLbPA'</span><span class="token punctuation">,</span>
          <span class="token string">'g9FFU43_deHRuez-2FcrASorTSITsJJPYx-GhzvHEIU'</span>
        <span class="token punctuation">]</span>
        <span class="token comment">// 1. è·å–ç”¨æˆ·å·²ç»è®¢é˜…çš„æ¶ˆæ¯</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> itemSettings<span class="token operator">:</span> keys<span class="token punctuation">,</span> mainSwitch <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>subscriptionsSetting
        <span class="token comment">// ç›¸å½“äºç”¨æˆ·æœªæ‰“å¼€è®¢é˜…å¼€å…³</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mainSwitch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ç”¨æˆ·å¼€å¯è®¢é˜…æ¶ˆæ¯ -&gt; å¦‚æœæœªè®¾ç½®ä»»ä½•æ¶ˆæ¯</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>tmplIds <span class="token operator">=</span> arr
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// ç”¨æˆ·å¼€å¯äº†è®¢é˜…æ¶ˆæ¯ -&gt; å·²ç»æœ‰éƒ¨åˆ†è®¢é˜… -&gt; reject, accept</span>
          <span class="token keyword">const</span> keysArr <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span>
          app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>tmplIds <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> keysArr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onShow</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'App Show'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onHide</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'App Hide'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨éœ€è¦è®¢é˜…çš„ä½ç½®ï¼ŒåŠ å…¥è®¢é˜…é€»è¾‘ï¼Œæ¯”å¦‚åœ¨ä¸ªäººä¸­å¿ƒä¸­ï¼Œç‚¹å‡»å»ç™»å½•æ—¶ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> sub <span class="token keyword">from</span> <span class="token string">'@/common/utils/subscribe'</span>

<span class="token comment">// ...</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> tmplIds <span class="token operator">=</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>tmplIds <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token function">sub</span><span class="token punctuation">(</span>tmplIds<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      url<span class="token operator">:</span> <span class="token string">'/subcom-pkg/auth/auth'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>æ³¨æ„ï¼šè®¢é˜…æ¶ˆæ¯ä¸€æ¬¡æœ€å¤šåªå¯ä»¥è®¢é˜…3æ¡ï¼Œæ‰€ä»¥éœ€è¦åŠ å…¥ä¸€ä¸ªspliceæ–¹æ³•æˆªæ–­æœªè®¢é˜…çš„æ¶ˆæ¯ã€‚</p> <p>ä¹Ÿå¯ä»¥è‡ªå·±åœ¨æŒ‡å®šçš„ä¸šåŠ¡éƒ¨åˆ†ï¼Œç»™<code>sub</code>æ–¹æ³•ï¼Œä¼ é€’æŒ‡å®šçš„æ¨¡æ¿IDã€‚</p></blockquote> <h2 id="è®¢é˜…æ¶ˆæ¯æ¨¡æ¿api"><a href="#è®¢é˜…æ¶ˆæ¯æ¨¡æ¿api" class="header-anchor">#</a> è®¢é˜…æ¶ˆæ¯æ¨¡æ¿API</h2> <p>åº”ç”¨åœºæ™¯ï¼š</p> <ul><li>åå°æ§åˆ¶å“ªäº›æ¶ˆæ¯å¯ä»¥è¢«è®¢é˜…ï¼›</li> <li>å½“æ¨¡æ¿æ¶ˆæ¯çš„idå‘ç”Ÿäº†å˜åŒ–æ—¶ï¼Œå¦‚æœä¿è¯è®¢é˜…çš„å‡†ç¡®æ€§ï¼›</li></ul> <p>å‰ç«¯è¯·æ±‚æ¨¡æ¿APIï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// è·å–æ¨¡æ¿id</span>
<span class="token keyword">const</span> <span class="token function-variable function">getSubIds</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/public/subids'</span><span class="token punctuation">)</span>
</code></pre></div><p>è°ƒæ•´App.vueä¸­çš„æ¨¡æ¿IDsçš„åˆ¤æ–­é€»è¾‘ï¼Œå¤„ç†ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ¨¡æ¿ID</span>
<span class="token comment">// æ”¹è£…æˆä¸€ä¸ªAPIæ¥å£ -&gt; key:value -&gt; value, key -&gt; ä¸šåŠ¡åœºæ™¯</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> code<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$u<span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">getSubIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> arr
<span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// {key: value, key1: value1} =&gt; [value, value1]</span>
  arr <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">o</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// é»˜è®¤çš„å‰ç«¯æ¨¡æ¿æ•°æ®</span>
  arr <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'S7zrpjN9Kq05-4ZG_nlTAYxnARMLWlSW09h54A2JCZo'</span><span class="token punctuation">,</span>
    <span class="token string">'ANN2-LhDgrhdFjs7jHOLdTnaxWpQU1LqS3kDIMF9GDs'</span><span class="token punctuation">,</span>
    <span class="token string">'FSQZganmBgaRRoNNlelQ1Qm2u4gx6pVSt69EJfkLbPA'</span><span class="token punctuation">,</span>
    <span class="token string">'g9FFU43_deHRuez-2FcrASorTSITsJJPYx-GhzvHEIU'</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åç«¯åˆ›å»ºè·¯ç”±ä¸æ¥å£ï¼š</p> <p>è·¯ç”±ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// è·å–å¾®ä¿¡æ¨¡æ¿id</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/subids'</span><span class="token punctuation">,</span> publicController<span class="token punctuation">.</span>getSubIds<span class="token punctuation">)</span>
</code></pre></div><p>æ¥å£ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token function">getSubIds</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> config<span class="token punctuation">.</span>subIds
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ç»´æŠ¤accesstoken"><a href="#ç»´æŠ¤accesstoken" class="header-anchor">#</a> ç»´æŠ¤accessToken</h2> <p>åç«¯å‘é€è®¢é˜…æ¶ˆæ¯éœ€è¦accessTokenï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">POST</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>api<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>qq<span class="token punctuation">.</span>com<span class="token operator">/</span>cgi<span class="token operator">-</span>bin<span class="token operator">/</span>message<span class="token operator">/</span>subscribe<span class="token operator">/</span>send<span class="token operator">?</span>access_token<span class="token operator">=</span><span class="token constant">ACCESS_TOKEN</span>
</code></pre></div><p>è§å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html" target="_blank" rel="noopener noreferrer">é“¾æ¥<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>ç”±äºacessTokençš„æœ‰æ•ˆæ—¶é—´æ˜¯2å°æ—¶ï¼Œè€Œä¸”æ¯å¤©å¾®ä¿¡è¯·æ±‚çš„é™åˆ¶ä¸º2000æ¬¡ï¼ˆ<a href="https://developers.weixin.qq.com/doc/offiaccount/Message_Management/API_Call_Limits.html" target="_blank" rel="noopener noreferrer">é“¾æ¥<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼‰ï¼Œå¦‚ä¸‹å›¾ï¼š</p> <img src="/notes-page/assets/img/image-20210812102933432.90192975.png" alt="image-20210812102933432" style="zoom:67%;"> <p>æ‰€ä»¥ï¼Œéœ€è¦è‡ªå·±å®šæ—¶ç»´æŠ¤accessTokenï¼š</p> <ul><li><p>åˆ›å»º<code>wxGetAccessToken</code>æ–¹æ³•ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> log4js <span class="token keyword">from</span> <span class="token string">'@/config/Log4j'</span>
<span class="token keyword">const</span> logger <span class="token operator">=</span> log4js<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getValue<span class="token punctuation">,</span> setValue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/config/RedisConfig'</span>

<span class="token comment">// flag å¼ºåˆ¶åˆ·æ–°ï¼Œé»˜è®¤false - ä¸å¼ºåˆ¶åˆ·æ–°</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">wxGetAccessToken</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">flag <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=APPID&amp;secret=APPSECRET</span>
  <span class="token comment">// 1.åˆ¤æ–­redisä¸­æ˜¯å¦æœ‰accessToken</span>
  <span class="token comment">// 2.æœ‰ &amp; flag -&gt; åˆ™ç›´æ¥è¿”å›</span>
  <span class="token comment">// 3.æ²¡æœ‰ -&gt; è¯·æ±‚æ–°çš„token</span>
  <span class="token keyword">let</span> accessToken <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">'accessToken'</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>accessToken <span class="token operator">||</span> flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> instance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span>AppID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;secret=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span>AppSecret<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token comment">// console.log('ğŸš€ ~ file: WxUtils.js ~ line 60 ~ wxGetAccessToken ~ result', result)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">'accessToken'</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>access_token<span class="token punctuation">,</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>expires_in<span class="token punctuation">)</span>
        accessToken <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>access_token
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>errcode <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>errmsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">wxGetAccessToken error</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>errcode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>errmsg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">wxGetAccessToken error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> accessToken
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>å®‰è£…ä¾èµ–<code>npm i cron</code></p></li> <li><p>é…ç½®å®šæ—¶ä»»åŠ¡ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ¯éš”7200ç§’æ‰§è¡Œä¸€æ¬¡ åˆ·æ–°accessToken</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CronJob <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cron'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> wxGetAccessToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./WxUtils'</span>

<span class="token comment">// Seconds: 0-59</span>
<span class="token comment">// Minutes: 0-59</span>
<span class="token comment">// Hours: 0-23</span>
<span class="token comment">// Day of Month: 1-31</span>
<span class="token comment">// Months: 0-11 (Jan-Dec)</span>
<span class="token comment">// Day of Week: 0-6 (Sun-Sat)</span>

<span class="token keyword">const</span> job <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CronJob</span><span class="token punctuation">(</span><span class="token string">'* * */1 * * *'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">wxGetAccessToken</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

job<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>åœ¨å…¥å£æ–‡ä»¶å¤„ç†ï¼Œæ·»åŠ è¯¥æ–‡ä»¶ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./common/Cron'</span>
</code></pre></div></li></ul> <p><strong>å¸¸è§é—®é¢˜ï¼Œå¦‚æœä¸å°å¿ƒaccessTokenè¯·æ±‚è¶…é™æ€ä¹ˆåŠï¼š</strong></p> <p><img src="/notes-page/assets/img/0.a36c9ed1.png" alt="img"></p> <h2 id="åå°å‘é€è®¢é˜…æ¶ˆæ¯"><a href="#åå°å‘é€è®¢é˜…æ¶ˆæ¯" class="header-anchor">#</a> åå°å‘é€è®¢é˜…æ¶ˆæ¯</h2> <p>å‘é€è®¢é˜…æ¶ˆæ¯ï¼š<a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>è°ƒç”¨æ–¹å¼ï¼š</p> <ul><li><a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html#method-http" target="_blank" rel="noopener noreferrer">HTTPS è°ƒç”¨<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html#method-cloud" target="_blank" rel="noopener noreferrer">äº‘è°ƒç”¨<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="httpsè°ƒç”¨æ¥å£è¯´æ˜"><a href="#httpsè°ƒç”¨æ¥å£è¯´æ˜" class="header-anchor">#</a> HTTPSè°ƒç”¨æ¥å£è¯´æ˜</h3> <div class="language- extra-class"><pre class="language-text"><code>POST https://api.weixin.qq.com/cgi-bin/message/subscribe/send?access_token=ACCESS_TOKEN
</code></pre></div><p><strong>è¯·æ±‚å‚æ•°ï¼š</strong></p> <table><thead><tr><th style="text-align:left;">å±æ€§</th> <th style="text-align:left;">ç±»å‹</th> <th style="text-align:left;">é»˜è®¤å€¼</th> <th style="text-align:left;">å¿…å¡«</th> <th style="text-align:left;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:left;">access_token / cloudbase_access_token</td> <td style="text-align:left;">string</td> <td style="text-align:left;"></td> <td style="text-align:left;">æ˜¯</td> <td style="text-align:left;"><a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/access-token/auth.getAccessToken.html" target="_blank" rel="noopener noreferrer">æ¥å£è°ƒç”¨å‡­è¯<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td style="text-align:left;">touser</td> <td style="text-align:left;">string</td> <td style="text-align:left;"></td> <td style="text-align:left;">æ˜¯</td> <td style="text-align:left;">æ¥æ”¶è€…ï¼ˆç”¨æˆ·ï¼‰çš„ openid</td></tr> <tr><td style="text-align:left;">template_id</td> <td style="text-align:left;">string</td> <td style="text-align:left;"></td> <td style="text-align:left;">æ˜¯</td> <td style="text-align:left;">æ‰€éœ€ä¸‹å‘çš„è®¢é˜…æ¨¡æ¿id</td></tr> <tr><td style="text-align:left;">page</td> <td style="text-align:left;">string</td> <td style="text-align:left;"></td> <td style="text-align:left;">å¦</td> <td style="text-align:left;">ç‚¹å‡»æ¨¡æ¿å¡ç‰‡åçš„è·³è½¬é¡µé¢ï¼Œä»…é™æœ¬å°ç¨‹åºå†…çš„é¡µé¢ã€‚æ”¯æŒå¸¦å‚æ•°,ï¼ˆç¤ºä¾‹index?foo=barï¼‰ã€‚è¯¥å­—æ®µä¸å¡«åˆ™æ¨¡æ¿æ— è·³è½¬ã€‚</td></tr> <tr><td style="text-align:left;">data</td> <td style="text-align:left;">Object</td> <td style="text-align:left;"></td> <td style="text-align:left;">æ˜¯</td> <td style="text-align:left;">æ¨¡æ¿å†…å®¹ï¼Œæ ¼å¼å½¢å¦‚ { &quot;key1&quot;: { &quot;value&quot;: any }, &quot;key2&quot;: { &quot;value&quot;: any } }</td></tr> <tr><td style="text-align:left;">miniprogram_state</td> <td style="text-align:left;">string</td> <td style="text-align:left;"></td> <td style="text-align:left;">å¦</td> <td style="text-align:left;">è·³è½¬å°ç¨‹åºç±»å‹ï¼šdeveloperä¸ºå¼€å‘ç‰ˆï¼›trialä¸ºä½“éªŒç‰ˆï¼›formalä¸ºæ­£å¼ç‰ˆï¼›é»˜è®¤ä¸ºæ­£å¼ç‰ˆ</td></tr> <tr><td style="text-align:left;">lang</td> <td style="text-align:left;">string</td> <td style="text-align:left;"></td> <td style="text-align:left;">å¦</td> <td style="text-align:left;">è¿›å…¥å°ç¨‹åºæŸ¥çœ‹â€çš„è¯­è¨€ç±»å‹ï¼Œæ”¯æŒzh_CN(ç®€ä½“ä¸­æ–‡)ã€en_US(è‹±æ–‡)ã€zh_HK(ç¹ä½“ä¸­æ–‡)ã€zh_TW(ç¹ä½“ä¸­æ–‡)ï¼Œé»˜è®¤ä¸ºzh_CN</td></tr></tbody></table> <p><strong>è¯´æ˜ä¸€ä¸‹å…³äº<code>data</code>ï¼š</strong></p> <p>ä¾‹å¦‚ï¼Œæ¨¡æ¿çš„å†…å®¹ä¸º</p> <div class="language-text extra-class"><pre class="language-text"><code>å§“å: {{name01.DATA}}
é‡‘é¢: {{amount01.DATA}}
è¡Œç¨‹: {{thing01.DATA}}
æ—¥æœŸ: {{date01.DATA}}
</code></pre></div><p>åˆ™å¯¹åº”çš„jsonä¸º</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;touser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OPENID&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;template_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;TEMPLATE_ID&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;name01&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;æŸæŸ&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;amount01&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ï¿¥100&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;thing01&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;å¹¿å·è‡³åŒ—äº¬&quot;</span>
      <span class="token punctuation">}</span> <span class="token punctuation">,</span>
      <span class="token property">&quot;date01&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2018-01-01&quot;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™é‡Œçš„dataæœ‰å†…å®¹é™åˆ¶ï¼ˆä¸¾ä¾‹å¦‚ä¸‹è¡¨ï¼‰ï¼Œæ›´å¤šæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£è¯¦æƒ…ï¼š</p> <table><thead><tr><th style="text-align:left;">å‚æ•°ç±»åˆ«</th> <th style="text-align:left;">å‚æ•°è¯´æ˜</th> <th style="text-align:left;">å‚æ•°å€¼é™åˆ¶</th> <th style="text-align:left;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:left;">thing.DATA</td> <td style="text-align:left;">äº‹ç‰©</td> <td style="text-align:left;">20ä¸ªä»¥å†…å­—ç¬¦</td> <td style="text-align:left;">å¯æ±‰å­—ã€æ•°å­—ã€å­—æ¯æˆ–ç¬¦å·ç»„åˆ</td></tr> <tr><td style="text-align:left;">number.DATA</td> <td style="text-align:left;">æ•°å­—</td> <td style="text-align:left;">32ä½ä»¥å†…æ•°å­—</td> <td style="text-align:left;">åªèƒ½æ•°å­—ï¼Œå¯å¸¦å°æ•°</td></tr> <tr><td style="text-align:left;">letter.DATA</td> <td style="text-align:left;">å­—æ¯</td> <td style="text-align:left;">32ä½ä»¥å†…å­—æ¯</td> <td style="text-align:left;">åªèƒ½å­—æ¯</td></tr> <tr><td style="text-align:left;">symbol.DATA</td> <td style="text-align:left;">ç¬¦å·</td> <td style="text-align:left;">5ä½ä»¥å†…ç¬¦å·</td> <td style="text-align:left;">åªèƒ½ç¬¦å·</td></tr> <tr><td style="text-align:left;">character_string.DATA</td> <td style="text-align:left;">å­—ç¬¦ä¸²</td> <td style="text-align:left;">32ä½ä»¥å†…æ•°å­—ã€å­—æ¯æˆ–ç¬¦å·</td> <td style="text-align:left;">å¯æ•°å­—ã€å­—æ¯æˆ–ç¬¦å·ç»„åˆ</td></tr> <tr><td style="text-align:left;">time.DATA</td> <td style="text-align:left;">æ—¶é—´</td> <td style="text-align:left;">24å°æ—¶åˆ¶æ—¶é—´æ ¼å¼ï¼ˆæ”¯æŒ+å¹´æœˆæ—¥ï¼‰ï¼Œæ”¯æŒå¡«æ—¶é—´æ®µï¼Œä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´ç”¨â€œ~â€ç¬¦å·è¿æ¥</td> <td style="text-align:left;">ä¾‹å¦‚ï¼š15:01ï¼Œæˆ–ï¼š2019å¹´10æœˆ1æ—¥ 15:01</td></tr> <tr><td style="text-align:left;">date.DATA</td> <td style="text-align:left;">æ—¥æœŸ</td> <td style="text-align:left;">å¹´æœˆæ—¥æ ¼å¼ï¼ˆæ”¯æŒ+24å°æ—¶åˆ¶æ—¶é—´ï¼‰ï¼Œæ”¯æŒå¡«æ—¶é—´æ®µï¼Œä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´ç”¨â€œ~â€ç¬¦å·è¿æ¥</td> <td style="text-align:left;">ä¾‹å¦‚ï¼š2019å¹´10æœˆ1æ—¥ï¼Œæˆ–ï¼š2019å¹´10æœˆ1æ—¥ 15:01</td></tr> <tr><td style="text-align:left;">amount.DATA</td> <td style="text-align:left;">é‡‘é¢</td> <td style="text-align:left;">1ä¸ªå¸ç§ç¬¦å·+10ä½ä»¥å†…çº¯æ•°å­—ï¼Œå¯å¸¦å°æ•°ï¼Œç»“å°¾å¯å¸¦â€œå…ƒâ€</td> <td style="text-align:left;">å¯å¸¦å°æ•°</td></tr> <tr><td style="text-align:left;">phone_number.DATA</td> <td style="text-align:left;">ç”µè¯</td> <td style="text-align:left;">17ä½ä»¥å†…ï¼Œæ•°å­—ã€ç¬¦å·</td> <td style="text-align:left;">ç”µè¯å·ç ï¼Œä¾‹ï¼š+86-0766-66888866</td></tr> <tr><td style="text-align:left;">car_number.DATA</td> <td style="text-align:left;">è½¦ç‰Œ</td> <td style="text-align:left;">8ä½ä»¥å†…ï¼Œç¬¬ä¸€ä½ä¸æœ€åä¸€ä½å¯ä¸ºæ±‰å­—ï¼Œå…¶ä½™ä¸ºå­—æ¯æˆ–æ•°å­—</td> <td style="text-align:left;">è½¦ç‰Œå·ç ï¼šç²¤A8Z888æŒ‚</td></tr> <tr><td style="text-align:left;">name.DATA</td> <td style="text-align:left;">å§“å</td> <td style="text-align:left;">10ä¸ªä»¥å†…çº¯æ±‰å­—æˆ–20ä¸ªä»¥å†…çº¯å­—æ¯æˆ–ç¬¦å·</td> <td style="text-align:left;">ä¸­æ–‡å10ä¸ªæ±‰å­—å†…ï¼›çº¯è‹±æ–‡å20ä¸ªå­—æ¯å†…ï¼›ä¸­æ–‡å’Œå­—æ¯æ··åˆæŒ‰ä¸­æ–‡åç®—ï¼Œ10ä¸ªå­—å†…</td></tr> <tr><td style="text-align:left;">phrase.DATA</td> <td style="text-align:left;">æ±‰å­—</td> <td style="text-align:left;">5ä¸ªä»¥å†…æ±‰å­—</td> <td style="text-align:left;">5ä¸ªä»¥å†…çº¯æ±‰å­—ï¼Œä¾‹å¦‚ï¼šé…é€ä¸­</td></tr></tbody></table> <p>è¿”å›çš„ JSON æ•°æ®åŒ…</p> <table><thead><tr><th style="text-align:left;">å±æ€§</th> <th style="text-align:left;">ç±»å‹</th> <th style="text-align:left;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:left;">errcode</td> <td style="text-align:left;">number</td> <td style="text-align:left;">é”™è¯¯ç </td></tr> <tr><td style="text-align:left;">errmsg</td> <td style="text-align:left;">string</td> <td style="text-align:left;">é”™è¯¯ä¿¡æ¯</td></tr></tbody></table> <p><strong>errcode çš„åˆæ³•å€¼</strong></p> <table><thead><tr><th style="text-align:left;">å€¼</th> <th style="text-align:left;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:left;">40003</td> <td style="text-align:left;">touserå­—æ®µopenidä¸ºç©ºæˆ–è€…ä¸æ­£ç¡®</td></tr> <tr><td style="text-align:left;">40037</td> <td style="text-align:left;">è®¢é˜…æ¨¡æ¿idä¸ºç©ºä¸æ­£ç¡®</td></tr> <tr><td style="text-align:left;">43101</td> <td style="text-align:left;">ç”¨æˆ·æ‹’ç»æ¥å—æ¶ˆæ¯ï¼Œå¦‚æœç”¨æˆ·ä¹‹å‰æ›¾ç»è®¢é˜…è¿‡ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·å–æ¶ˆäº†è®¢é˜…å…³ç³»</td></tr> <tr><td style="text-align:left;">47003</td> <td style="text-align:left;">æ¨¡æ¿å‚æ•°ä¸å‡†ç¡®ï¼Œå¯èƒ½ä¸ºç©ºæˆ–è€…ä¸æ»¡è¶³è§„åˆ™ï¼Œerrmsgä¼šæç¤ºå…·ä½“æ˜¯å“ªä¸ªå­—æ®µå‡ºé”™</td></tr> <tr><td style="text-align:left;">41030</td> <td style="text-align:left;">pageè·¯å¾„ä¸æ­£ç¡®ï¼Œéœ€è¦ä¿è¯åœ¨ç°ç½‘ç‰ˆæœ¬å°ç¨‹åºä¸­å­˜åœ¨ï¼Œä¸app.jsonä¿æŒä¸€è‡´</td></tr></tbody></table> <h3 id="åˆ›å»ºå‘é€æ¶ˆæ¯å·¥å…·js"><a href="#åˆ›å»ºå‘é€æ¶ˆæ¯å·¥å…·js" class="header-anchor">#</a> åˆ›å»ºå‘é€æ¶ˆæ¯å·¥å…·js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">wxSendMessage</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// POST https://api.weixin.qq.com/cgi-bin/message/subscribe/send?access_token=ACCESS_TOKEN</span>
  <span class="token keyword">let</span> accessToken <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wxGetAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> instance<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.weixin.qq.com/cgi-bin/message/subscribe/send?access_token=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>accessToken<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token keyword">return</span> data
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">wxSendMessage error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸¾ä¾‹ï¼š</p> <p>åœ¨ç”¨æˆ·ç™»å½•ä¹‹åï¼Œå‘é€è®¢é˜…æ¶ˆæ¯é€šçŸ¥ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ¨é€æ¶ˆæ¯</span>
<span class="token comment">// å­—æ®µé™åˆ¶ï¼šhttps://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html</span>
<span class="token keyword">const</span> notify <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wxSendMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  touser<span class="token operator">:</span> tmpUser<span class="token punctuation">.</span>openid<span class="token punctuation">,</span>
  template_id<span class="token operator">:</span> <span class="token string">'FSQZganmBgaRRoNNlelQ1Qm2u4gx6pVSt69EJfkLbPA'</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    phrase1<span class="token operator">:</span> <span class="token punctuation">{</span>
      value<span class="token operator">:</span> <span class="token string">'ç™»å½•å®‰å…¨'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    date2<span class="token operator">:</span> <span class="token punctuation">{</span>
      value<span class="token operator">:</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYYå¹´MMæœˆDD HH:mm'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    thing4<span class="token operator">:</span> <span class="token punctuation">{</span>
      value<span class="token operator">:</span> <span class="token string">'é€šè¿‡å¾®ä¿¡æˆæƒç™»å½•æˆåŠŸï¼Œè¯·æ³¨æ„ä¿¡æ¯å®‰å…¨'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  miniprogram_state<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span> <span class="token operator">?</span> <span class="token string">'developer'</span> <span class="token operator">:</span> <span class="token string">'formal'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="å‰åç«¯è”è°ƒ"><a href="#å‰åç«¯è”è°ƒ" class="header-anchor">#</a> å‰åç«¯è”è°ƒ</h2> <p>è”è°ƒéœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p> <ul><li>è®¾ç½®<code>miniprogram_state</code>å±æ€§ï¼›</li> <li>ä½¿ç”¨çœŸæœºè¿›è¡Œè°ƒè¯• -&gt; é…ç½®å±€åŸŸç½‘çš„è®¿é—®çš„IP -&gt; è®©ç”µè„‘ä¸æ‰‹æœºå¤„äºåŒä¸€ä¸ªç½‘æ®µï¼›</li> <li>æ£€æŸ¥å‘é€è®¢é˜…æ¶ˆæ¯çš„æ•°æ®æ ¼å¼ã€æ¨¡æ¿idã€ç”¨æˆ·openidæ•°æ®æ˜¯å¦æ­£ç¡®ï¼›</li> <li>ä½¿ç”¨å•æ­¥è°ƒè¯•ï¼šå‘é€è®¢é˜…æ¶ˆæ¯çš„æ¥å£ï¼ŒæŸ¥çœ‹è¿”å›çš„errcodeå¦‚æœæ˜¯0ï¼Œè¯´æ˜å‘é€æˆåŠŸï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™æ ¹æ®errcodeæ¥è°ƒæ•´ç¨‹åºä»£ç ï¼›</li></ul> <img src="/notes-page/assets/img/image-20210812111502555.6ac23418.png" alt="image-20210812111502555" style="zoom:67%;"></div> <!----> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/notes-page/project/community-miniapp/07-å®‰å…¨åŸŸåç›¸å…³.html" class="prev">
        å®‰å…¨åŸŸåç›¸å…³
      </a></span> <span class="next"><a href="/notes-page/project/community-miniapp/09-å†…å®¹å®‰å…¨.html">
        å†…å®¹å®‰å…¨
      </a>
      â†’
    </span></p></div>  <div class="el-dialog__wrapper" style="display:none;"><div role="dialog" aria-modal="true" aria-label="dialog" class="el-dialog" style="margin-top:15vh;width:420px;"><div class="el-dialog__header"><span class="el-dialog__title"></span><button type="button" aria-label="Close" class="el-dialog__headerbtn"><i class="el-dialog__close el-icon el-icon-close"></i></button></div><!----><div class="el-dialog__footer"><span class="dialog-footer"><button type="button" class="el-button el-button--default"><!----><!----><span>å– æ¶ˆ</span></button> <button type="button" class="el-button el-button--primary"><!----><!----><span>ç¡® å®š</span></button></span></div></div></div></main> <!----></div><div class="global-ui"><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/notes-page/assets/js/app.8d82347b.js" defer></script><script src="/notes-page/assets/js/8.8378e173.js" defer></script><script src="/notes-page/assets/js/41.8b544b9b.js" defer></script>
  </body>
</html>
