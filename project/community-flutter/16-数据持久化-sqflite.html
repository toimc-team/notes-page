<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据持久化-Sqflite | 大前端 - 前端高级进阶</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="大前端课程电子书">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/notes-page/assets/css/0.styles.ee344319.css" as="style"><link rel="preload" href="/notes-page/assets/js/app.bf2e4db7.js" as="script"><link rel="preload" href="/notes-page/assets/js/8.645bf0c6.js" as="script"><link rel="preload" href="/notes-page/assets/js/57.7cf81658.js" as="script"><link rel="prefetch" href="/notes-page/assets/js/1.8be2b47d.js"><link rel="prefetch" href="/notes-page/assets/js/10.4b42aa1c.js"><link rel="prefetch" href="/notes-page/assets/js/100.29b2f131.js"><link rel="prefetch" href="/notes-page/assets/js/101.25907506.js"><link rel="prefetch" href="/notes-page/assets/js/102.4c6609f4.js"><link rel="prefetch" href="/notes-page/assets/js/103.5697975e.js"><link rel="prefetch" href="/notes-page/assets/js/104.22475088.js"><link rel="prefetch" href="/notes-page/assets/js/105.e3a2732c.js"><link rel="prefetch" href="/notes-page/assets/js/106.52d20db8.js"><link rel="prefetch" href="/notes-page/assets/js/107.a8b21ac3.js"><link rel="prefetch" href="/notes-page/assets/js/108.b028c59e.js"><link rel="prefetch" href="/notes-page/assets/js/109.b9b0c671.js"><link rel="prefetch" href="/notes-page/assets/js/11.a21a5b7b.js"><link rel="prefetch" href="/notes-page/assets/js/110.9de954c0.js"><link rel="prefetch" href="/notes-page/assets/js/111.b84a7c1c.js"><link rel="prefetch" href="/notes-page/assets/js/112.cc380389.js"><link rel="prefetch" href="/notes-page/assets/js/113.6c38ac63.js"><link rel="prefetch" href="/notes-page/assets/js/114.c37a2dff.js"><link rel="prefetch" href="/notes-page/assets/js/115.30d5a0a6.js"><link rel="prefetch" href="/notes-page/assets/js/116.6aeeaad9.js"><link rel="prefetch" href="/notes-page/assets/js/117.0fcee5ea.js"><link rel="prefetch" href="/notes-page/assets/js/118.0969cc7a.js"><link rel="prefetch" href="/notes-page/assets/js/119.862abaf8.js"><link rel="prefetch" href="/notes-page/assets/js/12.95eb4d5d.js"><link rel="prefetch" href="/notes-page/assets/js/120.044cc7b4.js"><link rel="prefetch" href="/notes-page/assets/js/121.777a126b.js"><link rel="prefetch" href="/notes-page/assets/js/122.00483452.js"><link rel="prefetch" href="/notes-page/assets/js/123.8463c60c.js"><link rel="prefetch" href="/notes-page/assets/js/124.eae7f4ff.js"><link rel="prefetch" href="/notes-page/assets/js/125.9e445255.js"><link rel="prefetch" href="/notes-page/assets/js/126.35d01afc.js"><link rel="prefetch" href="/notes-page/assets/js/127.daf64f66.js"><link rel="prefetch" href="/notes-page/assets/js/128.d346488a.js"><link rel="prefetch" href="/notes-page/assets/js/129.e1fdbe72.js"><link rel="prefetch" href="/notes-page/assets/js/13.a347bb79.js"><link rel="prefetch" href="/notes-page/assets/js/130.75afa2a3.js"><link rel="prefetch" href="/notes-page/assets/js/131.46cc5e38.js"><link rel="prefetch" href="/notes-page/assets/js/132.016cecd3.js"><link rel="prefetch" href="/notes-page/assets/js/133.55f07de9.js"><link rel="prefetch" href="/notes-page/assets/js/134.e21737c1.js"><link rel="prefetch" href="/notes-page/assets/js/135.896d7bda.js"><link rel="prefetch" href="/notes-page/assets/js/136.bac73eef.js"><link rel="prefetch" href="/notes-page/assets/js/137.18a3d68a.js"><link rel="prefetch" href="/notes-page/assets/js/138.04217c7f.js"><link rel="prefetch" href="/notes-page/assets/js/139.936289b2.js"><link rel="prefetch" href="/notes-page/assets/js/14.98b93b1d.js"><link rel="prefetch" href="/notes-page/assets/js/140.9eeacc7b.js"><link rel="prefetch" href="/notes-page/assets/js/141.7a52cae7.js"><link rel="prefetch" href="/notes-page/assets/js/142.b051bacb.js"><link rel="prefetch" href="/notes-page/assets/js/143.6b6e8758.js"><link rel="prefetch" href="/notes-page/assets/js/144.c6c3a379.js"><link rel="prefetch" href="/notes-page/assets/js/145.074f441b.js"><link rel="prefetch" href="/notes-page/assets/js/146.102c1a1d.js"><link rel="prefetch" href="/notes-page/assets/js/147.90dc2ec5.js"><link rel="prefetch" href="/notes-page/assets/js/148.d456d35b.js"><link rel="prefetch" href="/notes-page/assets/js/149.ca8af3ed.js"><link rel="prefetch" href="/notes-page/assets/js/15.53bf0149.js"><link rel="prefetch" href="/notes-page/assets/js/150.76fc5ce6.js"><link rel="prefetch" href="/notes-page/assets/js/151.aeec87ec.js"><link rel="prefetch" href="/notes-page/assets/js/152.47cc231f.js"><link rel="prefetch" href="/notes-page/assets/js/153.f46cdb45.js"><link rel="prefetch" href="/notes-page/assets/js/154.8d2b5531.js"><link rel="prefetch" href="/notes-page/assets/js/155.64b3ea22.js"><link rel="prefetch" href="/notes-page/assets/js/156.2f457d36.js"><link rel="prefetch" href="/notes-page/assets/js/157.de93409b.js"><link rel="prefetch" href="/notes-page/assets/js/158.dccd09b3.js"><link rel="prefetch" href="/notes-page/assets/js/159.549d55c4.js"><link rel="prefetch" href="/notes-page/assets/js/16.d3691392.js"><link rel="prefetch" href="/notes-page/assets/js/160.692b7621.js"><link rel="prefetch" href="/notes-page/assets/js/161.e4eb1894.js"><link rel="prefetch" href="/notes-page/assets/js/162.f04fc3e7.js"><link rel="prefetch" href="/notes-page/assets/js/163.0cdfb234.js"><link rel="prefetch" href="/notes-page/assets/js/164.3d80a6cd.js"><link rel="prefetch" href="/notes-page/assets/js/165.5e734817.js"><link rel="prefetch" href="/notes-page/assets/js/166.54e8670d.js"><link rel="prefetch" href="/notes-page/assets/js/167.beb7abc1.js"><link rel="prefetch" href="/notes-page/assets/js/168.eb0b6933.js"><link rel="prefetch" href="/notes-page/assets/js/169.5d53530e.js"><link rel="prefetch" href="/notes-page/assets/js/17.a55bcc19.js"><link rel="prefetch" href="/notes-page/assets/js/170.2f7bbc52.js"><link rel="prefetch" href="/notes-page/assets/js/171.1247acec.js"><link rel="prefetch" href="/notes-page/assets/js/172.2b87f409.js"><link rel="prefetch" href="/notes-page/assets/js/18.40a6fd38.js"><link rel="prefetch" href="/notes-page/assets/js/19.f23a4c4f.js"><link rel="prefetch" href="/notes-page/assets/js/20.6ffbfe95.js"><link rel="prefetch" href="/notes-page/assets/js/21.2147df8c.js"><link rel="prefetch" href="/notes-page/assets/js/22.317292ef.js"><link rel="prefetch" href="/notes-page/assets/js/23.5aac75d2.js"><link rel="prefetch" href="/notes-page/assets/js/24.2c1a9519.js"><link rel="prefetch" href="/notes-page/assets/js/25.2aeaa858.js"><link rel="prefetch" href="/notes-page/assets/js/26.1633506e.js"><link rel="prefetch" href="/notes-page/assets/js/27.b6fcb4e4.js"><link rel="prefetch" href="/notes-page/assets/js/28.e6cb518a.js"><link rel="prefetch" href="/notes-page/assets/js/29.cbf9fb51.js"><link rel="prefetch" href="/notes-page/assets/js/30.1ad410e2.js"><link rel="prefetch" href="/notes-page/assets/js/31.b4f2dab2.js"><link rel="prefetch" href="/notes-page/assets/js/32.cd64e18c.js"><link rel="prefetch" href="/notes-page/assets/js/33.63a03ca8.js"><link rel="prefetch" href="/notes-page/assets/js/34.92ee42e0.js"><link rel="prefetch" href="/notes-page/assets/js/35.40eb9514.js"><link rel="prefetch" href="/notes-page/assets/js/36.02cb189c.js"><link rel="prefetch" href="/notes-page/assets/js/37.9c84984b.js"><link rel="prefetch" href="/notes-page/assets/js/38.4a1925e2.js"><link rel="prefetch" href="/notes-page/assets/js/39.d840e664.js"><link rel="prefetch" href="/notes-page/assets/js/40.00b01109.js"><link rel="prefetch" href="/notes-page/assets/js/41.9d193d81.js"><link rel="prefetch" href="/notes-page/assets/js/42.76b9c957.js"><link rel="prefetch" href="/notes-page/assets/js/43.5a9a8093.js"><link rel="prefetch" href="/notes-page/assets/js/44.d0ee4231.js"><link rel="prefetch" href="/notes-page/assets/js/45.5f2af9a6.js"><link rel="prefetch" href="/notes-page/assets/js/46.088821b6.js"><link rel="prefetch" href="/notes-page/assets/js/47.5b307d4b.js"><link rel="prefetch" href="/notes-page/assets/js/48.db30cae6.js"><link rel="prefetch" href="/notes-page/assets/js/49.dff4cea3.js"><link rel="prefetch" href="/notes-page/assets/js/50.dbd551e7.js"><link rel="prefetch" href="/notes-page/assets/js/51.685865c7.js"><link rel="prefetch" href="/notes-page/assets/js/52.cca2763b.js"><link rel="prefetch" href="/notes-page/assets/js/53.64de3f6e.js"><link rel="prefetch" href="/notes-page/assets/js/54.35e2dd8d.js"><link rel="prefetch" href="/notes-page/assets/js/55.69842f2a.js"><link rel="prefetch" href="/notes-page/assets/js/56.8566302b.js"><link rel="prefetch" href="/notes-page/assets/js/58.ad6cbd31.js"><link rel="prefetch" href="/notes-page/assets/js/59.9799b864.js"><link rel="prefetch" href="/notes-page/assets/js/6.b6c6870c.js"><link rel="prefetch" href="/notes-page/assets/js/60.3ab740c7.js"><link rel="prefetch" href="/notes-page/assets/js/61.66b3e5cb.js"><link rel="prefetch" href="/notes-page/assets/js/62.c2243460.js"><link rel="prefetch" href="/notes-page/assets/js/63.2088ed3e.js"><link rel="prefetch" href="/notes-page/assets/js/64.1803a8da.js"><link rel="prefetch" href="/notes-page/assets/js/65.3fa059f6.js"><link rel="prefetch" href="/notes-page/assets/js/66.9dc42e9d.js"><link rel="prefetch" href="/notes-page/assets/js/67.c6ffcc56.js"><link rel="prefetch" href="/notes-page/assets/js/68.1c39897f.js"><link rel="prefetch" href="/notes-page/assets/js/69.3788efb9.js"><link rel="prefetch" href="/notes-page/assets/js/7.1689d72d.js"><link rel="prefetch" href="/notes-page/assets/js/70.5e00dbcc.js"><link rel="prefetch" href="/notes-page/assets/js/71.d578dd5c.js"><link rel="prefetch" href="/notes-page/assets/js/72.cddd408f.js"><link rel="prefetch" href="/notes-page/assets/js/73.1da5276a.js"><link rel="prefetch" href="/notes-page/assets/js/74.acb313be.js"><link rel="prefetch" href="/notes-page/assets/js/75.fff10c40.js"><link rel="prefetch" href="/notes-page/assets/js/76.37dc1431.js"><link rel="prefetch" href="/notes-page/assets/js/77.8d8d14a0.js"><link rel="prefetch" href="/notes-page/assets/js/78.b23a0a17.js"><link rel="prefetch" href="/notes-page/assets/js/79.a7ca0767.js"><link rel="prefetch" href="/notes-page/assets/js/80.6bd9fbd1.js"><link rel="prefetch" href="/notes-page/assets/js/81.5088cd9a.js"><link rel="prefetch" href="/notes-page/assets/js/82.d1507357.js"><link rel="prefetch" href="/notes-page/assets/js/83.aa81bf4e.js"><link rel="prefetch" href="/notes-page/assets/js/84.40a88686.js"><link rel="prefetch" href="/notes-page/assets/js/85.72e27895.js"><link rel="prefetch" href="/notes-page/assets/js/86.6c247310.js"><link rel="prefetch" href="/notes-page/assets/js/87.3c98d0da.js"><link rel="prefetch" href="/notes-page/assets/js/88.85173d97.js"><link rel="prefetch" href="/notes-page/assets/js/89.1dd0ade9.js"><link rel="prefetch" href="/notes-page/assets/js/9.108dfd20.js"><link rel="prefetch" href="/notes-page/assets/js/90.1652f02d.js"><link rel="prefetch" href="/notes-page/assets/js/91.5fc5281a.js"><link rel="prefetch" href="/notes-page/assets/js/92.ec4c1f40.js"><link rel="prefetch" href="/notes-page/assets/js/93.9ee2cd2c.js"><link rel="prefetch" href="/notes-page/assets/js/94.f84592dd.js"><link rel="prefetch" href="/notes-page/assets/js/95.31415214.js"><link rel="prefetch" href="/notes-page/assets/js/96.e4a57c20.js"><link rel="prefetch" href="/notes-page/assets/js/97.fc76de86.js"><link rel="prefetch" href="/notes-page/assets/js/98.0a773ad4.js"><link rel="prefetch" href="/notes-page/assets/js/99.fbb553a2.js"><link rel="prefetch" href="/notes-page/assets/js/vendors~docsearch.d99f79c5.js"><link rel="prefetch" href="/notes-page/assets/js/vendors~photo-swipe.b8260d4e.js"><link rel="prefetch" href="/notes-page/assets/js/vendors~search-page.d41e229f.js">
    <link rel="stylesheet" href="/notes-page/assets/css/0.styles.ee344319.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes-page/" class="home-link router-link-active"><!----> <span class="site-name">大前端 - 前端高级进阶</span></a> <div class="links"><div id="docsearch"></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>社区PC</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/community-pc/" class="sidebar-link">PC</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>社区管理后台</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/community-admin/" class="sidebar-link">管理后台</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>社区WebApp</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/community-webapp/" class="sidebar-link">webapp</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>小程序</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/community-miniapp/" class="sidebar-link">uniapp介绍</a></li><li><a href="/notes-page/project/community-miniapp/01-搭建开发环境.html" class="sidebar-link">搭建开发环境</a></li><li><a href="/notes-page/project/community-miniapp/02-首页模块.html" class="sidebar-link">首页模块</a></li><li><a href="/notes-page/project/community-miniapp/03-登录鉴权.html" class="sidebar-link">小程序鉴权登录</a></li><li><a href="/notes-page/project/community-miniapp/04-消息&amp;热门&amp;个人中心.html" class="sidebar-link">消息&amp;热门&amp;个人中心</a></li><li><a href="/notes-page/project/community-miniapp/05-RefreshToken机制.html" class="sidebar-link">RefreshToken机制</a></li><li><a href="/notes-page/project/community-miniapp/06-文章详情.html" class="sidebar-link">文章详情</a></li><li><a href="/notes-page/project/community-miniapp/07-安全域名相关.html" class="sidebar-link">安全域名相关</a></li><li><a href="/notes-page/project/community-miniapp/08-订阅消息.html" class="sidebar-link">订阅消息</a></li><li><a href="/notes-page/project/community-miniapp/09-内容安全.html" class="sidebar-link">内容安全</a></li><li><a href="/notes-page/project/community-miniapp/10-发贴&amp;评论功能.html" class="sidebar-link">发贴评论功能</a></li><li><a href="/notes-page/project/community-miniapp/11-发布上线.html" class="sidebar-link">发布上线</a></li><li><a href="/notes-page/project/community-miniapp/12-支付专题.html" class="sidebar-link">支付专题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Flutter 2.0</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/community-flutter/" aria-current="page" class="sidebar-link">Flutter</a></li><li><a href="/notes-page/project/community-flutter/01-风格指南.html" class="sidebar-link">风格指南</a></li><li><a href="/notes-page/project/community-flutter/02-Flutter入门.html" class="sidebar-link">Flutter入门案例</a></li><li><a href="/notes-page/project/community-flutter/03-异步编程思想.html" class="sidebar-link">异步编程思想</a></li><li><a href="/notes-page/project/community-flutter/04-状态管理.html" class="sidebar-link">状态管理概览</a></li><li><a href="/notes-page/project/community-flutter/05-状态管理-redux.html" class="sidebar-link">状态管理方案-Redux</a></li><li><a href="/notes-page/project/community-flutter/06-状态管理-scoped_model.html" class="sidebar-link">状态管理方案-ScopedModel</a></li><li><a href="/notes-page/project/community-flutter/07-状态管理-bloc.html" class="sidebar-link">状态管理方案-Bloc</a></li><li><a href="/notes-page/project/community-flutter/08-获取验证码.html" class="sidebar-link">获取验证码</a></li><li><a href="/notes-page/project/community-flutter/09-封装请求.html" class="sidebar-link">封装请求</a></li><li><a href="/notes-page/project/community-flutter/10-网络测试.html" class="sidebar-link">网络调试</a></li><li><a href="/notes-page/project/community-flutter/11-创建短信接口服务.html" class="sidebar-link">创建发送短信验证码服务</a></li><li><a href="/notes-page/project/community-flutter/12-序列化.html" class="sidebar-link">序列化</a></li><li><a href="/notes-page/project/community-flutter/13-自定义toast组件.html" class="sidebar-link">自定义toast组件</a></li><li><a href="/notes-page/project/community-flutter/14-优化短信验证码逻辑.html" class="sidebar-link">优化短信验证码逻辑</a></li><li><a href="/notes-page/project/community-flutter/15-数据持久化-getstorage.html" class="sidebar-link">数据持久化-GetStorage</a></li><li><a href="/notes-page/project/community-flutter/16-数据持久化-sqflite.html" class="active sidebar-link">数据持久化-Sqflite</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/project/community-flutter/16-数据持久化-sqflite.html#sqflite介绍" class="sidebar-link">sqflite介绍</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-flutter/16-数据持久化-sqflite.html#常见的sql语句" class="sidebar-link">常见的SQL语句</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes-page/project/community-flutter/16-数据持久化-sqflite.html#插入" class="sidebar-link">插入</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-flutter/16-数据持久化-sqflite.html#where-子句" class="sidebar-link">Where 子句</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-flutter/16-数据持久化-sqflite.html#查询" class="sidebar-link">查询</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-flutter/16-数据持久化-sqflite.html#编辑-更新" class="sidebar-link">编辑（更新）</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-flutter/16-数据持久化-sqflite.html#删除" class="sidebar-link">删除</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-flutter/16-数据持久化-sqflite.html#初始化工具类" class="sidebar-link">初始化工具类</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-flutter/16-数据持久化-sqflite.html#创建表格" class="sidebar-link">创建表格</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-flutter/16-数据持久化-sqflite.html#业务相关" class="sidebar-link">业务相关</a></li><li class="sidebar-sub-header"><a href="/notes-page/project/community-flutter/16-数据持久化-sqflite.html#调试sqflite" class="sidebar-link">调试sqflite</a></li></ul></li><li><a href="/notes-page/project/community-flutter/17-路由.html" class="sidebar-link">路由</a></li><li><a href="/notes-page/project/community-flutter/18-集成方案&amp;消息&amp;适配.html" class="sidebar-link">集成方案&amp;消息&amp;适配</a></li><li><a href="/notes-page/project/community-flutter/19-苹果开发者.html" class="sidebar-link">苹果开发者</a></li><li><a href="/notes-page/project/community-flutter/20-启动图标与启动图.html" class="sidebar-link">配置应用图标与启动图</a></li><li><a href="/notes-page/project/community-flutter/21-日志收集.html" class="sidebar-link">错误日志收集</a></li><li><a href="/notes-page/project/community-flutter/22-打包.html" class="sidebar-link">移动端打包</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Electron桌面端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/community-electron/" class="sidebar-link">整体介绍</a></li><li><a href="/notes-page/project/community-electron/01-核心概念.html" class="sidebar-link">核心概念</a></li><li><a href="/notes-page/project/community-electron/02-与主流框架集成.html" class="sidebar-link">与主流的框架集成</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React世界</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes-page/project/react/" class="sidebar-link">React项目</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="数据持久化-sqflite"><a href="#数据持久化-sqflite" class="header-anchor">#</a> 数据持久化-Sqflite</h1> <p>有一些应用场景需要不仅持久化存储数据，还需要对数据进行：</p> <ul><li>索引</li> <li>大量数据</li> <li>图片</li> <li>...</li></ul> <h2 id="sqflite介绍"><a href="#sqflite介绍" class="header-anchor">#</a> sqflite介绍</h2> <p>就是Flutter的<a href="https://www.sqlite.org/index.html" target="_blank" rel="noopener noreferrer">SQLite<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>插件，支持iOS、Android和MacOS。</p> <blockquote><p>说明：SQLite 是一个软件库，实现了自给自足的、无服务器的、零配置的、事务性的 SQL 数据库引擎。SQLite 是在世界上最广泛部署的 SQL 数据库引擎。SQLite 源代码不受版权限制。</p></blockquote> <p>安装:</p> <div class="language-dart extra-class"><pre class="language-dart"><code>dependencies<span class="token punctuation">:</span>
  sqflite<span class="token punctuation">:</span> <span class="token operator">^</span><span class="token number">2.0</span><span class="token number">.2</span>
</code></pre></div><p>使用<code>flutter pub get</code>进行安装</p> <p>接下来，需要有一些前置的知识：</p> <ol><li>常见的SQL语句</li> <li>如何创建表（数据存储的一种称谓，一个形式，类似于Excel）</li> <li>如何使用sqflite进行数据的增删改查</li></ol> <h2 id="常见的sql语句"><a href="#常见的sql语句" class="header-anchor">#</a> 常见的SQL语句</h2> <h3 id="插入"><a href="#插入" class="header-anchor">#</a> 插入</h3> <p><strong>语法</strong></p> <p>INSERT INTO 语句有两种基本语法，如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>INSERT INTO TABLE_NAME [(column1, column2, column3,...columnN)]  
VALUES (value1, value2, value3,...valueN);
</code></pre></div><p>在这里，column1, column2,...columnN 是要插入数据的表中的列的名称。</p> <p>如果要为表中的所有列添加值，您也可以不需要在 SQLite 查询中指定列名称。但要确保值的顺序与列在表中的顺序一致。SQLite 的 INSERT INTO 语法如下：</p> <div class="language- extra-class"><pre class="language-text"><code>INSERT INTO TABLE_NAME VALUES (value1,value2,value3,...valueN);
</code></pre></div><h3 id="where-子句"><a href="#where-子句" class="header-anchor">#</a> Where 子句</h3> <p>SQLite的 <strong>WHERE</strong> 子句用于指定从一个表或多个表中获取数据的条件。</p> <p>如果满足给定的条件，即为真（true）时，则从表中返回特定的值。您可以使用 WHERE 子句来过滤记录，只获取需要的记录。</p> <p>WHERE 子句不仅可用在 SELECT 语句中，它也可用在 UPDATE、DELETE 语句中，等等</p> <h3 id="查询"><a href="#查询" class="header-anchor">#</a> 查询</h3> <p><strong>语法</strong></p> <p>SQLite 的 SELECT 语句的基本语法如下：</p> <div class="language- extra-class"><pre class="language-text"><code>SELECT column1, column2, columnN FROM table_name;
</code></pre></div><p>在这里，column1, column2...是表的字段，他们的值即是您要获取的。如果您想获取所有可用的字段，那么可以使用下面的语法：</p> <div class="language- extra-class"><pre class="language-text"><code>SELECT * FROM table_name;
</code></pre></div><h3 id="编辑-更新"><a href="#编辑-更新" class="header-anchor">#</a> 编辑（更新）</h3> <p><strong>语法</strong></p> <p>带有 WHERE 子句的 UPDATE 查询的基本语法如下：</p> <div class="language- extra-class"><pre class="language-text"><code>UPDATE table_name
SET column1 = value1, column2 = value2...., columnN = valueN
WHERE [condition];
</code></pre></div><p>您可以使用 AND 或 OR 运算符来结合 N 个数量的条件。</p> <h3 id="删除"><a href="#删除" class="header-anchor">#</a> 删除</h3> <p><strong>语法</strong></p> <p>带有 WHERE 子句的 DELETE 查询的基本语法如下：</p> <div class="language- extra-class"><pre class="language-text"><code>DELETE FROM table_name
WHERE [condition];
</code></pre></div><p>可以使用 AND 或 OR 运算符来结合 N 个数量的条件。</p> <h2 id="初始化工具类"><a href="#初始化工具类" class="header-anchor">#</a> 初始化工具类</h2> <p>使用sqflite，需要对其初始化，此时应该思考：</p> <ol><li>是否需要单例？</li> <li>初始化和什么东西有关?
<ul><li>路径</li> <li>数据库文件</li> <li>数据库表</li></ul></li></ol> <p>如果不清楚还可以，参考官方：</p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token comment">// Get a location using getDatabasesPath</span>
<span class="token keyword">var</span> databasesPath <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDatabasesPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>databasesPath<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'demo.db'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Delete the database</span>
<span class="token keyword">await</span> <span class="token function">deleteDatabase</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// open the database</span>
<span class="token class-name">Database</span> database <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">openDatabase</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> version<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    onCreate<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Database</span> db<span class="token punctuation">,</span> int version<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token comment">// When creating the db, create the table</span>
  <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>
      <span class="token string-literal"><span class="token string">'CREATE TABLE Test (id INTEGER PRIMARY KEY, name TEXT, value INTEGER, num REAL)'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Insert some records in a transaction</span>
<span class="token keyword">await</span> database<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">(</span>txn<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  int id1 <span class="token operator">=</span> <span class="token keyword">await</span> txn<span class="token punctuation">.</span><span class="token function">rawInsert</span><span class="token punctuation">(</span>
      <span class="token string-literal"><span class="token string">'INSERT INTO Test(name, value, num) VALUES(&quot;some name&quot;, 1234, 456.789)'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'inserted1: </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">id1</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  int id2 <span class="token operator">=</span> <span class="token keyword">await</span> txn<span class="token punctuation">.</span><span class="token function">rawInsert</span><span class="token punctuation">(</span>
      <span class="token string-literal"><span class="token string">'INSERT INTO Test(name, value, num) VALUES(?, ?, ?)'</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'another name'</span></span><span class="token punctuation">,</span> <span class="token number">12345678</span><span class="token punctuation">,</span> <span class="token number">3.1416</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'inserted2: </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">id2</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Update some record</span>
int count <span class="token operator">=</span> <span class="token keyword">await</span> database<span class="token punctuation">.</span><span class="token function">rawUpdate</span><span class="token punctuation">(</span>
    <span class="token string-literal"><span class="token string">'UPDATE Test SET name = ?, value = ? WHERE name = ?'</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'updated name'</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'9876'</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'some name'</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'updated: </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">count</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the records</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">await</span> database<span class="token punctuation">.</span><span class="token function">rawQuery</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'SELECT * FROM Test'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> expectedList <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token string-literal"><span class="token string">'name'</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'updated name'</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'id'</span></span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'value'</span></span><span class="token punctuation">:</span> <span class="token number">9876</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'num'</span></span><span class="token punctuation">:</span> <span class="token number">456.789</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token string-literal"><span class="token string">'name'</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'another name'</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'id'</span></span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'value'</span></span><span class="token punctuation">:</span> <span class="token number">12345678</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'num'</span></span><span class="token punctuation">:</span> <span class="token number">3.1416</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span>expectedList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">DeepCollectionEquality</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> expectedList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Count the records</span>
count <span class="token operator">=</span> <span class="token class-name">Sqflite</span>
    <span class="token punctuation">.</span><span class="token function">firstIntValue</span><span class="token punctuation">(</span><span class="token keyword">await</span> database<span class="token punctuation">.</span><span class="token function">rawQuery</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'SELECT COUNT(*) FROM Test'</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Delete a record</span>
count <span class="token operator">=</span> <span class="token keyword">await</span> database
    <span class="token punctuation">.</span><span class="token function">rawDelete</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'DELETE FROM Test WHERE name = ?'</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'another name'</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Close the database</span>
<span class="token keyword">await</span> database<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>但是，上面除了部分有价值的内容以外，没有单例的说明。</p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token comment">// 获取数据库的地址</span>
<span class="token keyword">var</span> databasesPath <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDatabasesPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建数据库及名称</span>
<span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>databasesPath<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'demo.db'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or,删除数据库，一般用于更新</span>
<span class="token keyword">await</span> <span class="token function">deleteDatabase</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 初始化，并创建表</span>
<span class="token class-name">Database</span> database <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">openDatabase</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> version<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    onCreate<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Database</span> db<span class="token punctuation">,</span> int version<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建表</span>
  <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>
      <span class="token string-literal"><span class="token string">'CREATE TABLE Test (id INTEGER PRIMARY KEY, name TEXT, value INTEGER, num REAL)'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>单例可以通过构建方法来实现，具体的实现：</p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:my_app/config.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:my_app/entity/user_info.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:my_app/storage.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:my_app/utils/functions.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:path/path.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:sqflite/sqflite.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:sqflite/sqlite_api.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">BaseProvider</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.初始化</span>
  <span class="token comment">// 2.提供db实例 -&gt; path -&gt; openDatabase</span>
  <span class="token class-name">BaseProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">BaseProvider</span> db <span class="token operator">=</span> <span class="token class-name">BaseProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  late <span class="token class-name">Database</span> _database<span class="token punctuation">;</span>

  <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Database</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">get</span> database <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_database <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> _database<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      _database <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">initDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _database<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">initDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断路径是否存在，不存在需要创建</span>
    <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string-literal"><span class="token string">''</span></span><span class="token punctuation">;</span>
    <span class="token class-name">UserInfo</span><span class="token operator">?</span> userInfo <span class="token operator">=</span> <span class="token class-name">Storage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> databasePath <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getDatabasesPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 根据不同的场景：public, user</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userInfo <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      path <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>databasePath<span class="token punctuation">,</span> userInfo<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token class-name">Config</span><span class="token punctuation">.</span>privateDBName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token function">makeDir</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 公共的场景</span>
      path <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>databasePath<span class="token punctuation">,</span> <span class="token class-name">Config</span><span class="token punctuation">.</span>publicDBName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// onCreate -&gt; 创建数据表格</span>
    <span class="token class-name">Database</span> database <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">openDatabase</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> database<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="创建表格"><a href="#创建表格" class="header-anchor">#</a> 创建表格</h2> <p>sqlite支持的数据类型：</p> <table><thead><tr><th style="text-align:left;">储类</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">NULL</td> <td style="text-align:left;">值是一个 NULL 值。</td></tr> <tr><td style="text-align:left;">INTEGER</td> <td style="text-align:left;">值是一个带符号的整数，根据值的大小存储在 1、2、3、4、6 或 8 字节中。</td></tr> <tr><td style="text-align:left;">REAL</td> <td style="text-align:left;">值是一个浮点值，存储为 8 字节的 IEEE 浮点数字。</td></tr> <tr><td style="text-align:left;">TEXT</td> <td style="text-align:left;">值是一个文本字符串，使用数据库编码（UTF-8、UTF-16BE 或 UTF-16LE）存储。</td></tr> <tr><td style="text-align:left;">BLOB</td> <td style="text-align:left;">值是一个 blob 数据，完全根据它的输入存储。</td></tr></tbody></table> <p>其他的类型可以参考：<a href="https://github.com/tekartik/sqflite/blob/master/sqflite/doc/supported_types.md" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>增加代码：</p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token comment">// onCreate -&gt; 创建数据表格</span>
<span class="token class-name">Database</span> database <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">openDatabase</span><span class="token punctuation">(</span>
  path<span class="token punctuation">,</span>
  version<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  onCreate<span class="token punctuation">:</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> version<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token comment">// sqlite四种类型 -&gt; NULL, TEXT, INTEGER, BLOB, REAL</span>
    <span class="token comment">// onCreate -&gt; 创建数据表格</span>
    <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'''CREATE TABLE IF NOT EXISTS posts (
      _id TEXT PRIMARY KEY,
      uid TEXT,
      title TEXT,
      content TEXT,
      created TEXT,
      catalog TEXT,
      fav TEXT,
      isEnd TEXT DEFAULT '0',
      reads INTEGER DEFAULT 0,
      answer INTEGER DEFAULT 0,
      status TEXT DEFAULT '0',
      isTop TEXT DEFAULT '0',
      sort TEXT DEFAULT 100,
      tags TEXT)
      '''</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// await db.execute ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>同时，增加几个实体文件，见课程的资源文件夹（通过icode下载）。</p> <p><img src="/notes-page/assets/img/image-20220122181244488.7aabcefc.png" alt="image-20220122181244488"></p></blockquote> <h2 id="业务相关"><a href="#业务相关" class="header-anchor">#</a> 业务相关</h2> <p>创建一个首页列表数据的provider类，实现SQL的增删改查：</p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token comment">// 扩展基类</span>
<span class="token keyword">class</span> <span class="token class-name">ContentProvider</span> <span class="token keyword">extends</span> <span class="token class-name">BaseProvider</span> <span class="token punctuation">{</span>
  
  <span class="token comment">// 创建一个静态的方法，这个静态方法与 ContentProvider() 等价</span>
  <span class="token comment">// 一个方法与构造函数等价，后续的使用方法：ContentProvider.db.[methods]</span>
  <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ContentProvider</span> db <span class="token operator">=</span> <span class="token class-name">ContentProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 这里使用super关键字，调用了基类中的database，这样ContentProvider与基类中的databse为同一个实例，即同一个数据库</span>
  <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Database</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">get</span> database <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">super</span><span class="token punctuation">.</span>database<span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
</code></pre></div><p>创建<code>lib/database/content_provider.dart</code>文件：</p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:my_app/database/base_provider.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:my_app/entity/content/post.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:sqflite/sqlite_api.dart'</span></span><span class="token punctuation">;</span>

<span class="token comment">// ContentProvider().db -&gt; public属性或者方法</span>
<span class="token comment">//</span>
<span class="token keyword">class</span> <span class="token class-name">ContentProvider</span> <span class="token keyword">extends</span> <span class="token class-name">BaseProvider</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ContentProvider</span> db <span class="token operator">=</span> <span class="token class-name">ContentProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Database</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">get</span> database <span class="token keyword">async</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">super</span><span class="token punctuation">.</span>database<span class="token punctuation">;</span>

  <span class="token comment">// 增</span>
  <span class="token comment">// list -&gt; 写入到posts -&gt; for性能非常低下，batch insert</span>
  <span class="token function">addPostBatch</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Post</span><span class="token punctuation">&gt;</span></span> lists<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">final</span> db <span class="token operator">=</span> <span class="token keyword">await</span> database<span class="token punctuation">;</span>
      <span class="token class-name">Batch</span> batch <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">batch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lists<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        batch<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'posts'</span></span><span class="token punctuation">,</span> element<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token keyword">await</span> batch<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'err is 👉 </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">err</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 删</span>
  <span class="token function">deleteBatch</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">final</span> db <span class="token operator">=</span> <span class="token keyword">await</span> database<span class="token punctuation">;</span>
      <span class="token class-name">Batch</span> batch <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">batch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ids<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        batch<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'posts'</span></span><span class="token punctuation">,</span> where<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'[_id] = ?'</span></span><span class="token punctuation">,</span> whereArgs<span class="token punctuation">:</span> <span class="token punctuation">[</span>element<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token keyword">await</span> batch<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'err is 👉 </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">err</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 查</span>
  <span class="token function">getPost</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">final</span> db <span class="token operator">=</span> <span class="token keyword">await</span> database<span class="token punctuation">;</span>
      <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'posts'</span></span><span class="token punctuation">,</span> where<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'[_id] = ?'</span></span><span class="token punctuation">,</span> whereArgs<span class="token punctuation">:</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// List</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Post</span><span class="token punctuation">&gt;</span></span> lists <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">Post</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> lists<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'err is 👉 </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">err</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">getPostsById</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">final</span> db <span class="token operator">=</span> <span class="token keyword">await</span> database<span class="token punctuation">;</span>
      <span class="token comment">// SELECT * FROM posts WHERER [_id] IN (&quot;id1&quot;,&quot;id2&quot;,&quot;id3&quot;)</span>
      <span class="token comment">// -&gt;rawQuery</span>
      <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'SELECT * FROM posts WHERER [_id] IN (&quot;'</span></span> <span class="token operator">+</span>
          ids<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">','</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">','</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'&quot;,&quot;'</span></span><span class="token punctuation">)</span> <span class="token operator">+</span>
          <span class="token string-literal"><span class="token string">'&quot;)'</span></span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">rawQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Post</span><span class="token punctuation">&gt;</span></span> lists <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">Post</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> lists<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'err is 👉 </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">err</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 改</span>
  <span class="token comment">// toJson -&gt; Array &amp; Object -&gt; SQLite</span>
  <span class="token function">updatePost</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Post</span><span class="token punctuation">&gt;</span></span> lists<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">final</span> db <span class="token operator">=</span> <span class="token keyword">await</span> database<span class="token punctuation">;</span>
      <span class="token class-name">Batch</span> batch <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">batch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lists<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        batch<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'posts'</span></span><span class="token punctuation">,</span> element<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> where<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'[_id] = ?'</span></span><span class="token punctuation">,</span> whereArgs<span class="token punctuation">:</span> <span class="token punctuation">[</span>element<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token keyword">await</span> batch<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'err is 👉 </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">err</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="调试sqflite"><a href="#调试sqflite" class="header-anchor">#</a> 调试sqflite</h2> <p>打印日志：</p> <ul><li>数据库路径</li> <li>打印请求的列表数据</li></ul> <p>注意本地的数据库路径会在重新启动了之后，发生变化，所以最好平时开始的时候进行打印，如果需要查看数据库中的内容，可以使用navicat一类的数据库查看软件进行查看。</p> <img src="/notes-page/assets/img/image-20220122203933993.bce4b6af.png" alt="image-20220122203933993" style="zoom:50%;"> <p>无需配置密码。</p> <p>使用在线工具jsonto</p> <p><img src="/notes-page/assets/img/image-20220122203849286.c86cc4e1.png" alt="image-20220122203849286"></p> <p>原因是由于uid可能是null，可能是一个map数据。map数据不能直接入库，库中只能存放TEXT类型的数据！</p> <p>定义三个工具方法：</p> <div class="language-dart extra-class"><pre class="language-dart"><code>encodeListOrMap<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> data <span class="token operator">is</span> <span class="token class-name">T</span> <span class="token operator">?</span> json<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">:</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

decodeList<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> data <span class="token operator">is</span> <span class="token class-name">List</span>
      <span class="token operator">?</span> data<span class="token punctuation">.</span>cast<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">:</span> json<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> e <span class="token operator">as</span> <span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">decodeMap</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> data <span class="token operator">is</span> <span class="token class-name">Map</span>
      <span class="token operator">?</span> data <span class="token operator">as</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">:</span> json<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">as</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
  <span class="token comment">// jsonData['uid'] is Map</span>
  <span class="token comment">//         ? jsonData['uid'] as Map&lt;String, dynamic&gt;</span>
  <span class="token comment">//         : json.decode(jsonData['uid']) as Map&lt;String, dynamic&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改<code>post.dart</code>文件：</p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:convert'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:json_annotation/json_annotation.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:my_app/utils/functions.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">part</span> <span class="token string-literal"><span class="token string">'post.g.dart'</span></span><span class="token punctuation">;</span>


<span class="token metadata function">@JsonSerializable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span> <span class="token punctuation">{</span>
  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'isEnd'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> isEnd<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'reads'</span></span><span class="token punctuation">)</span>
  int reads<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'answer'</span></span><span class="token punctuation">)</span>
  int answer<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'status'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> status<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'isTop'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> isTop<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'sort'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> sort<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'tags'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tags<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'_id'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> id<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'title'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> title<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'content'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> content<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'catalog'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> catalog<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'fav'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> fav<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'uid'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">Uid</span> uid<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'created'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> created<span class="token punctuation">;</span>


  <span class="token class-name">Post</span><span class="token punctuation">(</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isEnd<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reads<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>answer<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isTop<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sort<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tags<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>catalog<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fav<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>created<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">factory</span> <span class="token class-name">Post</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> srcJson<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span>
      _$<span class="token class-name">PostFromJson</span><span class="token punctuation">(</span>srcJson<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _$<span class="token class-name">PostToJson</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token metadata function">@JsonSerializable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Uid</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span> <span class="token punctuation">{</span>
  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'pic'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> pic<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'isVip'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> isVip<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'_id'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> id<span class="token punctuation">;</span>

  <span class="token metadata function">@JsonKey</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'name'</span></span><span class="token punctuation">)</span>
  <span class="token class-name">String</span> name<span class="token punctuation">;</span>

  <span class="token class-name">Uid</span><span class="token punctuation">(</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pic<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isVip<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">factory</span> <span class="token class-name">Uid</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> srcJson<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _$<span class="token class-name">UidFromJson</span><span class="token punctuation">(</span>srcJson<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _$<span class="token class-name">UidToJson</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改<code>post.g.dart</code>文件：</p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token comment">// GENERATED CODE - DO NOT MODIFY BY HAND</span>

<span class="token keyword">part</span> of <span class="token string-literal"><span class="token string">'post.dart'</span></span><span class="token punctuation">;</span>

<span class="token comment">// **************************************************************************</span>
<span class="token comment">// JsonSerializableGenerator</span>
<span class="token comment">// **************************************************************************</span>

<span class="token class-name">Post</span> _$<span class="token class-name">PostFromJson</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> jsonData<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">Post</span><span class="token punctuation">(</span>
      jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'isEnd'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'reads'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> int<span class="token punctuation">,</span>
      jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'answer'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> int<span class="token punctuation">,</span>
      jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'status'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'isTop'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'sort'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      decodeList<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'tags'</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'_id'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'title'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'content'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'catalog'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'fav'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      <span class="token class-name">Uid</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span><span class="token function">decodeMap</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'uid'</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      jsonData<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'created'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> _$<span class="token class-name">PostToJson</span><span class="token punctuation">(</span><span class="token class-name">Post</span> instance<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
      <span class="token string-literal"><span class="token string">'isEnd'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>isEnd<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'reads'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>reads<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'answer'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>answer<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'status'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>status<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'isTop'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>isTop<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'sort'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>sort<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'tags'</span></span><span class="token punctuation">:</span> encodeListOrMap<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>tags<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'_id'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'title'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'content'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'catalog'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>catalog<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'fav'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>fav<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'uid'</span></span><span class="token punctuation">:</span> encodeListOrMap<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Uid</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'created'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>created<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">Uid</span> _$<span class="token class-name">UidFromJson</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> json<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">Uid</span><span class="token punctuation">(</span>
      json<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'pic'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      json<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'isVip'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      json<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'_id'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
      json<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'name'</span></span><span class="token punctuation">]</span> <span class="token operator">as</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> _$<span class="token class-name">UidToJson</span><span class="token punctuation">(</span><span class="token class-name">Uid</span> instance<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
      <span class="token string-literal"><span class="token string">'pic'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>pic<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'isVip'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>isVip<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'_id'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      <span class="token string-literal"><span class="token string">'name'</span></span><span class="token punctuation">:</span> instance<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div> <!----> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes-page/project/community-flutter/15-数据持久化-getstorage.html" class="prev">
        数据持久化-GetStorage
      </a></span> <span class="next"><a href="/notes-page/project/community-flutter/17-路由.html">
        路由
      </a>
      →
    </span></p></div>  <div class="el-dialog__wrapper" style="display:none;"><div role="dialog" aria-modal="true" aria-label="dialog" class="el-dialog" style="margin-top:15vh;width:420px;"><div class="el-dialog__header"><span class="el-dialog__title"></span><button type="button" aria-label="Close" class="el-dialog__headerbtn"><i class="el-dialog__close el-icon el-icon-close"></i></button></div><!----><div class="el-dialog__footer"><span class="dialog-footer"><button type="button" class="el-button el-button--default"><!----><!----><span>取 消</span></button> <button type="button" class="el-button el-button--primary"><!----><!----><span>确 定</span></button></span></div></div></div></main> <!----></div><div class="global-ui"><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/notes-page/assets/js/app.bf2e4db7.js" defer></script><script src="/notes-page/assets/js/8.645bf0c6.js" defer></script><script src="/notes-page/assets/js/57.7cf81658.js" defer></script>
  </body>
</html>
